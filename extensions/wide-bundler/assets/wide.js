
  if(typeof shopWB == 'undefined'){ //Check if WideBundle is already enabled for duplicated scripts
  productsWB = [{"id":"100823668","0":"100823668","shop":"colisss.myshopify.com","1":"colisss.myshopify.com","product_id":"7623547093159","2":"7623547093159","title":"t-shirt-1","3":"t-shirt-1","handle":"t-shirt-1","4":"t-shirt-1","variant_id":"43236667883687","5":"43236667883687","variant_title":"one","6":"one","currency":"","7":"","variant_price":"2.00","8":"2.00","variant_compared":"","9":"","variant_option1":"one","10":"one","variant_option2":"","11":"","variant_option3":"","12":"","title_option1":"t-shirt-1","13":"t-shirt-1","title_option2":"","14":"","best_offer":"0","15":"0","image":"","16":"","homepage":"0","17":"0","selected_offer":"0","18":"0","blinking_effect":"0","19":"0","blinking_text":"","20":"","blinking_position":"0","21":"0","position_offer":"1","22":"1","enabled":"1","23":"1","variant_option1_title":"Offer","24":"Offer","variant_option2_title":"","25":"","variant_option3_title":"","26":""},{"id":"100824846","0":"100824846","shop":"colisss.myshopify.com","1":"colisss.myshopify.com","product_id":"7623552172199","2":"7623552172199","title":"t-shirt-10","3":"t-shirt-10","handle":"t-shirt-10","4":"t-shirt-10","variant_id":"43237122179239","5":"43237122179239","variant_title":"1 Product Only \/ REd","6":"1 Product Only \/ REd","currency":"","7":"","variant_price":"10.00","8":"10.00","variant_compared":"20.00","9":"20.00","variant_option1":"1 Product Only","10":"1 Product Only","variant_option2":"REd","11":"REd","variant_option3":"","12":"","title_option1":"Offer\u6807\u9898\uff0c\u4f18\u60e0\u4fc3\u9500","13":"Offer\u6807\u9898\uff0c\u4f18\u60e0\u4fc3\u9500","title_option2":"Color1","14":"Color1","best_offer":"0","15":"0","image":"https:\/\/cdn.shopify.com\/s\/files\/1\/0275\/7646\/7549\/products\/t-shirt-13_110x110@2x.png?v=1679365527","16":"https:\/\/cdn.shopify.com\/s\/files\/1\/0275\/7646\/7549\/products\/t-shirt-13_110x110@2x.png?v=1679365527","homepage":"0","17":"0","selected_offer":"0","18":"0","blinking_effect":"1","19":"1","blinking_text":"","20":"","blinking_position":"0","21":"0","position_offer":"1","22":"1","enabled":"1","23":"1","variant_option1_title":"Offer","24":"Offer","variant_option2_title":"Color","25":"Color","variant_option3_title":"","26":""},{"id":"100824847","0":"100824847","shop":"colisss.myshopify.com","1":"colisss.myshopify.com","product_id":"7623552172199","2":"7623552172199","title":"t-shirt-10","3":"t-shirt-10","handle":"t-shirt-10","4":"t-shirt-10","variant_id":"43237122212007","5":"43237122212007","variant_title":"1 Product Only \/ Green","6":"1 Product Only \/ Green","currency":"","7":"","variant_price":"10.00","8":"10.00","variant_compared":"20.00","9":"20.00","variant_option1":"1 Product Only","10":"1 Product Only","variant_option2":"Green","11":"Green","variant_option3":"","12":"","title_option1":"Offer\u6807\u9898\uff0c\u4f18\u60e0\u4fc3\u9500","13":"Offer\u6807\u9898\uff0c\u4f18\u60e0\u4fc3\u9500","title_option2":"Color1","14":"Color1","best_offer":"0","15":"0","image":"https:\/\/cdn.shopify.com\/s\/files\/1\/0275\/7646\/7549\/products\/t-shirt-13_110x110@2x.png?v=1679365527","16":"https:\/\/cdn.shopify.com\/s\/files\/1\/0275\/7646\/7549\/products\/t-shirt-13_110x110@2x.png?v=1679365527","homepage":"0","17":"0","selected_offer":"0","18":"0","blinking_effect":"1","19":"1","blinking_text":"","20":"","blinking_position":"0","21":"0","position_offer":"1","22":"1","enabled":"1","23":"1","variant_option1_title":"Offer","24":"Offer","variant_option2_title":"Color","25":"Color","variant_option3_title":"","26":""},{"id":"100825070","0":"100825070","shop":"colisss.myshopify.com","1":"colisss.myshopify.com","product_id":"7623788888231","2":"7623788888231","title":"\u6d4b\u8bd5\u4ea7\u54c1-1-\u65e0\u53d8\u4f53","3":"\u6d4b\u8bd5\u4ea7\u54c1-1-\u65e0\u53d8\u4f53","handle":"\u6d4b\u8bd5\u4ea7\u54c1-1-\u65e0\u53d8\u4f53","4":"\u6d4b\u8bd5\u4ea7\u54c1-1-\u65e0\u53d8\u4f53","variant_id":"43237170118823","5":"43237170118823","variant_title":"Default Title","6":"Default Title","currency":"","7":"","variant_price":"10.00","8":"10.00","variant_compared":"20.00","9":"20.00","variant_option1":"Default Title","10":"Default Title","variant_option2":"","11":"","variant_option3":"","12":"","title_option1":"\u591a\u4e70\u591a\u7701\u94b1","13":"\u591a\u4e70\u591a\u7701\u94b1","title_option2":"","14":"","best_offer":"0","15":"0","image":"","16":"","homepage":"0","17":"0","selected_offer":"0","18":"0","blinking_effect":"0","19":"0","blinking_text":"","20":"","blinking_position":"0","21":"0","position_offer":"1","22":"1","enabled":"1","23":"1","variant_option1_title":"Offer","24":"Offer","variant_option2_title":"","25":"","variant_option3_title":"","26":""},{"id":"100834350","0":"100834350","shop":"colisss.myshopify.com","1":"colisss.myshopify.com","product_id":"7624091336871","2":"7624091336871","title":"\u6d4b\u8bd5\u540c\u6b65\u529f\u80fd\u4ea7\u54c1-1","3":"\u6d4b\u8bd5\u540c\u6b65\u529f\u80fd\u4ea7\u54c1-1","handle":"\u6d4b\u8bd5\u540c\u6b65\u529f\u80fd\u4ea7\u54c1-1","4":"\u6d4b\u8bd5\u540c\u6b65\u529f\u80fd\u4ea7\u54c1-1","variant_id":"43242060021927","5":"43242060021927","variant_title":"\u5355\u4e70\u4e00\u4e2a1 \/ red \/ g1","6":"\u5355\u4e70\u4e00\u4e2a1 \/ red \/ g1","currency":"","7":"","variant_price":"202.00","8":"202.00","variant_compared":"300.00","9":"300.00","variant_option1":"\u5355\u4e70\u4e00\u4e2a1","10":"\u5355\u4e70\u4e00\u4e2a1","variant_option2":"red","11":"red","variant_option3":"g1","12":"g1","title_option1":"heading\u6807\u9898","13":"heading\u6807\u9898","title_option2":"cc","14":"cc","best_offer":"0","15":"0","image":"","16":"","homepage":"0","17":"0","selected_offer":"0","18":"0","blinking_effect":"0","19":"0","blinking_text":"","20":"","blinking_position":"0","21":"0","position_offer":"1","22":"1","enabled":"1","23":"1","variant_option1_title":"Offer","24":"Offer","variant_option2_title":"color","25":"color","variant_option3_title":"gg","26":"gg"},{"id":"100834351","0":"100834351","shop":"colisss.myshopify.com","1":"colisss.myshopify.com","product_id":"7624091336871","2":"7624091336871","title":"\u6d4b\u8bd5\u540c\u6b65\u529f\u80fd\u4ea7\u54c1-1","3":"\u6d4b\u8bd5\u540c\u6b65\u529f\u80fd\u4ea7\u54c1-1","handle":"\u6d4b\u8bd5\u540c\u6b65\u529f\u80fd\u4ea7\u54c1-1","4":"\u6d4b\u8bd5\u540c\u6b65\u529f\u80fd\u4ea7\u54c1-1","variant_id":"43242060054695","5":"43242060054695","variant_title":"\u5355\u4e70\u4e00\u4e2a1 \/ red \/ g2","6":"\u5355\u4e70\u4e00\u4e2a1 \/ red \/ g2","currency":"","7":"","variant_price":"202.00","8":"202.00","variant_compared":"300.00","9":"300.00","variant_option1":"\u5355\u4e70\u4e00\u4e2a1","10":"\u5355\u4e70\u4e00\u4e2a1","variant_option2":"red","11":"red","variant_option3":"g2","12":"g2","title_option1":"heading\u6807\u9898","13":"heading\u6807\u9898","title_option2":"cc","14":"cc","best_offer":"0","15":"0","image":"","16":"","homepage":"0","17":"0","selected_offer":"0","18":"0","blinking_effect":"0","19":"0","blinking_text":"","20":"","blinking_position":"0","21":"0","position_offer":"1","22":"1","enabled":"1","23":"1","variant_option1_title":"Offer","24":"Offer","variant_option2_title":"color","25":"color","variant_option3_title":"gg","26":"gg"},{"id":"100834352","0":"100834352","shop":"colisss.myshopify.com","1":"colisss.myshopify.com","product_id":"7624091336871","2":"7624091336871","title":"\u6d4b\u8bd5\u540c\u6b65\u529f\u80fd\u4ea7\u54c1-1","3":"\u6d4b\u8bd5\u540c\u6b65\u529f\u80fd\u4ea7\u54c1-1","handle":"\u6d4b\u8bd5\u540c\u6b65\u529f\u80fd\u4ea7\u54c1-1","4":"\u6d4b\u8bd5\u540c\u6b65\u529f\u80fd\u4ea7\u54c1-1","variant_id":"43242060087463","5":"43242060087463","variant_title":"\u5355\u4e70\u4e00\u4e2a1 \/ yellow \/ g1","6":"\u5355\u4e70\u4e00\u4e2a1 \/ yellow \/ g1","currency":"","7":"","variant_price":"202.00","8":"202.00","variant_compared":"300.00","9":"300.00","variant_option1":"\u5355\u4e70\u4e00\u4e2a1","10":"\u5355\u4e70\u4e00\u4e2a1","variant_option2":"yellow","11":"yellow","variant_option3":"g1","12":"g1","title_option1":"heading\u6807\u9898","13":"heading\u6807\u9898","title_option2":"cc","14":"cc","best_offer":"0","15":"0","image":"","16":"","homepage":"0","17":"0","selected_offer":"0","18":"0","blinking_effect":"0","19":"0","blinking_text":"","20":"","blinking_position":"0","21":"0","position_offer":"1","22":"1","enabled":"1","23":"1","variant_option1_title":"Offer","24":"Offer","variant_option2_title":"color","25":"color","variant_option3_title":"gg","26":"gg"},{"id":"100834353","0":"100834353","shop":"colisss.myshopify.com","1":"colisss.myshopify.com","product_id":"7624091336871","2":"7624091336871","title":"\u6d4b\u8bd5\u540c\u6b65\u529f\u80fd\u4ea7\u54c1-1","3":"\u6d4b\u8bd5\u540c\u6b65\u529f\u80fd\u4ea7\u54c1-1","handle":"\u6d4b\u8bd5\u540c\u6b65\u529f\u80fd\u4ea7\u54c1-1","4":"\u6d4b\u8bd5\u540c\u6b65\u529f\u80fd\u4ea7\u54c1-1","variant_id":"43242060120231","5":"43242060120231","variant_title":"\u5355\u4e70\u4e00\u4e2a1 \/ yellow \/ g2","6":"\u5355\u4e70\u4e00\u4e2a1 \/ yellow \/ g2","currency":"","7":"","variant_price":"202.00","8":"202.00","variant_compared":"300.00","9":"300.00","variant_option1":"\u5355\u4e70\u4e00\u4e2a1","10":"\u5355\u4e70\u4e00\u4e2a1","variant_option2":"yellow","11":"yellow","variant_option3":"g2","12":"g2","title_option1":"heading\u6807\u9898","13":"heading\u6807\u9898","title_option2":"cc","14":"cc","best_offer":"0","15":"0","image":"","16":"","homepage":"0","17":"0","selected_offer":"0","18":"0","blinking_effect":"0","19":"0","blinking_text":"","20":"","blinking_position":"0","21":"0","position_offer":"1","22":"1","enabled":"1","23":"1","variant_option1_title":"Offer","24":"Offer","variant_option2_title":"color","25":"color","variant_option3_title":"gg","26":"gg"},{"id":"100824848","0":"100824848","shop":"colisss.myshopify.com","1":"colisss.myshopify.com","product_id":"7623552172199","2":"7623552172199","title":"t-shirt-10","3":"t-shirt-10","handle":"t-shirt-10","4":"t-shirt-10","variant_id":"43237122277543","5":"43237122277543","variant_title":"2 Products \/ Red","6":"2 Products \/ Red","currency":"","7":"","variant_price":"20.00","8":"20.00","variant_compared":"","9":"","variant_option1":"2 Products","10":"2 Products","variant_option2":"Red","11":"Red","variant_option3":"","12":"","title_option1":"Offer\u6807\u9898\uff0c\u4f18\u60e0\u4fc3\u9500","13":"Offer\u6807\u9898\uff0c\u4f18\u60e0\u4fc3\u9500","title_option2":"Color1","14":"Color1","best_offer":"0","15":"0","image":"https:\/\/cdn.shopify.com\/s\/files\/1\/0275\/7646\/7549\/products\/t-shirt-14_110x110@2x.png?v=1679365548","16":"https:\/\/cdn.shopify.com\/s\/files\/1\/0275\/7646\/7549\/products\/t-shirt-14_110x110@2x.png?v=1679365548","homepage":"0","17":"0","selected_offer":"0","18":"0","blinking_effect":"0","19":"0","blinking_text":"","20":"","blinking_position":"0","21":"0","position_offer":"2","22":"2","enabled":"1","23":"1","variant_option1_title":"Offer","24":"Offer","variant_option2_title":"Color","25":"Color","variant_option3_title":"","26":""},{"id":"100824849","0":"100824849","shop":"colisss.myshopify.com","1":"colisss.myshopify.com","product_id":"7623552172199","2":"7623552172199","title":"t-shirt-10","3":"t-shirt-10","handle":"t-shirt-10","4":"t-shirt-10","variant_id":"43237122310311","5":"43237122310311","variant_title":"2 Products \/ Blue","6":"2 Products \/ Blue","currency":"","7":"","variant_price":"20.00","8":"20.00","variant_compared":"","9":"","variant_option1":"2 Products","10":"2 Products","variant_option2":"Blue","11":"Blue","variant_option3":"","12":"","title_option1":"Offer\u6807\u9898\uff0c\u4f18\u60e0\u4fc3\u9500","13":"Offer\u6807\u9898\uff0c\u4f18\u60e0\u4fc3\u9500","title_option2":"Color1","14":"Color1","best_offer":"0","15":"0","image":"https:\/\/cdn.shopify.com\/s\/files\/1\/0275\/7646\/7549\/products\/t-shirt-14_110x110@2x.png?v=1679365548","16":"https:\/\/cdn.shopify.com\/s\/files\/1\/0275\/7646\/7549\/products\/t-shirt-14_110x110@2x.png?v=1679365548","homepage":"0","17":"0","selected_offer":"0","18":"0","blinking_effect":"0","19":"0","blinking_text":"","20":"","blinking_position":"0","21":"0","position_offer":"2","22":"2","enabled":"1","23":"1","variant_option1_title":"Offer","24":"Offer","variant_option2_title":"Color","25":"Color","variant_option3_title":"","26":""},{"id":"100825071","0":"100825071","shop":"colisss.myshopify.com","1":"colisss.myshopify.com","product_id":"7623788888231","2":"7623788888231","title":"\u6d4b\u8bd5\u4ea7\u54c1-1-\u65e0\u53d8\u4f53","3":"\u6d4b\u8bd5\u4ea7\u54c1-1-\u65e0\u53d8\u4f53","handle":"\u6d4b\u8bd5\u4ea7\u54c1-1-\u65e0\u53d8\u4f53","4":"\u6d4b\u8bd5\u4ea7\u54c1-1-\u65e0\u53d8\u4f53","variant_id":"43237170151591","5":"43237170151591","variant_title":"\u4e00\u6b21\u4e702\u4e2a","6":"\u4e00\u6b21\u4e702\u4e2a","currency":"","7":"","variant_price":"20.00","8":"20.00","variant_compared":"","9":"","variant_option1":"\u4e00\u6b21\u4e702\u4e2a","10":"\u4e00\u6b21\u4e702\u4e2a","variant_option2":"","11":"","variant_option3":"","12":"","title_option1":"\u591a\u4e70\u591a\u7701\u94b1","13":"\u591a\u4e70\u591a\u7701\u94b1","title_option2":"","14":"","best_offer":"0","15":"0","image":"","16":"","homepage":"0","17":"0","selected_offer":"0","18":"0","blinking_effect":"0","19":"0","blinking_text":"","20":"","blinking_position":"0","21":"0","position_offer":"2","22":"2","enabled":"1","23":"1","variant_option1_title":"Offer","24":"Offer","variant_option2_title":"","25":"","variant_option3_title":"","26":""},{"id":"100834354","0":"100834354","shop":"colisss.myshopify.com","1":"colisss.myshopify.com","product_id":"7624091336871","2":"7624091336871","title":"\u6d4b\u8bd5\u540c\u6b65\u529f\u80fd\u4ea7\u54c1-1","3":"\u6d4b\u8bd5\u540c\u6b65\u529f\u80fd\u4ea7\u54c1-1","handle":"\u6d4b\u8bd5\u540c\u6b65\u529f\u80fd\u4ea7\u54c1-1","4":"\u6d4b\u8bd5\u540c\u6b65\u529f\u80fd\u4ea7\u54c1-1","variant_id":"43242060152999","5":"43242060152999","variant_title":"\u4e702\u4e2a \/ zz \/ f2","6":"\u4e702\u4e2a \/ zz \/ f2","currency":"","7":"","variant_price":"333.00","8":"333.00","variant_compared":"","9":"","variant_option1":"\u4e702\u4e2a","10":"\u4e702\u4e2a","variant_option2":"zz","11":"zz","variant_option3":"f2","12":"f2","title_option1":"heading\u6807\u9898","13":"heading\u6807\u9898","title_option2":"zzzz","14":"zzzz","best_offer":"0","15":"0","image":"","16":"","homepage":"0","17":"0","selected_offer":"0","18":"0","blinking_effect":"0","19":"0","blinking_text":"","20":"","blinking_position":"0","21":"0","position_offer":"2","22":"2","enabled":"1","23":"1","variant_option1_title":"Offer","24":"Offer","variant_option2_title":"color","25":"color","variant_option3_title":"gg","26":"gg"},{"id":"100834355","0":"100834355","shop":"colisss.myshopify.com","1":"colisss.myshopify.com","product_id":"7624091336871","2":"7624091336871","title":"\u6d4b\u8bd5\u540c\u6b65\u529f\u80fd\u4ea7\u54c1-1","3":"\u6d4b\u8bd5\u540c\u6b65\u529f\u80fd\u4ea7\u54c1-1","handle":"\u6d4b\u8bd5\u540c\u6b65\u529f\u80fd\u4ea7\u54c1-1","4":"\u6d4b\u8bd5\u540c\u6b65\u529f\u80fd\u4ea7\u54c1-1","variant_id":"43242060185767","5":"43242060185767","variant_title":"\u4e702\u4e2a \/ zz \/ f1","6":"\u4e702\u4e2a \/ zz \/ f1","currency":"","7":"","variant_price":"333.00","8":"333.00","variant_compared":"","9":"","variant_option1":"\u4e702\u4e2a","10":"\u4e702\u4e2a","variant_option2":"zz","11":"zz","variant_option3":"f1","12":"f1","title_option1":"heading\u6807\u9898","13":"heading\u6807\u9898","title_option2":"zzzz","14":"zzzz","best_offer":"0","15":"0","image":"","16":"","homepage":"0","17":"0","selected_offer":"0","18":"0","blinking_effect":"0","19":"0","blinking_text":"","20":"","blinking_position":"0","21":"0","position_offer":"2","22":"2","enabled":"1","23":"1","variant_option1_title":"Offer","24":"Offer","variant_option2_title":"color","25":"color","variant_option3_title":"gg","26":"gg"},{"id":"100834356","0":"100834356","shop":"colisss.myshopify.com","1":"colisss.myshopify.com","product_id":"7624091336871","2":"7624091336871","title":"\u6d4b\u8bd5\u540c\u6b65\u529f\u80fd\u4ea7\u54c1-1","3":"\u6d4b\u8bd5\u540c\u6b65\u529f\u80fd\u4ea7\u54c1-1","handle":"\u6d4b\u8bd5\u540c\u6b65\u529f\u80fd\u4ea7\u54c1-1","4":"\u6d4b\u8bd5\u540c\u6b65\u529f\u80fd\u4ea7\u54c1-1","variant_id":"43242060218535","5":"43242060218535","variant_title":"\u4e702\u4e2a \/ zzz \/ f2","6":"\u4e702\u4e2a \/ zzz \/ f2","currency":"","7":"","variant_price":"333.00","8":"333.00","variant_compared":"","9":"","variant_option1":"\u4e702\u4e2a","10":"\u4e702\u4e2a","variant_option2":"zzz","11":"zzz","variant_option3":"f2","12":"f2","title_option1":"heading\u6807\u9898","13":"heading\u6807\u9898","title_option2":"zzzz","14":"zzzz","best_offer":"0","15":"0","image":"","16":"","homepage":"0","17":"0","selected_offer":"0","18":"0","blinking_effect":"0","19":"0","blinking_text":"","20":"","blinking_position":"0","21":"0","position_offer":"2","22":"2","enabled":"1","23":"1","variant_option1_title":"Offer","24":"Offer","variant_option2_title":"color","25":"color","variant_option3_title":"gg","26":"gg"},{"id":"100834357","0":"100834357","shop":"colisss.myshopify.com","1":"colisss.myshopify.com","product_id":"7624091336871","2":"7624091336871","title":"\u6d4b\u8bd5\u540c\u6b65\u529f\u80fd\u4ea7\u54c1-1","3":"\u6d4b\u8bd5\u540c\u6b65\u529f\u80fd\u4ea7\u54c1-1","handle":"\u6d4b\u8bd5\u540c\u6b65\u529f\u80fd\u4ea7\u54c1-1","4":"\u6d4b\u8bd5\u540c\u6b65\u529f\u80fd\u4ea7\u54c1-1","variant_id":"43242060251303","5":"43242060251303","variant_title":"\u4e702\u4e2a \/ zzz \/ f1","6":"\u4e702\u4e2a \/ zzz \/ f1","currency":"","7":"","variant_price":"333.00","8":"333.00","variant_compared":"","9":"","variant_option1":"\u4e702\u4e2a","10":"\u4e702\u4e2a","variant_option2":"zzz","11":"zzz","variant_option3":"f1","12":"f1","title_option1":"heading\u6807\u9898","13":"heading\u6807\u9898","title_option2":"zzzz","14":"zzzz","best_offer":"0","15":"0","image":"","16":"","homepage":"0","17":"0","selected_offer":"0","18":"0","blinking_effect":"0","19":"0","blinking_text":"","20":"","blinking_position":"0","21":"0","position_offer":"2","22":"2","enabled":"1","23":"1","variant_option1_title":"Offer","24":"Offer","variant_option2_title":"color","25":"color","variant_option3_title":"gg","26":"gg"}];
shopWB = [];
shopWB = {"id":"40963","shop":"colisss.myshopify.com","charge_id":"28016181415","status":"active","price":"16","currency":"${{amount}}","option1_title":"Select your offer:","atc_background":"#a72121","hover_color":"#a72121","atc_color":"#ffffff","atc_text":"Add To Cart","atc_font_size":"1.2em","atc_font":"auto","atc_radius":"0px","atc_size":"medium","atc_animation":"no","border_color":"#bc2323","background_color":"#fceaea","price_color":"#bc2323","price_compared_color":"#989898","price_size":"0.9em","offer_color":"#333232","title_best":"Best Offer!","color_best":"#000000","link_choice":"cart","installed":"1","affiliate_id":"0","ref":null,"onboarding":"3","economic_color":"#000000","economic_text":"You save {{percent}}% ({{amount}})","economic_display":"0","option_color":"#333232","enabled":"1","review":"0","onboarding_guided":"1","ask_referal":"1","price_separator":".","form_id":".product-form-product-template","price_id":".product__price","select_id":".selector-wrapper.product-form__item","email_given":"0","email_perso":null,"before_code":null,"after_code":null,"trustbadge":null,"offer_selected_color":"#333232","best_selected_color":"#000000","price_selected_color":"#bc2323","price_compared_selected_color":"#989898","economic_selected_color":"#000000","update_price":"1","design_code":"0","svg_number":"0","svg_size":"1.2em","display_quantity":"0","bg_button_quantity":"#ffffff","color_button_quantity":"#000000","bg_input_quantity":"#ffffff","color_input_quantity":"#000000","style_blinking":"none","style_title":"none","style_economic":"none","style_price":"none","style_compared_price":"none","style_variants_selected":"bold","style_blinking_selected":"bold","style_title_selected":"bold","style_economic_selected":"bold","style_price_selected":"bold","style_compared_price_selected":"bold","offers_heading_font_size":"0.9em","auto_round":"0","country_code":"CN","shopify_plan":"dormant","no_decimal":"0","add_pixel":"1","utm_source":"","custom_css":null,"currency_code":"JPY","shop_creation":"2019-09-10 07:25:04","shop_id":"27576467549","referer":"Word of mouth","plan":"monthly"};
  websiteWB = 'https://widebundle.com/'; //This is to get the current website (widebundle.com or staging.widebundle.com)
function declareVariable(info){
  window.LocationWebsite = decodeURI(window.location.href);
  window.LocationWebsite = encodeURI(LocationWebsite);
  if(window.LocationWebsite.indexOf(encodeURI('checkout')) > -1){
    console.log('checkout');
  }
  window.currencyCodeWB = {
    USD: 'US$',
    EUR: '€',
    GBP: '£',
    AUD: 'AU$',
    NZD: 'NZ$',
    CAD: 'CA$',
    JPY: '¥',
    DKK: 'DKK',
    NOK: 'NOK',
    SEK: 'SEK',
    BAM: 'KM',
    BGN: 'лв.',
    CHF: 'CHF',
    DKK: 'kr.',
    ILS: '₪',
    ISK: 'ISK',
    LBP: 'ل.ل',
    LRD: 'LRD $',
    PLN: 'zł',
    RON: 'Lei',
    TRY: '₺',
    MXN: '$',
    HKD: '$',
    KRW: '₩',
    MYR: 'RM',
    SGD: '$',
    TWD: '$',
    TND: 'د.ت',
    EGP: 'ج.م',
    DZD: 'دج',
    MAD: 'dh',
    BRL: 'R$',
    CLP: 'CLP',
    INR: '₹',
    UAE: 'د.إ',
    AED: 'د.إ',
    ARS: 'ARS',
    PEN: 'S/',
    SAR: 'SAR',
    CNY: '¥',
    RUB: '₽',
    ZAR: 'R',
    IDR: 'Rp',
    PHP: '₱',
    THB: '฿',
    VND: '₫',
    KES: 'KSh',
    PKR: 'Rs',
    EGP: 'EGP',
    IQD: 'IQD',
    KWD: 'KWD',
    OMR: 'OMR',
    QAR: 'QAR',
    JOD: 'JOD',
    LYD: 'LYD',
    SYP: 'SYP',
    BHD: 'BHD',
    JMD: 'JMD',
    BDT: 'BDT',
    NPR: 'NPR',
    LKR: 'LKR',
    KHR: 'KHR',
    MMK: 'MMK',
    LAK: 'LAK',
    VEF: 'VEF',
    COP: 'COP',
    UYU: 'UYU',
    PYG: 'PYG',
    BOB: 'BOB',
    TZS: 'TZS',
    GTQ: 'GTQ',
    NGN: 'NGN',
    MUR: 'MUR',
    MGA: 'MGA',
    XOF: 'XOF',
    RWF: 'RWF',
    UGX: 'UGX',
    TND: 'TND',
    SDG: 'SDG',
    SLL: 'SLL',
    SCR: 'SCR'
  };

  window.beforeCodeWB = info['before_code'];
  window.afterCodeWB = info['after_code'];
  window.trustbadgeWB = info['trustbadge'];
  window.currencyForm = info['currency'];
  window.displayQuantityWB = info['display_quantity'];
  window.options1 = [];
  window.options2 = [];
  window.optionsTitle = [];
  window.options1Split = [];
  window.options2Split = [];
  window.optionPrice = [];
  window.bestOption = [];
  window.preSelected = [];
  window.imagesVariant = [];
  window.blinkingTextWB = [];
  window.idOptions1 = [];
  window.linkChoice = info['link_choice'];
  window.widebundleOffers = [];
  var regp = /<\/span>/m;
  shopWB['currency'] = info['currency'].replace(regp, '');
  var regp = /<span class=.*>/;
  shopWB['currency'] = info['currency'].replace(regp, '');
}

function selectOffers() {
  //For all variants
  window.uniqueOffers = [];

  for (var v = 0; v < productsWB.length; v++) {

      //shorten the name of the offer
      nameOffer = productsWB[v]['variant_option1'];

      //If this offer isn't already in uniqueOffers we add it
      if (!uniqueOffers.includes(productsWB[v]['product_id'] + '||' + nameOffer)) {

          uniqueOffers.push(productsWB[v]['product_id'] + '||' + nameOffer);

          //Push it to uniqueOffers
          offerPrice = shopWB['currency'].replace('{{amount}}', productsWB[v]['variant_price']);

          //set the compared at price for each unique offer
          if (parseFloat(productsWB[v]['variant_price']) < parseFloat(productsWB[v]['variant_compared'])) {
              offerComparedPrice = shopWB['currency'].replace('{{amount}}', productsWB[v]['variant_compared']);
          }
          else {
              offerComparedPrice = '';
          }

          path = location.pathname.split("/");
          pathHandle = path[path.length - 1];
          if (pathHandle == "") {
              pathHandle = path[path.length - 2];
          }

          if (typeof meta == "undefined") {
              current = window.location.pathname;
              if (current == '/') {
                  meta = [];
                  meta.page = [];
                  meta.page.pageType = "home";
              } else {
                  console.log('Not on the homepage.');
              }
          }

          urlHandles = ['products/', 'collections/', 'page/', 'pages/'];
          urlHandlesPos = posInUrl(LocationWebsite, urlHandles);

          //Check if we need to display the order on the product page or homepage
          if ((urlHandlesPos['products/'] > -1 && pathHandle.toLowerCase() == encodeURI(productsWB[v]['handle']).toLowerCase())
              || (typeof meta != "undefined" && typeof meta.page.pageType != 'undefined' && meta.page.pageType == 'home' && urlHandlesPos['collections/'] == -1 && productsWB[v]['homepage'] == 1)
              || (typeof meta != "undefined" && typeof meta.page.pageType != 'undefined' && meta.page.pageType == 'page' && (urlHandlesPos['page/'] == '1' || urlHandlesPos['pages/'] > 1) && typeof widebundleHandle != 'undefined' && widebundleHandle == productsWB[v]['handle'])
              || (typeof handleWide !== 'undefined' && handleWide == productsWB[v]['handle'])
          ) {
              window.productON = productsWB[v]['handle'];
              window.titleOffer = productsWB[v]['title_option1'];

              //Add the unique offer in options1 if it belongs to the product on this page
              include = options1.includes(nameOffer + '@@' + productsWB[v]['variant_id'] + '@@' + offerPrice + '@@' + offerComparedPrice);
              if (include == false) {

                  //Add the thumbnail
                  imagesVariant[nameOffer] = productsWB[v]['image'];

                  //Push the offer to options1
                  options1.push(nameOffer + '@@' + productsWB[v]['variant_id'] + '@@' + offerPrice + '@@' + offerComparedPrice);

                  //Associate the id of a variant with his text to find it easily
                  idOptions1[productsWB[v]['variant_id']] = nameOffer;

                  //Associate the text of a variant with the titles of the options
                  optionsTitle[nameOffer] = productsWB[v]['title_option2'];

                  //Set up the price
                  priceNumber = offerPrice.replace(/[^\d.-]/g, '');
                  optionPrice[nameOffer] = priceNumber;

                  //Set up the array for all the sub options of the unique offer
                  options2[nameOffer] = [];

                  //To remove?
                  //bestOption[productsWB[v]['variant_option1']] = productsWB[v]['best_offer'];

                  //Set the blinking text for the unique offer
                  blinkingTextWB[nameOffer] = productsWB[v]['blinking_text'] + '@@' + productsWB[v]['blinking_effect'] + '@@' + productsWB[v]['blinking_position'];

                  //Add in preselect the value to know if it's a preselected offer
                  preSelected.push(productsWB[v]['selected_offer']);
              }
          }

          //Get all the variants in the offers
          for (var y = 0; y < productsWB.length; y++) {

              //Shorten variable
              variantNameOffer = productsWB[y]['variant_option1'];

              //If the variant belongs to this unique offer
              if (productsWB[v]['product_id'] == productsWB[y]['product_id'] && nameOffer == variantNameOffer) {

                  //We set the price for each variant
                  offerPrice = shopWB['currency'].replace('{{amount}}', productsWB[y]['variant_price']);
                  if (parseFloat(productsWB[y]['variant_price']) < parseFloat(productsWB[y]['variant_compared'])) {
                      offerComparedPrice = shopWB['currency'].replace('{{amount}}', productsWB[y]['variant_compared']);
                  }
                  else {
                      offerComparedPrice = '';
                  }

                  //remove Location? Because we already checked it
                  //Add the variant to options2 that belongs to this unique offer
                  if (
                      (urlHandlesPos['products/'] > -1 && pathHandle.toLowerCase() == encodeURI(productsWB[v]['handle']).toLowerCase())
                      || (typeof meta != "undefined" && meta.page.pageType != undefined && meta.page.pageType == 'home' && urlHandlesPos['collections/'] == -1 && productsWB[y]['homepage'] == 1)
                      || (typeof meta != "undefined" && meta.page.pageType != undefined && meta.page.pageType == 'page' && (urlHandlesPos['page/'] == '1' || urlHandlesPos['pages/'] > 1) && typeof widebundleHandle != 'undefined' && widebundleHandle == productsWB[y]['handle'])
                      || (typeof handleWide !== 'undefined' && handleWide == productsWB[y]['handle'])) {

                      options2[variantNameOffer]
                          .push(productsWB[y]['variant_option2'] + '@@' + productsWB[y]['variant_id'] + '@@' + productsWB[y]['variant_option3'] + '@@' + offerPrice + '@@' + offerComparedPrice);

                      widebundleOffers[productsWB[y]['variant_id']] = new Array();
                      widebundleOffers[productsWB[y]['variant_id']]["price"] = offerPrice;
                      widebundleOffers[productsWB[y]['variant_id']]["compared_price"] = offerComparedPrice;
                  }

              }
          }
      }
  }
}

function GetPriceWB(getPrice = 1){

  if(getPrice == 0){
    price = document.getElementsByClassName('436365456347267462424627&@');
    priceID = 'not checked';
    var http2 = new XMLHttpRequest();
    var url2 = websiteWB+'AJAX/GetPrice.php';
    var params2 = 'price='+priceID+'&shop='+shopWB['shop'];
    http2.open('POST', url2, true);
    http2.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
    http2.onreadystatechange = function() {
        if(http2.readyState == 4 && http2.status == 200) {
        }
    }
    http2.send(params2);
    return;
  }

  pricesWB = [
    ".product-item-caption-price", ".ProductMeta__PriceList", "#price_ppr", ".product-single__prices", ".product-featured__price-text", ".product__price",
    ".gf_product-prices", "#productPrice-product-template", ".productTemplatePrice", ".product-price", "div[data-product-type=price]", ".modal_price",
    ".featured-product-section .product-single .box .product-wrapper .product-details .product-single__meta .price-wrapper" ,":not(.wb_hidden_prices_element) .price", ".product-meta h1",
    ".price-wrapper", ".product-single__price", ".tt-price", ".gt_flex.price_product", ".pt-price", ".gt-product-price", 'span[data-zp-product-discount-price]',
    '.t4s-product-price'
  ];

  pricesExceptionWB = [
    ".upsells .upsell-info", "#new-form", ".new-wb-form"
  ];

  blocsToGetPricesWB = [
    ".featured_product_se"
  ];

  priceWB:
  for(var i=0; i < pricesWB.length; i++){
    for(var x=0; x <blocsToGetPricesWB.length; x++){
      blocToGetPrice = document.querySelector(blocsToGetPricesWB[x]);
      if(blocToGetPrice != null){
        pricesLength = blocToGetPrice.querySelectorAll(pricesWB[i]).length;
        if(pricesLength != 0){
          price = blocToGetPrice.querySelectorAll(pricesWB[i]);
          priceID = pricesWB[i];
          break priceWB;
        }
      }
    }
    pricesLength = document.querySelectorAll(pricesWB[i]).length;
    addConsoleLog("price length: " + pricesLength + " for: " + pricesWB[i]);
    if(pricesLength != 0){
      price = document.querySelectorAll(pricesWB[i]);

      priceID = pricesWB[i];
      addConsoleLog("price "+priceID+" found:");
      addConsoleLog(price);
      break;
    }
  }
  if(typeof price == "undefined"){
    price = document.getElementsByClassName("JUSTSOMETHINGTOTRIGGERUNDEFINED");
    addConsoleLog("price not found");
  }


  //Remove unwanted prices
  if(document.getElementsByClassName('product-single__price--wrapper')[0] != undefined){
    document.getElementsByClassName('product-single__price--wrapper')[0].style.display = 'none';
  }

  if(document.getElementById('ProductPrice') != undefined && document.getElementsByClassName('price') == undefined && document.getElementById('ComparePrice') != undefined){
    price[0].style.display = 'none';
  }

  try{
    if(document.getElementById('ProductPrice') != null && document.getElementById('ComparePrice') != null && document.getElementsByClassName('sale_price')[0] != undefined && document.getElementsByClassName('price')[0] != undefined){
      if(document.getElementsByClassName('price')[0].innerHTML.trim() == ''){
        document.getElementById('ComparePrice').style.display = 'none';
        document.getElementById('ProductPrice').style.display = 'none';
        document.getElementById('ComparePrice').style.fontSize = '0px';
        document.getElementById('ProductPrice').style.fontSIze = '0px';
        document.getElementsByClassName('sale_price')[0].style.display = 'none';
      }
    }
  }
  catch(error){
    GetErrorWB(error);
  }

  if(document.getElementsByClassName('product__price--compare')[0] != undefined){
    for(iPrice = 0; iPrice < document.getElementsByClassName('product__price--compare').length; iPrice++){
      document.getElementsByClassName('product__price--compare')[iPrice].style.display = 'none';
    }
  }

  try{
    if(price[0] != undefined){
      if(priceID == ".gt-product-price"){
        if(document.querySelectorAll(".gt-product-compare-price")[0] != null){
          document.querySelectorAll(".gt-product-compare-price")[0].style.display = "none";
        }
      }
    }
  }
  catch(error){
    console.log(error);
  }

  if(document.getElementsByClassName('product-action')[0] != undefined){
    document.getElementsByClassName('product-action')[0].style.display = 'none';
  }

  if(document.querySelector('div[data-product-type="compare_at_price"][data-pf-type="ProductPrice"]') != null){
    document.querySelector('div[data-product-type="compare_at_price"][data-pf-type="ProductPrice"]').style.display = "none";
  }


  //Exception for changing price selected
  if(document.getElementById('ComparePrice-product-template') != undefined){
    if(document.getElementsByClassName('product-single__price product-single__price-product-template')[0] != undefined){
      price = document.getElementsByClassName('product-single__price');
      priceID = '.product-single__price';
    }
  }

  if(price[0] != undefined){
    if(price[0].offsetParent === null && priceID == '.product__price'){
      if(document.getElementsByClassName('product__price--compare')[0] != undefined){
        if(document.getElementsByClassName('product__price--compare')[0].offsetParent === null){
          if(document.getElementsByClassName('product__price on-sale')[0] != undefined){
            price = document.getElementsByClassName('product__price on-sale');
            priceID = ".product__price on-sale"
          }
        }
      }
    }
  }

  if(price[0] != undefined){
    if(priceID == '.product__price'){
      if(price[0].classList.contains('product__price--compare') && document.getElementsByClassName('product__price sale-price')[0] != undefined){
        price = document.getElementsByClassName('product__price sale-price');
        priceID = ".product__price sale-price";
      }
    }
  }

  if(price[0] != undefined){
    if(priceID == '.product-single__price'){
      if(price[0].classList.contains('product__price--compare') == false && document.getElementsByClassName('product-single__price product-single__price--compare')[0] != undefined){
        if(document.getElementsByClassName('product-single__meta-list')[0] != undefined){
          price = document.getElementsByClassName('product-single__meta-list');
          price[0].style.fontSize = '1.2em';
          priceID = ".product-single__meta-list";
        }
      }
    }
  }

  if(price[0] != undefined){
    if(priceID == ".product-single__price"){
      if(price[0].closest('.price-container') != null){
        if(price[0].closest('.price-container').querySelector('#ComparePrice.product-single__price--compare-at') != null){
          if(price[0].closest('.price-container').querySelector('#ComparePrice.product-single__price--compare-at') != price[0]){
            price[0].closest('.price-container').querySelector('#ComparePrice.product-single__price--compare-at').style.display = "none";
          }
        }
      }
    }
  }

  if(price[0] == undefined){
    priceID = '';
    addConsoleLog("price not found");
  }

  if(shopWB['price_id']!=priceID){
	  var http = new XMLHttpRequest();
	  var url = websiteWB+'AJAX/GetPrice.php';
	  var params = 'price='+priceID+'&shop='+shopWB['shop'];
	  http.open('POST', url, true);
	  http.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
	  http.onreadystatechange = function() {
		  if(http.readyState == 4 && http.status == 200) {
		  }
	  }
	  http.send(params);
	  shopWB['price_id'] = priceID;
  }
}

function observePriceChanges(target) {
  const config = {
    childList: true,
    subtree: true,
    characterData: true,
  };

  const callback = function (mutationsList, observer) {
    if (!window.pricesWB) return;
    for (let mutation of mutationsList) {
      for (let selector of pricesWB) {
        let targetMatch = false;
        let addedMatch = false;
        let removedMatch = false;

        if (mutation.target.matches !== undefined && mutation.target.matches(selector)) {
          targetMatch = true;
        }

        Array.from(mutation.addedNodes).forEach(node => {
          if (node.matches !== undefined && node.matches(selector)) {
            addedMatch = true;
          }
        });

        Array.from(mutation.removedNodes).forEach(node => {
          if (node.matches !== undefined && node.matches(selector)) {
            removedMatch = true;
          }
        });

        if (mutation.target.nodeType != 3) {
          if (mutation.target.querySelector('.first-price-WB') || mutation.target.querySelector('.second-price-WB')) continue;
        }

        if (targetMatch || addedMatch || removedMatch) {
          if (formWB.style.height === '0' || formWB.style.display === 'none') {
            updatePriceOnSelect();
          }
        }
      }
    }
  };

  const observer = new MutationObserver(callback);
  observer.observe(target, config);
}
observePriceChanges(document);

function GetFormWB(){

  //Don't select the form if the element is the same as one element below
  formsSameElementException = [
    '.checkout-x-buy-now-btn', '.price-descriptors .shopify-product-form'
  ];

  //Unwanted forms as child/parent/form
  formsException = [
    ".sticky-cart-form", "#form-sticky", ".container-sticky_addtocart", ".sticky-barre-content", "#shopify-section-header",
    ".product-recommendations-placeholder", ".sticky-atc-title", ".search-form", ".sticky-dropdownvar", "header.site-header", "#popUps .cart_upsell_popup",
    "#popUps .cart_downsell_popup", '.product-upsell-holder', '#product-form-installment', '.sticky_addcart', '.product-upsell__holder', '#ShippingModal',
    ".collection .card-wrapper .card__content", '#featured-product-scroll .product--variant', 'product-sticky-form', '#rio-upsell', '.t4s-product-tabs-wrapper',
    'div[data-extraclass="sticky-atc"]', '#shopify-section-pr_description', '.cu-upsell', '#CartDrawer', 'cart-drawer.cart-drawer'
  ];

  //Elements we want to hide
  hidingElements = [
    ".shg-product-selector-wrapper", ".tt-swatches-container", ".tt-option-block", ".dbtfy-color_swatches", ".pt-swatches-container",
    ".product-form__item--submit", ".pg__option--single", ".gt_product-swatches.gt_flex.gt_variant_product", ".button_add_to_cart.gt_product-addtocart",
    ".gt_flex.gt_variant_product"
  ];

  //Forms we want to check
  forms = [
    ".w-commerce-commerceaddtocartform.default-state-2", ".product-form", ".productForm", 'product-form form[data-type="add-to-cart-form"]', ".product-form__buy-buttons .shopify-product-form", ".shopify-product-form", "#addToCartFormId1",
    ".t4s-product__info-wrapper form.t4s-form__product", "#AddToCartForm--product-template", ".product-form-product-template", ".product-form.hidedropdown", ".addToCartForm", ".product-single__meta .product-single__meta-info .product-single__form", ".ProductForm",
    ".product-single__form", ".prod_form", "#addToCartForm-product-template-optimised", ".shg-product-atc-btn-wrapper", 'form[data-type="add-to-cart-form"].form', "form[action=\'/cart/add\']",
    "#addToCartForm", ".form-vertical", "#prodForm", "form[data-product-form]", "#add-to-cart-form", "form[action$='/cart/add']", ".product-single__form:nth-child(2)"
  ];


  //For all the forms classes
  form:
  for(var i=0; i < forms.length; i++){
    formLength = document.querySelectorAll(forms[i]).length;
    addConsoleLog("form length: " + formLength + " for: " + forms[i]);
    //For all the forms found in the page
    formNumber:
    for(j=0; j<formLength; j++){
      form = document.querySelectorAll(forms[i])[j];
      formID = forms[i];
      //If the form is found and is not .product-form (because we can't use it)
      if(typeof form !== 'undefined' && form != null && formID != ".product-form") {
        addConsoleLog('form found:');
        addConsoleLog(form);
        //For all the exceptions classes
        for(var x=0; x < formsException.length; x++){
          exceptionAll = document.querySelectorAll(formsException[x]);
          for(var z=0; z < exceptionAll.length; z++){
            exception = document.querySelectorAll(formsException[x])[z];
            //If the form is an exception then check next form found in the page
            if(exception != undefined && exception == form){
              addConsoleLog('form is an exception...');
              continue formNumber;
            }
            //If the form is a child of an exception then check next form found in the page
            else if(exception != undefined && isDescendant(exception, form)){
              addConsoleLog('form is descendant of an exception...');
              continue formNumber;
            }
            //If the form is a parent of an exception then check next form found in the page
            else if(exception != undefined && isDescendant(form, exception)){
              addConsoleLog('form is parent of an exception...');
              continue formNumber;
            }
          }
        }
        //For all exceptions that are the same element
        for(var x=0; x < formsSameElementException.length; x++){
          exceptionAll = document.querySelectorAll(formsSameElementException[x]);
          for(var z=0; z < exceptionAll.length; z++){
            exception = document.querySelectorAll(formsSameElementException[x])[z];
            //If the form is an exception then check next form found in the page
            if(exception != undefined && exception == form){
              addConsoleLog('form is an exception element...');
              continue formNumber;
            }
          }
        }
        //Check forms we don't wants (those with only hidden elements)
        childElementsWB = form.querySelectorAll('*');
        good = 0;
        for(var x=0; x<childElementsWB.length; x++){
          if(typeof childElementsWB[x] == "object" && typeof childElementsWB[x].type != "undefined" && childElementsWB[x].type != "hidden"){
              good = 1;
          }
        }
        if(good == 0 && formLength >= 2){
          addConsoleLog('form has only hidden inputs...');
          continue formNumber;
        }
        if(good == 0 && childElementsWB.length == 0){
          addConsoleLog('form has no children');
          continue formNumber;
        }
        if(good == 0 && form.tagName == "BUTTON"){
          addConsoleLog('form is a button so we continue');
          continue formNumber;
        }
        //If form exists and has passed the exceptions then we can choose it to display the Widget
        if(form !== 'undefined' && form != null){
          addConsoleLog("chosen form:" + formID);
          break form;
        }
      }
    }
  };
  if(typeof form === 'undefined' || form == null){
    formID = '';
    addConsoleLog("regular form not found");
  }

  //Manage page builder
  formWidebundle = document.querySelector("#new-form");
  if(formWidebundle != null){
    gempageWB = 1;
    formID = 'page builder';
    addConsoleLog("we found form for page builder");
    //Hide variants from Gempages
    if(formWidebundle.closest(".AddToCartForm") != null){
      if(formWidebundle.closest(".AddToCartForm").querySelector('gf_variants-wrapper') != null){
        formWidebundle.closest(".AddToCartForm").querySelector('gf_variants-wrapper').style.display = "none";
      }
    }
  }
  else{
    gempageWB = 0;
  }

  multipleFormsWB = document.querySelectorAll('.new-wb-form');
  if(multipleFormsWB.length > 0){
    pageBuilderClassWB = 1;
    formID2 = '.new-wb-form';
    addConsoleLog("using form class");
  }
  else{
    pageBuilderClassWB = 0;
  }

  //Custom form selection
  if(formID == "form[action='/cart/add']"){
    if(form.querySelector('h2[itemprop="name"]') != null && form.querySelector('.product__price-container') != null){
      if(form.querySelector('.product-details .add-to-cart-btn') != null){
        form = form.querySelector('.product-details');
      }
    }
  }


  //Hide unwanted elements
  if(formID == 'page builder'){
    if(document.querySelector('.gt_product-swatches.gt_flex.gt_variant_product') != null){
      document.querySelector('.gt_product-swatches.gt_flex.gt_variant_product').style.display = 'none';
      if(document.querySelector('.button_add_to_cart.gt_product-addtocart') != null){
        document.querySelector('.button_add_to_cart.gt_product-addtocart').style.display = 'none';
      }
      if(document.querySelector('.gt_flex.gt_variant_product') != null){
        document.querySelector('.gt_flex.gt_variant_product').style.display = 'none';
      }
    }
    if(document.querySelector('.gt_product-content button[data-name="Product Button"]') != null){
      document.querySelector('.gt_product-content button[data-name="Product Button"]').style.display = "none";
      style = '.gt_product-content button[data-name="Product Button"]{display:none !important;}';
      addStyle(style);
    }
  }

  /*formID = "page builder";
  formWidebundle = true;*/

  const firstArrayOfSelectors = [
    'div[data-pf-type="ProductVariant"]',
    'div[data-pf-type="ProductVariantSwatches"]',
    'div[data-label="(P) Quantity"]',
    'button.gt_button--product',
    '.gt_product-variant.gt_product-swatches',
    'div[data-pf-type="ProductQuantity"]',
    '.qty_near_atc_wrapper',
    'button[data-pf-type="ProductATC"]'
  ];

  const hideElementWithSelectorFromFirstArray = function(array) {
    array.forEach(el => {
      if(formID == "page builder" || formID == ".new-wb-form"){
        if(formWidebundle != null){
          if(document.querySelector(el) != null){
            forms = document.querySelectorAll('form');
            for(i = 0; i < forms.length; i++){
              if(isDescendant(forms[i], formWidebundle)){
                variants = forms[i].querySelector(el);
                if(variants != null){
                  variants.style.display = "none";
                  break;
                }
              }
            }
          }
        }
      }
    })
  };

  hideElementWithSelectorFromFirstArray(firstArrayOfSelectors);

  const arrayForHideElementWithParentNodeOneLevel = [
    'div[data-pf-type="ProductVariantSwatches"]',
    'button[data-pf-type="ProductATC"]',
    'div[data-label="(P) Variants"]',
    'div[data-label="(P) Cart Button"]'
  ];

  const hideElementWithParentNodeOneLevel= function (array) {
    
    if (a = b) {
      if (c == d) {

      }
    }
    if (a!=b) {
      continue;
    }
    if 
    array.forEach(el => {
      if(formID == "page builder" || formID == ".new-wb-form"){
        if(formWidebundle != null){
          if(document.querySelector(el) != null){
            if(document.querySelector(el).parentNode != null){
              if(isDescendant(document.querySelector(el).parentNode, formWidebundle)){
                document.querySelector(el).style.display = "none";
              }
            }
          }
        }
      }
    })
  };

  hideElementWithParentNodeOneLevel(arrayForHideElementWithParentNodeOneLevel);

  const arrayForHideElementWithParentNodeTwoLevel = [
    '.zpa-add-to-cart-btn',
    '.zpa-selector-wrapper',
  ];

  const hideElementWithParentNodeTwoLevel= function (array) {
    array.forEach(el => {
      if(formID == "page builder" || formID == ".new-wb-form"){
        if(formWidebundle != null){
          if(document.querySelector(el) != null){
            if(document.querySelector(el).parentNode != null){
              if(isDescendant(document.querySelector(el).parentNode.parentNode, formWidebundle)){
                document.querySelector(el).style.display = "none";
              }
            }
          }
        }
      }
    })
  };

  hideElementWithParentNodeTwoLevel(arrayForHideElementWithParentNodeTwoLevel);

  const thirdArrayOfSelectors = [
    '.gt_product-swatches',
    '.gt_product-variant',
    '.gt_product-quantity',
    '.gt_product-addtocart',
    '.gt_button-atc'
  ];

  const hideElementWithSelectorFromThirdArray = function (array) {
    array.forEach(el => {
      if(formID == "page builder"){
        if(document.querySelector(el) != null){
          document.querySelector(el).style.display = "none";
        }
      }
    })
  };

  hideElementWithSelectorFromThirdArray(thirdArrayOfSelectors);

  const fourthArrayOfSelectors = [
    '.dbtfy-color_swatches',
    '.product-layout-grid__detail .product-detail__options',
    '.product__info-wrapper variant-radios',
    'div[data-variant-picker]',
    '.product-detail__form__options.product-detail__gap-lg.product-detail__form__options--underlined',
    '.product-block-container .product-block.product-block-variant-picker:not(.pb-card-shadow)',
    '.product-block-container .product-block.product-block-quantity-selector:not(.pb-card-shadow)',
    '.product-form__quantity',
    '.product-block-item.atc-wrapper',
    '.product__quantity',
    '.product-form product-variants',
    '.tt-swatches-container',
    '.product__quantity',
    '.product-info__quantity-selector',
    'variant-picker',
    'product-page product-variants',
    '.product__variants-wrapper.product__block',
    '.product__controls-group-quantity.product__block',
    '.product-options--root',
    '.quantity_selector',
    '.productView-subtotal',
    '.productView-options',
  ];

  const hideElementWithSelectorFromFourthArray = function (array) {
    array.forEach(el => {
      if(document.querySelector(el) != null){
        document.querySelector(el).style.display = "none";
      }
    })
  };

  hideElementWithSelectorFromFourthArray(fourthArrayOfSelectors);

  const fifthArrayOfSelectors = [
    '.product-block .variant-wrapper',
    '.product__info-container variant-radios',
    '.pt-swatches-container.pt-swatches-container-js',
    '.product__info-container variant-selects',
    '.product__info-wrapper variant-selects'
  ];
  const hideElementWithSelectorFromFifthArray = function (array) {
    array.forEach(el => {
      if(document.querySelector(el) != null){
        for(var i = 0; i<document.querySelectorAll(el).length; i++){
          document.querySelectorAll(el)[i].style.display = "none";
        }
      }
    })
  }
  hideElementWithSelectorFromFifthArray(fifthArrayOfSelectors);

  const sixthArrayOfSelectors = [
    'fieldset.product-form__input'
  ];
  const hideElementWithSelectorFromSixthArray = function (array) {
    array.forEach(el => {
      if(document.querySelector(el) != null){
        if(!isDescendant(form, document.querySelector(el))){
          document.querySelector(el).style.display = "none";
        }
      }
    })
  }
  hideElementWithSelectorFromSixthArray(sixthArrayOfSelectors);

  if(formID == "page builder"){
    if(formWidebundle != null){
      if(document.querySelector('div[data-pf-type="ProductQuantity"]') != null){
        layouts = document.querySelectorAll('div[data-pf-type="Layout"]');
        for(i=0; i<layouts.length; i++){
          if(isDescendant(layouts[i], formWidebundle)){
            variants = layouts[i].querySelector('div[data-pf-type="ProductQuantity"]');
            if(variants != null){
              variants.style.display = "none";
              break;
            }
          }
        }
      }
    }
  }
  if(document.querySelector('.product-form__buy-buttons product-payment-container .product-form__add-button') != null){
    document.querySelector('.product-form__buy-buttons product-payment-container').style.visibility = "hidden";
    document.querySelector('.product-form__buy-buttons product-payment-container').style.display = "block";
    addStyle('.product-form__buy-buttons product-payment-container{display: block !important;}');
  }
  if(document.querySelector('.product-single__meta .variant-wrapper--button') != null){
    document.querySelector('.product-single__meta .variant-wrapper--button').style.visibility = "hidden";
    document.querySelector('.product-single__meta .variant-wrapper--button').style.height = "0px";
    document.querySelector('.product-single__meta .variant-wrapper--button').style.width = "0px";
  }

  if(formID == 'form[data-type="add-to-cart-form"].form'){
    style = ".product-form__input{display:none;}"
    addStyle(style);
  }
  var styles = '#product-sticky__btn-sticky-wrapper, .product-sticky__btn-button-container { display: none !important; }';
  addStyle(styles);


  //Take elements outside the form so that they aren't hidden

  if(typeof form != 'undefined' && typeof formSubmitWB != "undefined"){
    selectID = getSelectID(form);
    for(i=0; i<formSubmitWB.length; i++){
      buttonFound = form.querySelector(formSubmitWB[i]);
      if(buttonFound != null){
        break;
      }
    }
  }
  else if(typeof formWidebundle != 'undefined' && formWidebundle != null){
    selectID = getSelectID(formWidebundle);
  }

  //put out elements
  elementsToShow = [
    '.main-product__block-title', '.main-product__block-price', '.main-product__block-custom_liquid', '.main-product__block-collapsible_tab', '.main-product__block-description',
    '.prod_secure_img', '.editor_line_wrap_s_content_below_atc', '.editor_line_wrap_content_below_atc', '#pretty-product-pages', ".product-description-header",
    ".product-page--pricing", ".product-description-wrapper", "#w3-product-accessories", '.product-single__description_page', '.product-block-item .timer_wrapper',
    '.faq-container', '.webyzeProductColorsLabel', '.webyzeProductColors', '#ZlistWishlist', '.product-block-item .under_cta_atc', '.product-meta__description', '.product-meta__text',
    '.shopify-block.shopify-app-block', '.product-single__description', '.collapsibles-wrapper', '.Footer__PaymentListt', '.additional-checkout-text', '#cubynDeliveryBadge', '.product-meta__title',
    'a[href="#looxReviews"]', '.ProductMeta(.ProductMeta__Title)', '.product-block-item(.tabsWrapper)', '.product-block-item(.product-single__desc)', '.size_guide__link_above',
    '.product-block-item(.product-single__title)', '.product-block-item(.product-single__stars)', '.product-block-item(.price-container)', '.slick-testi-product(.testi-review)',

    '.icon-benefits(.cv-icon-benefit)', 'product__title', 'product__price--holder', 'product__description', '.product__title', '.product__price--holder', '.product__description', 'h2.product-price',
    '.product-description', '.product-tabs', '.product-block-item .product-single__title', '.product-block-item .product-single__stars', '.product-block-item .price-container', '.product-block-item .product-single__desc',
    'lh-content-title', 'lh-review', 'lh-price-block', 'lh-product-introduce', '.product__title--ppTitle', '.loox-rating', '.product__price--ppPrice', '.product__urgency',
    '.product__countdown--holder', '.short-info', '.ProductMeta__Rating', '.colors-list-wrap .colors-list', '.storeFeatures', '.nm-easyorder-custom-button', '.review-widget', '.htusb-placeholder-countdown', '#alireview-review-widget-badge',
    'product-single__description', '.ProductMeta .ProductMeta__Title', '.ProductMeta .ProductMeta__PriceList', '.ProductMeta .ProductMeta__UnitPriceMeasurement',
    '.ProductMeta_Description', 'product-single__description_page', '.product-meta__label-list',
// need to test it:
    '.icon-benefits(.cv-icon-benefit)', '.product-short-description', '.product-price-container', '.alr-display-review-badge', '.product_title', '.sale-point', '.visitor-counter-content-box-carecartbysalespop-2020',
    '.Footer__PaymentList', '.Product__Tabs(.Collapsible__Content)', '.product-block-item(.fa-box-check)', '.product-block-item(h3)', '.product-page-info__title', '.product-page-info__price', '.product-page-info__reviews','.best-fit-size-chart',
    '.html-cart(.fa)'
//
  ];

  if((typeof selectID != "undefined" && selectID != "") || (typeof buttonFound != "undefined" && buttonFound != null)){
    if(selectID != "undefined" && selectID != ""){
      variantPosition = document.querySelector(selectID).getBoundingClientRect().top;
    }
    else{
      variantPosition = buttonFound.getBoundingClientRect().top;
    }
    if(typeof variantPosition != "undefined" && variantPosition != ""){
      elementsAboveVariants = [];
      elementsBelowVariants = [];

      for(y=0; y<elementsToShow.length; y++){
        testHasChild = elementsToShow[y].split('(');
        hasChild = "";
        if(testHasChild.length > 1){
          theElementToShow = testHasChild[0];
          hasChild = testHasChild[1].split(')')[0];
        }
        else{
          theElementToShow = elementsToShow[y];
        }
        var newNodeToShow = form.querySelectorAll(theElementToShow);
        if(newNodeToShow.length > 0){
          for(i=0; i<newNodeToShow.length; i++){
            console.log(newNodeToShow[i].getBoundingClientRect().top);
            if(hasChild == "" || newNodeToShow[i].querySelector(hasChild) != null){
              if(newNodeToShow[i].getBoundingClientRect().top < variantPosition){
                elementsAboveVariants.push(newNodeToShow[i]);
              }
              else{
                elementsBelowVariants.push(newNodeToShow[i]);
              }
            }
          }
        }
      }

      if(elementsAboveVariants.length > 0 || elementsBelowVariants.length > 0){
        elementsAboveVariants.sort(function(a, b) {
          return a.getBoundingClientRect().top - b.getBoundingClientRect().top;
        });
        elementsBelowVariants.sort(function(a, b) {
          return b.getBoundingClientRect().top - a.getBoundingClientRect().top;
        });

        var parentDiv = form.parentNode;
        for(i=0; i<elementsAboveVariants.length; i++){
          parentDiv.insertBefore(elementsAboveVariants[i], form);
        }
        for(i=0; i<elementsBelowVariants.length; i++){
          parentDiv.insertBefore(elementsBelowVariants[i], form.nextSibling);
        }
      }
    }
  }

  if(typeof form !== 'undefined' && form != null){
    var newNode1 = form.querySelector('.colors-list-wrap .colors-list');
    if(newNode1 != null){
      var parentDiv = form.parentNode;
      parentDiv.insertBefore(form.querySelector('.colors-list-wrap'), form);
    }
  }

  if(typeof form !== 'undefined' && form != null){
    var newNode1 = form.querySelector('.fastlane-faq-a2');
    if(newNode1 != null){
      newNode1 = form.querySelector('.fastlane-faq-a2').parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode;
      if(newNode1 != null && newNode1.classList.contains('editor_line_wrap_content_below_atc')){
        var parentDiv = form.parentNode;
        parentDiv.insertBefore(newNode1, form.nextSibling);
      }
    }
  }
  if(typeof form !== 'undefined' && form != null){
    var newNode1 = form.querySelector('#ImageUploaderContainer');
    if(newNode1 != null){
      var parentDiv = document.querySelector('#new-form');
      parentDiv.insertBefore(newNode1, document.querySelector('#new-form-atc'));
    }
  }

  window.addEventListener('load', function () {
    countCheckEvery300Ms = 0;
    var checkEvery300Ms = setInterval(function() {
      if(typeof form !== 'undefined' && form != null){
        customLink = form.querySelector(".sc-link");
        if(customLink != null){
          var parentDiv = form.parentNode;
          parentDiv.insertBefore(customLink, form);
          clearInterval(checkEvery300Ms);
        }
      }
      countCheckEvery300Ms++;
      if(countCheckEvery300Ms >= 30){
        clearInterval(checkEvery300Ms);
      }
    }, 300);
  })
  window.addEventListener('load', function () {
    countCheckEveryHide1 = 0;
    var countCheckEveryHide1 = setInterval(function() {
      if(typeof form !== 'undefined' && form != null){
        if(document.querySelector('.product-detail .product-form.theme-init .option-selectors') != null){
          document.querySelector('.product-detail .product-form.theme-init .option-selectors').style.display = "none";
          clearInterval(countCheckEveryHide1);
        }
      }
      countCheckEveryHide1++;
      if(countCheckEveryHide1 >= 30){
        clearInterval(countCheckEveryHide1);
      }
    }, 300);
  })
  if(typeof form !== 'undefined' && form != null){
    var newNode1 = form.querySelector('product-single__description');
    if(newNode1 != null){
      var parentDiv = form.parentNode;
      parentDiv.insertBefore(newNode1, form.nextSibling);
    }
  }
  if(formID == ".ProductForm"){
    var titleNode = form.querySelector('.ProductMeta .ProductMeta__Title');
    var priceNode = form.querySelector('.ProductMeta .ProductMeta__PriceList');
    var priceUniteNode = form.querySelector('.ProductMeta .ProductMeta__UnitPriceMeasurement');
    var descNode = form.querySelector('.ProductMeta__Description');
    if(titleNode != null && priceNode != null && priceUniteNode != null){
      var parentDiv = form.parentNode;
      priceNode.style.display = "block";
      parentDiv.insertBefore(titleNode, form);
      parentDiv.insertBefore(priceNode, form);
      parentDiv.insertBefore(priceUniteNode, form);
    }
    if(descNode != null){
      var parentDiv = form.parentNode;
      parentDiv.insertBefore(descNode, form.nextSibling);
    }
  }
  if(typeof form !== 'undefined' && form != null){
    if(form.querySelector('.best-fit-size-chart') != null){
      var newNode1 = form.querySelector('.best-fit-size-chart');
      if(newNode1 != undefined){
        var parentDiv = form.parentNode;
        parentDiv.insertBefore(newNode1, form.nextSibling);
      }
    }
  }
  if(typeof form !== 'undefined' && form != null){
    if(form.querySelector('#paypal-button-container') != null){
      var newNode1 = form.querySelector('#paypal-button-container');
      if(newNode1 != undefined){
        var parentDiv = form.parentNode;
        parentDiv.insertBefore(newNode1, form.nextSibling);
      }
    }
  }
  window.addEventListener('load', function () {
    countCheckEvery300Ms2 = 0;
    var checkEvery300Ms2 = setInterval(function() {
      //Contra reembolso
      if(typeof form !== 'undefined' && form != null){
        if(form.querySelector('.webyzeProductColors') != null){
          var newNode1 = form.querySelector('.webyzeProductColors');
          if(newNode1 != undefined){
            var parentDiv = form.parentNode;
            parentDiv.insertBefore(newNode1, form);
          }
        }
      }
      countCheckEvery300Ms2++;
      if(countCheckEvery300Ms2 >= 30){
        clearInterval(checkEvery300Ms2);
      }
    }, 300);
  })

  window.addEventListener('load', function () {
    countCheckEvery300MsElementToMove = 0;
    var checkEvery300MsElementToMove = setInterval(function() {
      //Contra reembolso
      if(typeof form !== 'undefined' && form != null){
        if(form.querySelector('.best-fit-size-chart') != null){
          var newNode1 = form.querySelector('.best-fit-size-chart');
          if(newNode1 != undefined){
            buttonWBCPB = document.querySelector('#new-form-atc');
            buttonWBCPB.parentNode.insertBefore(newNode1, buttonWBCPB.nextSibling);
            newNode1.style.display = "block";
          }
        }
      }
      countCheckEvery300MsElementToMove++;
      if(countCheckEvery300MsElementToMove >= 300){
        clearInterval(checkEvery300MsElementToMove);
      }
    }, 300);
  })
  if(typeof form !== 'undefined' && form != null){
    if(form.querySelector('.price_container .modal_price') != null){
      var newNode1 = form.querySelector('.price_container .modal_price');
      if(newNode1 != undefined){
        var parentDiv = form.parentNode;
        parentDiv.insertBefore(newNode1, form);
      }
    }
  }
  try{
    if(typeof window.tysloEasysellConfig != "undefined" && window.tysloEasysellConfig.settings.form_type != "undefined"){
      //window.addEventListener('load', function () {
      countCheckEvery300MsSELL = 0;
      var checkEvery300MsSELL = setInterval(function() {
        //Contra reembolso
        if(typeof form !== 'undefined' && form != null){
          if(document.querySelector('#easysell') != null){
            if(window.tysloEasysellConfig.settings.form_type == "native"){
              var newNode1 = document.querySelector('#easysell');
              if(newNode1 != undefined){
                ourform = document.querySelector('#new-form');
                var parentDiv = ourform.parentNode;
                parentDiv.insertBefore(newNode1, ourform.nextSibling);
              }
            }
          }
          if(document.querySelector('#es-popup-button') != null){
            if(window.tysloEasysellConfig.settings.form_type == "popup" && typeof formWB != "undefined" && formWB){
              var newNode1 = formWB.querySelector('#es-popup-button');
              if(newNode1 != undefined){
                ourform = formWB.querySelector('.new-form-atc');
                var parentDiv = ourform.parentNode;
                parentDiv.insertBefore(newNode1, ourform.nextSibling);
                clearInterval(checkEvery300MsSELL);
              }
            }
          }
        }
        countCheckEvery300MsSELL++;
        if(countCheckEvery300MsSELL >= 200){
          clearInterval(checkEvery300MsSELL);
        }
      }, 300);
      //})
    }
  }
  catch(error){
    console.log("problem");
  }
  //window.addEventListener('load', function () {

  countCheckEvery300Ms3 = 0;
  var checkEvery300Ms3 = setInterval(function() {
    //Contra reembolso
    if(typeof form !== 'undefined' && form != null){
      if(form.querySelector('#cpb-button') != null){
        var newNode1 = form.querySelector('#cpb-button');
        if(typeof newNode1 != "undefined" && newNode1 != null){

          const styles = window.getComputedStyle(newNode1);
          let cssText = styles.cssText;
          if (!cssText) {
            cssText = Array.from(styles).reduce((str, property) => {
              return `${str}${property}:${styles.getPropertyValue(property)};`;
            }, '');
          }
          newNode1.style.cssText = cssText;

          var parentDiv = form.parentNode;
          /*if(form.nextSibling.nextSibling != null){
            parentDiv.insertBefore(newNode1, form.nextSibling.nextSibling);
            clearInterval(checkEvery300Ms3);
          }
          else{*/
          buttonWBCPB = document.querySelector('#new-form-atc');
          if(buttonWBCPB.nextSibling != null){
            buttonWBCPB.parentNode.insertBefore(newNode1, buttonWBCPB.nextSibling);
          }
          else{
            buttonWBCPB.parentNode.append(newNode1);
          }
          clearInterval(checkEvery300Ms3);
          //}
        }
      }
    }
    countCheckEvery300Ms3++;
    if(countCheckEvery300Ms3 >= 200){
      clearInterval(checkEvery300Ms3);
    }
  }, 300);
//  })
  window.addEventListener('load', function () {
    countCheckEvery300Ms4 = 0;
    var checkEvery300Ms4 = setInterval(function() {
      //Contra reembolso
      if(typeof form !== 'undefined' && form != null){
        if(form.querySelector('afterpay-placement') != null){
          var newNode1 = form.querySelector('afterpay-placement');
          if(newNode1 != undefined){
            var parentDiv = form.parentNode;
            if(form.nextSibling.nextSibling != null){
              parentDiv.insertBefore(newNode1, form.nextSibling.nextSibling);
              clearInterval(checkEvery300Ms4);
            }
          }
        }
      }
      countCheckEvery300Ms4++;
      if(countCheckEvery300Ms4 >= 30){
        clearInterval(checkEvery300Ms4);
      }
    }, 300);
  })
  window.addEventListener('load', function () {
    countCheckEvery300Ms5 = 0;
    var checkEvery300Ms5 = setInterval(function() {
      //Contra reembolso
      if(typeof form !== 'undefined' && form != null){
        if(form.querySelector('.htusb-ui-prod-boost-trust-wrapper') != null){
          var newNode1 = form.querySelector('.htusb-ui-prod-boost-trust-wrapper');
          if(newNode1 != undefined){
            var parentDiv = form.parentNode;
            if(form.nextSibling.nextSibling != null){
              parentDiv.insertBefore(newNode1, form.nextSibling.nextSibling);
              clearInterval(checkEvery300Ms5);
            }
          }
        }
        if(form.querySelector('.htusb-ui-prod-boost-generic-under-form') != null){
          var newNode1 = form.querySelector('.htusb-ui-prod-boost-generic-under-form');
          if(newNode1 != undefined){
            var parentDiv = form.parentNode;
            if(form.nextSibling.nextSibling != null){
              parentDiv.insertBefore(newNode1, form.nextSibling.nextSibling);
              clearInterval(checkEvery300Ms5);
            }
          }
        }
      }
      countCheckEvery300Ms5++;
      if(countCheckEvery300Ms5 >= 30){
        clearInterval(checkEvery300Ms5);
      }
    }, 300);
  })
  window.addEventListener('load', function () {
    countCheckEvery300Ms6 = 0;
    var checkEvery300Ms6 = setInterval(function() {
      //Contra reembolso
      if(typeof form !== 'undefined' && form != null){
        /*if(form.querySelector('._rsi-buy-now-button._rsi-buy-now-button-product') != null){
          var newNode1 = form.querySelector('._rsi-buy-now-button._rsi-buy-now-button-product');
          widebundle = document.querySelector('#new-form-atc');
          if(newNode1 != undefined){
            var parentDiv = widebundle.parentNode;
            parentDiv.insertBefore(newNode1, widebundle.nextSibling);
            newNode1.style.display = "block";
            clearInterval(checkEvery300Ms6);
          }
        }*/
        if(form.querySelector('._rsi-buy-now-button._rsi-buy-now-button-product') != null){
          var originalNode = form.querySelector('._rsi-buy-now-button._rsi-buy-now-button-product');
          var newNode = originalNode.cloneNode(true);
          widebundle = document.querySelector('#new-form-atc');
          if(originalNode != undefined){
            var parentDiv = widebundle.parentNode;
            parentDiv.insertBefore(newNode, widebundle.nextSibling);
            newNode.style.display = "block";
            newNode.addEventListener('click', function() {
              originalNode.click();
            });
            clearInterval(checkEvery300Ms6);
          }
        }
      }
      countCheckEvery300Ms6++;
      if(countCheckEvery300Ms6 >= 30){
        clearInterval(checkEvery300Ms6);
      }
    }, 300);
  })
  window.addEventListener('load', function () {
    countCheckEvery300Ms7 = 0;
    var checkEvery300Ms7 = setInterval(function() {
      if(typeof form !== 'undefined' && form != null){
        var newNode1 = form.querySelector('.pbp-points');
        if(newNode1 != null){
          var parentDiv = form.parentNode;
          parentDiv.insertBefore(newNode1, form.nextSibling.nextSibling);
        }
      }
      countCheckEvery300Ms7++;
      if(countCheckEvery300Ms7 >= 30){
        clearInterval(checkEvery300Ms7);
      }
    }, 300);
  })
  window.addEventListener('load', function () {
    countCheckEvery300Ms8 = 0;
    var checkEvery300Ms8 = setInterval(function() {
      if(typeof form !== 'undefined' && form != null){
        var newNode1 = form.querySelector('.QuickPurchaseTop');
        if(newNode1 != null){
          var parentDiv = form.parentNode;
          parentDiv.insertBefore(newNode1, form.nextSibling.nextSibling);
          newNode1.style.display = "block";
        }
      }
      countCheckEvery300Ms8++;
      if(countCheckEvery300Ms8 >= 30){
        clearInterval(checkEvery300Ms8);
      }
    }, 300);
  })
  /*window.addEventListener('load', function () {
    countCheckEvery300Ms9 = 0;
    var checkEvery300Ms9 = setInterval(function() {
      if(typeof form !== 'undefined' && form != null){
        var newNode1 = form.querySelector('.sealsubs-full');
        if(newNode1 != null){
          var parentDiv = form.parentNode;
          parentDiv.insertBefore(newNode1, form.nextSibling.nextSibling);
          newNode1.style.display = "block";
        }
      }
      countCheckEvery300Ms9++;
      if(countCheckEvery300Ms9 >= 30){
        clearInterval(checkEvery300Ms9);
      }
    }, 300);
  })*/
  window.addEventListener('load', function () {
    countCheckEvery300Ms10 = 0;
    var checkEvery300Ms10 = setInterval(function() {
      if(typeof form !== 'undefined' && form != null){
        var newNode1 = form.querySelector('#ultimateTrustBadgeswidgetDiv');
        if(newNode1 != null){
          var parentDiv = form.parentNode;
          parentDiv.insertBefore(newNode1, form.nextSibling.nextSibling);
          newNode1.style.display = "block";
        }
      }
      countCheckEvery300Ms10++;
      if(countCheckEvery300Ms10 >= 30){
        clearInterval(checkEvery300Ms10);
      }
    }, 300);
  })
  window.addEventListener('load', function () {
    countCheckEvery300Ms12 = 0;
    var checkEvery300Ms12 = setInterval(function() {
      if(typeof form !== 'undefined' && form != null){
        var newNode1 = form.querySelector('.visitor-counter-content-box-carecartbysalespop-2020');
        if(newNode1 != null){
          buttonWBCPB = document.querySelector('#new-form-atc');
          buttonWBCPB.parentNode.insertBefore(newNode1, buttonWBCPB.nextSibling);
        }
      }
      countCheckEvery300Ms12++;
      if(countCheckEvery300Ms12 >= 30){
        clearInterval(checkEvery300Ms12);
      }
    }, 300);
  })

  window.addEventListener('load', function () {
    countCheckEvery300Ms13 = 0;
    var checkEvery300Ms13 = setInterval(function() {
      if(typeof form !== 'undefined' && form != null && formID != "page builder"){
        var newNode1 = form.querySelector('.jdgm-preview-badge');
        if(newNode1 != null){
          var parentDiv = form.parentNode;
          parentDiv.insertBefore(newNode1, form);
          newNode1.style.display = "block";
        }
      }
      countCheckEvery300Ms13++;
      if(countCheckEvery300Ms13 >= 30){
        clearInterval(checkEvery300Ms13);
      }
    }, 300);
  });
  window.addEventListener('load', function () {
    countCheckEvery300Ms14 = 0;
    var checkEvery300Ms14 = setInterval(function() {
      if(typeof form !== 'undefined' && form != null){
        var newNode1 = form.querySelector('.delivery-time');
        if(newNode1 != null){
          buttonWBCPB = document.querySelector('#new-form-atc');
          buttonWBCPB.parentNode.insertBefore(newNode1, buttonWBCPB);
        }
      }
      countCheckEvery300Ms14++;
      if(countCheckEvery300Ms14 >= 30){
        clearInterval(checkEvery300Ms14);
      }
    }, 300);
  });

  window.addEventListener('load', function () {
    countCheckEvery300MsAxe = 0;
    var checkEvery300MsAxe = setInterval(function() {
      if(typeof form !== 'undefined' && form != null){
        var newNode1 = document.querySelector('.axe-checkbox');
        if(newNode1 != null){
          buttonWBCPB = document.querySelector('#new-form-atc');
          buttonWBCPB.parentNode.insertBefore(newNode1, buttonWBCPB);
        }
      }
      countCheckEvery300MsAxe++;
      if(countCheckEvery300MsAxe >= 30){
        clearInterval(checkEvery300MsAxe);
      }
    }, 300);
  });

  if(typeof form !== 'undefined' && form != null){
    var newNode1 = form.querySelector('#product-price');
    if(newNode1 != undefined){
      var parentDiv = form.parentNode;
      parentDiv.insertBefore(newNode1, form);
    }
  }
  if(typeof document.querySelectorAll('.pg__option--single')[0] !== 'undefined'){
    for(var i = 0; i<document.querySelectorAll('.pg__option--single').length; i++){
      document.querySelectorAll('.pg__option--single')[i].style.display = 'none';
    }
  }

  if(shopWB['form_id']!=formID){
    //Put informations in db
    var http = new XMLHttpRequest();
    var url = websiteWB+'AJAX/GetForm.php';
    var params = 'form='+formID+'&shop='+shopWB['shop'];
    http.open('POST', url, true);
    http.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
    http.onreadystatechange = function() {
      if(http.readyState == 4 && http.status == 200) {
      }
    }
    http.send(params);
    shopWB['form_id'] = formID;
  }

  //Set the new variable
  if(typeof form == "undefined"){
    formWB = null;
  }
  else{
    formWB = form;
  }
  if(formWB == null && formWidebundle != null){
    formWB = formWidebundle;
  }

}

function preSelectOffer(){
  window.preSelectedVar = 0;
  for(var xWB=0;xWB<preSelected.length;xWB++){
    if(preSelected[xWB] == 1){
      preSelectedVar = xWB;
      break;
    }
  }

  try{
    //Check if the url already has variant selected
    var query = window.location.search.substring(1);
    var qs = parse_query_string(query);
    if(qs.variant){
      wbChoices = getWBChoices(qs.variant);
    };
  }
  catch(error){
    console.error(error);
  }

  document.getElementById('new-form').getElementsByClassName('new-form-option')[preSelectedVar].classList.add('selectedWB');
  document.getElementById('new-form').getElementsByClassName('new-form-option')[preSelectedVar].classList.remove('selectable');
  for(y=0; y<document.querySelectorAll('.new-wb-form').length; y++){
    document.querySelectorAll('.new-wb-form')[y].getElementsByClassName('new-form-option')[preSelectedVar].classList.add('selectedWB');
    document.querySelectorAll('.new-wb-form')[y].getElementsByClassName('new-form-option')[preSelectedVar].classList.remove('selectable');
  }
  updatePriceOnSelect();
  idSelected = document.getElementsByClassName('selectedWB')[0].getAttribute('data-id');
  nameSelected = idOptions1[idSelected];

  if(nameSelected == ''){
    window.addEventListener('load', DisplaySelNew, false);
    function DisplaySelNew(){
      idSelected = document.getElementsByClassName('selectedWB')[0].getAttribute('data-id');
      nameSelected = idOptions1[idSelected];
      DisplaySelWB();
    }
  }

  DisplaySelWB();

  try{
    if(qs.variant){
      if(wbChoices != ""){
        if(typeof wbChoices[0] != "undefined"){
          for(i=0; i<wbChoices[0].length; i++){
            document.querySelectorAll('.selectedWB .select-option-second')[i].value = wbChoices[0][i];
          }
        }
        if(typeof wbChoices[1] != "undefined"){
          for(i=0; i<wbChoices[1].length; i++){
            document.querySelectorAll('.selectedWB .select-option-third')[i].value = wbChoices[1][i];
          }
        }
      }
    };
  }
  catch(error){
    console.error(error);
  }
}

function addBlinkingEffect(){
  var clignotement2 = function(){
    if(typeof document.getElementsByClassName('best-title-blink')[0] !== 'undefined'){
      if(document.getElementsByClassName('best-title-blink')[0].style.opacity=='1'){
        for(xWB=0;xWB<document.getElementsByClassName('best-title-blink').length;xWB++){
          document.getElementsByClassName('best-title-blink')[xWB].style.opacity = '0';
        }
      }
      else{
        for(xWB=0;xWB<document.getElementsByClassName('best-title-blink').length;xWB++){
          document.getElementsByClassName('best-title-blink')[xWB].style.opacity = '1';
        }
      }
    }
  };
  periode2WideBundle = setInterval(clignotement2, 800);
}

function UpdateQuantityWB(){
  var spinsWB = document.getElementsByClassName('spinWB');
  for (var i = 0; i < spinsWB.length; i++){

    spinsWB[i].getElementsByClassName('quantity-wb-input')[0].onchange = function(){
      if(isNaN(this.value.replace(',', '.'))){
        var spinsWBElement = document.getElementsByClassName('spinWB');
        for (var j = 0; j < spinsWBElement.length; j++){
          spinsWBElement[j].getElementsByClassName('quantity-wb-input')[0].value = 1;
        }
      }
      else{
        var spinsWBElement = document.getElementsByClassName('spinWB');
        for (var j = 0; j < spinsWBElement.length; j++){
          spinsWBElement[j].getElementsByClassName('quantity-wb-input')[0].value = Math.round(this.value.replace(',', '.'));
        }
      }

      quantityNumberWB = this.value;
      if(formWB.querySelectorAll('[name=quantity]')[0] != undefined){
        formWB.querySelectorAll('[name=quantity]')[0].value = quantityNumberWB;
      }
      else if(formWB.querySelectorAll('select[data-quantity-select]')[0] != undefined){
        formWB.querySelectorAll('select[data-quantity-select]')[0].value = quantityNumberWB;
      }
      else if(document.querySelector('div[data-pf-type="Layout"] div[data-pf-type="ProductQuantity"] input') != null){
        document.querySelector('div[data-pf-type="Layout"] div[data-pf-type="ProductQuantity"] input').value = quantityNumberWB;
      }
      else if(document.querySelector('.gf_product-quantity input[name="quantity"]') != null){
        document.querySelector('.gf_product-quantity input[name="quantity"]').value = quantityNumberWB;
      }
    };

    spinsWB[i].getElementsByClassName('quantity-wb-less')[0].addEventListener("click", function(){
      var spinsWBElement = document.getElementsByClassName('spinWB');
      for (var j = 0; j < spinsWBElement.length; j++){
        spinsWBElement[j].getElementsByClassName('quantity-wb-input')[0].value = Math.max(1, spinsWBElement[j].getElementsByClassName('quantity-wb-input')[0].value -1);
      }

      quantityNumberWB = document.getElementsByClassName('spinWB')[0].getElementsByTagName('input')[0].value;
      if(formWB.querySelectorAll('[name=quantity]')[0] != undefined){
        formWB.querySelectorAll('[name=quantity]')[0].value = quantityNumberWB;
      }
      else if(document.querySelectorAll('quantity-input [name=quantity]')[0] != undefined){
        document.querySelectorAll('quantity-input [name=quantity]')[0].value = quantityNumberWB;
      }
      else if(formWB.querySelectorAll('select[data-quantity-select]')[0] != undefined){
        formWB.querySelectorAll('select[data-quantity-select]')[0].value = quantityNumberWB;
      }
      else if(document.querySelector('div[data-pf-type="Layout"] div[data-pf-type="ProductQuantity"] input') != null){
        document.querySelector('div[data-pf-type="Layout"] div[data-pf-type="ProductQuantity"] input').value = quantityNumberWB;
      }
      else if(document.querySelector('.gf_product-quantity input[name="quantity"]') != null){
        document.querySelector('.gf_product-quantity input[name="quantity"]').value = quantityNumberWB;
      }
    });

    spinsWB[i].getElementsByClassName('quantity-wb-more')[0].addEventListener("click", function(){
      var spinsWBElement = document.getElementsByClassName('spinWB');
      for (var j = 0; j < spinsWBElement.length; j++){
        spinsWBElement[j].getElementsByClassName('quantity-wb-input')[0].value -= -1;
      }

      quantityNumberWB = document.getElementsByClassName('spinWB')[0].getElementsByTagName('input')[0].value;
      if(formWB.querySelectorAll('[name=quantity]')[0] != undefined){
        formWB.querySelectorAll('[name=quantity]')[0].value = quantityNumberWB;
      }
      else if(document.querySelectorAll('quantity-input [name=quantity]')[0] != undefined){
        document.querySelectorAll('quantity-input [name=quantity]')[0].value = quantityNumberWB;
      }
      else if(formWB.querySelectorAll('select[data-quantity-select]')[0] != undefined){
        formWB.querySelectorAll('select[data-quantity-select]')[0].value = quantityNumberWB;
      }
      else if(document.querySelector('div[data-pf-type="Layout"] div[data-pf-type="ProductQuantity"] input') != null){
        document.querySelector('div[data-pf-type="Layout"] div[data-pf-type="ProductQuantity"] input').value = quantityNumberWB;
      }
      else if(document.querySelector('.gf_product-quantity input[name="quantity"]') != null){
        document.querySelector('.gf_product-quantity input[name="quantity"]').value = quantityNumberWB;
      }
    });
  }
}

function getSalesWB(){
  if(window.location.href.indexOf('/checkouts/') > -1){
    if(typeof Shopify.Checkout != 'undefined'){
      variantSold = "";
      productsSold = "";
      for(i=0; i<Shopify.checkout.line_items.length; i++){
        itemSold = Shopify.checkout.line_items[i];
        variantSold == "" ? variantSold += itemSold.variant_id + ":" + itemSold.quantity + ":" + itemSold.product_id : variantSold += "," + itemSold.variant_id + ":" + itemSold.quantity + ":" + itemSold.product_id;
      }

      var http = new XMLHttpRequest();
      var url = websiteWB+'AJAX/GetSales.php';
      var params = 'shop='+encodeURI(shopWB['shop'])+'&amount='+encodeURI(Shopify.checkout.subtotal_price)+'&order_id='+encodeURI(Shopify.checkout.order_id)+'&currency_format='+encodeURI(Shopify.checkout.currency)+'&variant_sold='+encodeURI(variantSold)+'&total_payment='+encodeURI(Shopify.checkout.payment_due);
      http.open('POST', url, true);
      http.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
      http.onreadystatechange = function() {
          if(http.readyState == 4 && http.status == 200) {
          }
      }
      http.send(params);
    }
  }
}

function addMainStyle(){
    styleWB = `
     #new-form,
     .new-wb-form {
      max-width: 700px;
      margin: auto;
     }
    .product--no-media product-form.product-form{display: block !important;}
    #new-form .jumpstart-selector .arrow{display: none !important;}
    #new-form .jumpstart-selector select{-webkit-appearance: auto; appearance: auto;}
    .product-detail .product-form.theme-init .option-selectors{
      display: none !important;
    }
    .p-title-WB__content {
      text-align: left;
      color: black;
      font-size: 0.9em;
    }
    .new-form-option{
      display:flex;
      align-items:center;
      padding: 10px 10px 10px 0px;
      cursor:pointer;
      border-radius:5px;
      margin-bottom:15px;
      border:2px solid #c6c6c6;
      transition: background-color: 0.1s ease, border 0.1 ease
    }

    .new-form-option .value-left{
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
    }
    .checkedWB{
      display: block;
      width: 17px;
      height: 17px;
      border: 3px solid #f4f4f4;
      background-color: #f4f4f4;
      border-radius: 50%;
      margin-left: 10px;
      margin-right: 10px;
    }
    .thumbnailWB{
      width: 60px;
      border: 1px solid #e9e9e9;
      border-radius: 5px;
      margin-right: 10px;
    }
    .value-left{
      min-width: 40px;
    }
    .offer-image{
      min-width: 108px;
    }
    .value-right{
      text-align: left;
    }
    .title-variant{
      font-size: 1.2em;
      text-transform: none;
      text-align: left;
      margin: 0;
      color: ${shopWB['offer_color']};
    }
    .best-title-new{
      font-size: 0.9em;
      line-height: 1;
      color: ${shopWB['color_best']};
      transition: opacity 0.5s ease;
      font-weight: bold;
    }
    .price-new-form{
      text-align: left;
      width: auto;
      font-size: ${shopWB['price_size']};
      margin: 0px;
      margin-bottom: 0px;
    }
    span.money.first-price-WB, .first-price-WB{
      color: ${shopWB['price_color']} !important;
      margin-right: 5px;
    }
    span.money.second-price-WB, .second-price-WB{
      color: ${shopWB['price_compared_color']} !important;
      text-decoration: line-through !important;
    }
    .crossed-price-WB{
      color: inherit;
      text-decoration: line-through !important;
    }
    .doubly.second-price-WB, .money.second-price-WB{
      color: ${shopWB['price_compared_color']};
      text-decoration: line-through !important;
    }

    .spinWB{
      display: flex;
      width: 80px;
      margin-top: 20px;
      display: none;
      margin-bottom: 20px;
      flex: 0 0 80px;
      margin-left: auto;
    }
    .quantity-wb-less{
      border-radius: 4px 0px 0px 4px;
      background-color: ${shopWB['bg_button_quantity']};
      color: ${shopWB['color_button_quantity']};
      border: 1px solid #dadada;
      display: inline-block;
      width: 33%;
      padding-top:0px;
      padding-bottom:0px;
      text-align: center;
      cursor: pointer;
      vertical-align: 1.5px;
    }
    .quantity-wb-more{
      border-radius:0px 4px 4px 0px;
      background-color: ${shopWB['bg_button_quantity']};
      color: ${shopWB['color_button_quantity']};
      border: 1px solid #dadada;
      display: inline-block;
      width: 33%;
      padding-top:0px;
      padding-bottom:0px;
      text-align: center;
      cursor: pointer;
      vertical-align: 1.5px;
    }
    #new-form .quantity-wb-input, .new-wb-form .quantity-wb-input{
      -webkit-appearance: none;
      -moz-appearance: none;
      background-color: ${shopWB['bg_input_quantity']};
      color: ${shopWB['color_input_quantity']};
      appearance: none;
      width: 34%;
      text-align: center;
      font-weight: bold;
      border: 1px solid #dadada;
      border-left: 0;
      border-right: 0;
      padding-left:0px;
      padding-right:0px;
      padding-top: 0px;
      padding-bottom: 0px;
      align-self: stretch;
    }
    .div-select2:first-of-type{
      margin-top: 10px;
    }
    #new-form .select-option-third, .new-wb-form .select-option-third{
      margin:0;
      line-height:23px;
      position:static;
      opacity:1;
      display:block;
      background-position: right 10px center !important;
      border-radius:3px;
      border: 1px solid ${shopWB['border_color']};
      font-size:16px;
      float:left;
      min-width:100px;
      max-width:auto;
      width:auto;
      min-height:25px;
      height:25px;
      padding:0;
      padding-left:3px;
      padding-right:25px;
      margin-left:5px;
      color:black;
    }
    /*#new-form select{
      -webkit-appearance: menulist-button;
      -moz-appearance: menulist-button;
    }*/
    #new-form .select-option-second, .new-wb-form .select-option-second{
      line-height:23px;
      position:static;
      opacity:1;
      display:block;
      background-position: right 10px center !important;
      border-radius:3px;
      border: 1px solid ${shopWB['border_color']};
      font-size:16px;
      float:left;
      min-width:100px;
      max-width:auto;
      width:auto;
      min-height:25px;
      height:25px;
      padding:0;
      padding-left:3px;
      padding-right:25px;
      margin:0;
      color:black;
    }
    #new-form .pretty-select, .new-wb-form .pretty-select{
      padding: 0px 0px 0px 0px;
    }
    #new-form .disclosure .disclosure__toggle svg, .pretty-select svg, .new-wb-form .disclosure .disclosure__togle svg{
      display: none;
    }
    .title-option-wb{
      color: ${shopWB['option_color']};
      font-size:0.8em;
      margin:0;
      margin-top:3px;
      margin-right:5px;
      margin-bottom:10px;
      float:left;
    }
    .clear{
      margin:0;
      clear:both;
      margin-top: 0px !important;
      margin-bottom: 0px !important;
    }
    .economic-wb{
      margin-top: 0px;
      margin-bottom: 0px;
      font-size: 0.9em;
      color: ${shopWB['economic_color']};
    }

    #new-form-atc, .new-form-atc{
      width: 100%;
      cursor: pointer;
      background-color: ${shopWB['atc_background']};
      color: ${shopWB['atc_color']};
      border-radius: ${shopWB['atc_radius']};
      text-align: center;
      font-size: ${shopWB['atc_font_size']};
      margin-top: 10px;
      margin-bottom: 15px;
      ${shopWB['atc_size'] == 'small' ? 'padding: 10px 0 10px 0;' : ''}
      ${shopWB['atc_size'] == 'medium' ? 'padding: 20px 0 20px 0;' : ''}
      ${shopWB['atc_size'] == 'large' ? 'padding: 30px 0 30px 0;' : ''}
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      ${shopWB['atc_font'] != 'auto' ? 'font-family: ' + shopWB['atc_font'] : ''}
    }

    #new-form-atc:hover, .new-form-atc:hover{
      background-color: ${shopWB['hover_color']};
    }

    .before-code-wb{
      margin-top: 10px;
    }

    .selectable{
      background-color: transparent;
      font-weight: normal;
      border: 2px solid #c6c6c6;
    }
    .selectable .title-variant{
      color: ${shopWB['offer_color']};
    }
    .selectable span.money.first-price-WB, .selectable .first-price-WB{
      color: ${shopWB['price_color']} !important;
    }
    .selectable span.money.second-price-WB, .selectable .second-price-WB{
      color: ${shopWB['price_compared_color']} !important
    }
    .selectable economic-wb{
      color: ${shopWB['economic_color']};
    }
    .selectable .best-title{
      color: ${shopWB['color_best']};
    }
    .selectable .checkedWB{
      background-color: #f4f4f4;
    }
    .selectable .div-select2{
      display: none;
    }
    .selectable .spinWB{
      display: none;
    }
    .selectable .money{
      font-weight: normal !important;
    }

    .selectedWB{
      background-color: ${shopWB['background_color']};
      border: 2px solid ${shopWB['border_color']};
      font-weight: bold;
    }
    .selectedWB .title-variant{
      color: ${shopWB['offer_selected_color']};
      ${shopWB['style_title_selected'] == 'none' ? 'font-style: normal !important;font-weight: normal !important;' : ''};
      ${shopWB['style_title_selected'] == 'bold' ? 'font-style: normal !important;font-weight: bold !important;' : ''};
      ${shopWB['style_title_selected'] == 'italic' ? 'font-style: italic !important;font-weight: normal !important;' : ''};
      ${shopWB['style_title_selected'] == 'bold-italic' ? 'font-style: italic !important;font-weight: bold !important;' : ''};
    }
    .selectedWB span.money.first-price-WB, .selectedWB .first-price-WB{
      color: ${shopWB['price_selected_color']} !important;
      ${shopWB['style_price_selected'] == 'none' ? 'font-style: normal !important;font-weight: normal !important;' : ''};
      ${shopWB['style_price_selected'] == 'bold' ? 'font-style: normal !important;font-weight: bold !important;' : ''};
      ${shopWB['style_price_selected'] == 'italic' ? 'font-style: italic !important;font-weight: normal !important;' : ''};
      ${shopWB['style_price_selected'] == 'bold-italic' ? 'font-style: italic !important;font-weight: bold !important;' : ''};
    }
    .selectedWB span.money.second-price-WB, .selectedWB .second-price-WB{
      color: ${shopWB['price_compared_selected_color']} !important;
      ${shopWB['style_compared_price_selected'] == 'none' ? 'font-style: normal !important;font-weight: normal !important;' : ''};
      ${shopWB['style_compared_price_selected'] == 'bold' ? 'font-style: normal !important;font-weight: bold !important;' : ''};
      ${shopWB['style_compared_price_selected'] == 'italic' ? 'font-style: italic !important;font-weight: normal !important;' : ''};
      ${shopWB['style_compared_price_selected'] == 'bold-italic' ? 'font-style: italic !important;font-weight: bold !important;' : ''};
    }
    .selectedWB .economic-wb{
      color: ${shopWB['economic_selected_color']};
      ${shopWB['style_economic_selected'] == 'none' ? 'font-style: normal !important;font-weight: normal !important;' : ''};
      ${shopWB['style_economic_selected'] == 'bold' ? 'font-style: normal !important;font-weight: bold !important;' : ''};
      ${shopWB['style_economic_selected'] == 'italic' ? 'font-style: italic !important;font-weight: normal !important;' : ''};
      ${shopWB['style_economic_selected'] == 'bold-italic' ? 'font-style: italic !important;font-weight: bold !important;' : ''};
    }
    .selectedWB .best-title{
      color: ${shopWB['best_selected_color']};
    }
    .selectedWB .checkedWB{
      background-color: ${shopWB['border_color']};
    }
    .selectedWB .best-title-new{
      ${shopWB['style_blinking_selected'] == 'none' ? 'font-style: normal !important;font-weight: normal !important;' : ''};
      ${shopWB['style_blinking_selected'] == 'bold' ? 'font-style: normal !important;font-weight: bold !important;' : ''};
      ${shopWB['style_blinking_selected'] == 'italic' ? 'font-style: italic !important;font-weight: normal !important;' : ''};
      ${shopWB['style_blinking_selected'] == 'bold-italic' ? 'font-style: italic !important;font-weight: bold !important;' : ''};
    }
    .selectedWB .span-economic-wb{
      ${shopWB['style_economic_selected'] == 'none' ? 'font-style: normal !important;font-weight: normal !important;' : ''};
      ${shopWB['style_economic_selected'] == 'bold' ? 'font-style: normal !important;font-weight: bold !important;' : ''};
      ${shopWB['style_economic_selected'] == 'italic' ? 'font-style: italic !important;font-weight: normal !important;' : ''};
      ${shopWB['style_economic_selected'] == 'bold-italic' ? 'font-style: italic !important;font-weight: bold !important;' : ''};
    }
    .selectedWB .div-select2{
      ${shopWB['style_variants_selected'] == 'none' ? 'font-style: normal !important;font-weight: normal !important;' : ''};
      ${shopWB['style_variants_selected'] == 'bold' ? 'font-style: normal !important;font-weight: bold !important;' : ''};
      ${shopWB['style_variants_selected'] == 'italic' ? 'font-style: italic !important;font-weight: normal !important;' : ''};
      ${shopWB['style_variants_selected'] == 'bold-italic' ? 'font-style: italic !important;font-weight: bold !important;' : ''};
    }


    .selectable .best-title-new{
      ${shopWB['style_blinking'] == 'none' ? 'font-style: normal !important;font-weight: normal !important;' : ''};
      ${shopWB['style_blinking'] == 'bold' ? 'font-style: normal !important;font-weight: bold !important;' : ''};
      ${shopWB['style_blinking'] == 'italic' ? 'font-style: italic !important;font-weight: normal !important;' : ''};
      ${shopWB['style_blinking'] == 'bold-italic' ? 'font-style: italic !important;font-weight: bold !important;' : ''};
    }
    .selectable .span-economic-wb{
      ${shopWB['style_economic'] == 'none' ? 'font-style: normal !important;font-weight: normal !important;' : ''};
      ${shopWB['style_economic'] == 'bold' ? 'font-style: normal !important;font-weight: bold !important;' : ''};
      ${shopWB['style_economic'] == 'italic' ? 'font-style: italic !important;font-weight: normal !important;' : ''};
      ${shopWB['style_economic'] == 'bold-italic' ? 'font-style: italic !important;font-weight: bold !important;' : ''};
    }
    .selectable .div-select2{
      ${shopWB['style_variants'] == 'none' ? 'font-style: normal !important;font-weight: normal !important;' : ''};
      ${shopWB['style_variants'] == 'bold' ? 'font-style: normal !important;font-weight: bold !important;' : ''};
      ${shopWB['style_variants'] == 'italic' ? 'font-style: italic !important;font-weight: normal !important;' : ''};
      ${shopWB['style_variants'] == 'bold-italic' ? 'font-style: italic !important;font-weight: bold !important;' : ''};
    }
    .selectable .title-variant{
      color: ${shopWB['offer_color']};
      ${shopWB['style_title'] == 'none' ? 'font-style: normal !important;font-weight: normal !important;' : ''};
      ${shopWB['style_title'] == 'bold' ? 'font-style: normal !important;font-weight: bold !important;' : ''};
      ${shopWB['style_title'] == 'italic' ? 'font-style: italic !important;font-weight: normal !important;' : ''};
      ${shopWB['style_title'] == 'bold-italic' ? 'font-style: italic !important;font-weight: bold !important;' : ''};
    }
    .selectable span.money.first-price-WB, .selectable .first-price-WB{
      ${shopWB['style_price'] == 'none' ? 'font-style: normal !important;font-weight: normal !important;' : ''};
      ${shopWB['style_price'] == 'bold' ? 'font-style: normal !important;font-weight: bold !important;' : ''};
      ${shopWB['style_price'] == 'italic' ? 'font-style: italic !important;font-weight: normal !important;' : ''};
      ${shopWB['style_price'] == 'bold-italic' ? 'font-style: italic !important;font-weight: bold !important;' : ''};
    }
    .selectable span.money.second-price-WB, .selectable .second-price-WB{
      ${shopWB['style_compared_price'] == 'none' ? 'font-style: normal !important;font-weight: normal !important;' : ''};
      ${shopWB['style_compared_price']  == 'bold' ? 'font-style: normal !important;font-weight: bold !important;' : ''};
      ${shopWB['style_compared_price']  == 'italic' ? 'font-style: italic !important;font-weight: normal !important;' : ''};
      ${shopWB['style_compared_price']  == 'bold-italic' ? 'font-style: italic !important;font-weight: bold !important;' : ''};
    }
    .selectable .economic-wb{
      ${shopWB['style_economic'] == 'none' ? 'font-style: normal !important;font-weight: normal !important;' : ''};
      ${shopWB['style_economic'] == 'bold' ? 'font-style: normal !important;font-weight: bold !important;' : ''};
      ${shopWB['style_economic'] == 'italic' ? 'font-style: italic !important;font-weight: normal !important;' : ''};
      ${shopWB['style_economic'] == 'bold-italic' ? 'font-style: italic !important;font-weight: bold !important;' : ''};
    }

    .selectedWB .spinWB{
      display: flex;
    }
    .selectedWB .money{
      //font-weight: bold !important;
    }

    .hide-bloc-wb{
      display: none !important;
    }

    #new-form .loading-wb{
      width: 20px;
      height: 20px;
    }

    #cont-trustbadge-wb, .cont-trustbadge-wb{
      text-align: center;
      width: 80%;
      margin: auto;
    }
    #after-code-wb{
      margin-top: 10px;
    }

    #new-form p:empty{
      display: block;
    }

    .d-flex.form-wb-selected{
      display: none !important;
    }
    
    /*.selectable{
      transition: transform .5s ease-out, box-shadow .5s ease-out;
    }

    .selectable:hover{
      transform: scale(1.05);
      -webkit-box-shadow: 0px 1px 11px -2px rgba(0,0,0,0.16);
      box-shadow: 0px 1px 11px -2px rgba(0,0,0,0.16);
    }

    .selectedWB{
      transform: scale(1.05);
      -webkit-box-shadow: 0px 1px 11px -2px rgba(0,0,0,0.16);
      box-shadow: 0px 1px 11px -2px rgba(0,0,0,0.16);
    }*/
  `;
    addStyle(styleWB);
}

function UpdateStyleWB(design, priceSize){

    //NORMAL DESIGN
    if(design == 0){
        if(displayQuantityWB == 1){
            styleWB = `
        .value-left .offer-image{
          min-width: 110px !important;
        }
        .selectedWB{
          position: relative;
          padding-bottom: 10px;
        }
        .spinWB{
          position: static;
          height: 30px;
          right: 5px;
          bottom: 5px;
          margin: 0px;
          margin-left: auto;
        }
        .quantity-wb-input{
          height: 30px;
        }
        .selectedWB .spinWB span{
          padding-top: 0px;
        }
        .selectable{
          padding-bottom: 10px;
        }

        @media screen and (max-width: 400px){
          .selectedWB{
            position: relative;
            padding-bottom: 40px;
          }
          .spinWB{
            position: absolute;
            height: 25px;
            right: 5px;
            bottom: 5px;
            margin: 0px;
          }
          .quantity-wb-input{
            height: 25px;
          }
          .selectedWB .spinWB span{
            padding-top: 0px;
          }
        }
      `;
            addStyle(styleWB);
        }
    }

    //VERTICAL DESIGN
    else if(design == 1){

        styleWB = `
      .title-variant{
        font-size: 1em;
        text-align: center;
        margin-top: 10px;
      }
      .price-new-form{
        font-size: ${priceSize};
        text-align: center;
      }
    `;

        if(displayQuantityWB == 1){
            styleWB += `
        .selectedWB{
          position: relative;
          padding-bottom: 5px;
        }
        .selectedWB .spinWB{
          position: static;
          height: 30px;
          right: 5px;
          bottom: 5px;
          margin: auto;
          margin-top: 10px;
        }
        .selectedWB .quantity-wb-input{
          height: 30px;
          line-height: 30px;
        }
        .selectedWB .spinWB span{
          padding-top: 0px;
        }
        .selectable{
          padding-bottom: 5px;
        }
      `;
        }

        styleWB += `
      .best-title{
        width: 100%;
        text-align: center;
        display: block;
        margin-top: 10px;
      }
      .economic-wb{
        font-size: 0.8em;
        text-align: center;
      }
      .p-title-WB{
        width: 100%;
        flex-basis: 100%;
      }
      #new-form, .new-wb-form{
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
      }
      .new-form-option{
        display: block;
        padding: 10px 10px 10px 10px;
        margin: 7px;
        flex: 1;
      }
      .value-right{
        max-width: 100%;
      }
      .value-left{
        display: block;
      }
      .value-left img{
        margin: 0;
      }
      .checkedWB{
        margin: auto;
        margin-top: 5px;
        margin-bottom: 10px;
      }
      .select-class-second{
        margin: 0;
      }
      .selectedWB .div-select2{
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: 5px;
        justify-content: center;
      }
      .selectedWB .div-select2 p{
        margin-top: 7px;
        margin-bottom: 3px;
      }
      .selectable{
        border: 2px solid #dadada;
      }
      .new-form-option .value-left{
        flex-direction: column;
      }
    `;
        addStyle(styleWB);

    }

    //LIGHT line
    else if(design == 2){

        styleWB = `
      .offer-image{
        min-width: 90px;
      }
      .new-form-option img{
        width: 40px;
      }
      .new-form-option{
        position: relative;
        padding: 5px 10px 5px 0px;
      }
      .title-variant{
        font-size: 1em;
      }
      .new-form-option .price-new-form{
        margin-left: auto;
        margin-bottom: 0px;
        padding-left: 10px;
        text-align: right;
      }
    `;

        if(displayQuantityWB == 1){
            styleWB += `
        .spinWB{
          margin-top: 5px;
          margin-bottom: 5px;
          margin-left: 10px;
        }
        .selectedWB{
          position: relative;
          padding-bottom: 5px;
        }
        .selectedWB .spinWB{
          position: static;
          height: 30px;
          right: 5px;
          bottom: 5px;
          margin: 0px;
          margin-left: 5px;
        }
        .selectedWB .quantity-wb-input{
          height: 30px;
        }
        .selectedWB .spinWB span{
          padding-top: 0px;
        }
        .selectable{
          padding-bottom: 5px;
        }
      `;
        }

        styleWB += `
      .economic-wb{
        margin-top: 0px;
        margin-bottom: 0px;
      }
      span.money.first-price-WB, .first-price-WB{
        margin-right: 0px;
        white-space: nowrap;
        overflow: hidden;
      }
      span.money.second-price-WB, .second-price-WB{
        margin-left: 5px;
        white-space: nowrap;
        overflow:hidden;
      }
      .div-select2{
        margin-top: 5px;
      }
      .checkedWB{
        width: 12px;
        height: 12px;
        border: 2px solid rgb(244, 244, 244);
      }
      .title-option-wb{
        margin-bottom: 0px;
      }

      @media screen and (max-width: 600px){
        .title-option-wb{
          width: 100%;
          margin-bottom: 0px;
        }
      }

      @media screen and (max-width: 400px){
        .select-option-third{
          margin-top: 2px;
          margin-left: 0px;
        }
        .select-option-second{
          float: none;
        }
      }
    `;

        if(displayQuantityWB == 1){
            styleWB += `
        @media screen and (max-width: 400px){
          .selectedWB{
            position: relative;
            padding-bottom: 40px;
          }
          .selectedWB .spinWB{
            position: absolute;
            height: 25px;
            right: 5px;
            bottom: 5px;
          }
          .selectedWB .quantity-wb-input{
            height: 25px;
          }
          .selectedWB .spinWB span{
            padding-top: 0px;
          }
        }
      `;
        }

        addStyle(styleWB);

        //Deplace nodes element where we want
        var elemsWB = document.querySelectorAll('.new-form-option .price-new-form');
        for (var i = 0; i < elemsWB.length; i++) {
            offerNode = elemsWB[i].parentNode.parentNode;
            offerNode.appendChild(elemsWB[i]);
            if(displayQuantityWB == 1){
                quantityElem = document.querySelectorAll('.spinWB')[i];
                offerNode.appendChild(quantityElem);
            }
        }
    }

    //SPECIAL VERSION
    else if(design == 3){

        styleWB = `
      .new-form-option .price-new-form{
        margin-left: auto;
        margin-bottom: 0px;
        padding-left: 10px;
        text-align: right;
        display: flex;
        flex-direction: column;
      }
    `;

        if(displayQuantityWB == 1){
            styleWB += `
        .spinWB{
          margin-top: 5px;
          margin-bottom: 5px;
          margin-left: 10px;
        }
        .selectedWB{
          position: relative;
          padding-bottom: 5px;
        }
        .selectedWB .spinWB{
          position: static;
          height: 30px;
          right: 5px;
          bottom: 5px;
          margin: 0px;
          margin-left: 5px;
        }
        .selectedWB .quantity-wb-input{
          height: 30px;
        }
        .selectedWB .spinWB span{
          padding-top: 5px;
        }
        .selectable{
          padding-bottom: 5px;
        }
      `;
        }

        styleWB += `
      span.money.first-price-WB, .first-price-WB{
        margin-right: 0px;
        white-space: nowrap;
        overflow: hidden;
      }
      span.money.second-price-WB, .second-price-WB{
        margin-left: 5px;
        white-space: nowrap;
        overflow: hidden;
      }
      .new-form-option{
        position: relative;
        padding: 5px 10px 5px 0px;
      }
      .with-message .div-select2{
        margin-top: 10px;
      }
      .with-message .title-variant{
        margin-bottom: -5px;
      }
      .economic-wb{
        margin-top: 0px;
        margin-bottom: 0px;
        position: absolute;
        bottom: -25px;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: ${shopWB['border_color']};
        padding: 3px 40px 3px 40px;
        border-radius: 5px;
        white-space: nowrap;
        overflow: hidden;
      }
      .with-economic-text{
        padding-bottom: 20px;
        margin-bottom: 18px;
      }
      /*:not(.with-economic-text) .value-right{
        padding-bottom: 20px;
      }*/
      .value-right.with-message{
        padding-bottom: 20px;
      }

      @media screen and (max-width: 600px){
        .title-option-wb{
          margin-bottom: 0px;
        }
        .has-double-select .title-option-wb{
          width: 100%;
        }
        .offer-image img{
          width: 40px;
        }
        .offer-image{
          min-width: 90px;
        }
        .title-variant{
          font-size: 1em;
        }
      }

      @media screen and (max-width: 400px){
        .select-option-third{
          margin-top: 2px;
          margin-left: 0px;
        }
        .select-option-second{
          float: none;
        }
      }
    `;

        if(displayQuantityWB == 1){
            styleWB += `
        @media screen and (max-width: 400px){
          .selectedWB{
            position: relative;
            padding-bottom: 40px;
          }
          .selectedWB .spinWB{
            position: absolute;
            height: 25px;
            right: 5px;
            bottom: 20px;
          }
          .selectedWB .quantity-wb-input{
            height: 25px;
          }
          .selectedWB .spinWB span{
            padding-top: 0px;
          }
        }
      `;
        }

        addStyle(styleWB);

        //Deplace nodes prices and quantity element where we want
        var elemsWB = document.querySelectorAll('.new-form-option .price-new-form');
        for (var i = 0; i < elemsWB.length; i++) {
            offerNode = elemsWB[i].parentNode.parentNode;
            offerNode.appendChild(elemsWB[i]);
            if(displayQuantityWB == 1){
                quantityElem = document.querySelectorAll('.spinWB')[i];
                offerNode.appendChild(quantityElem);
            }
        }
        //Deplace message
        /*var elemsWB = document.getElementsByClassName('best-title');
        for (var i = 0; i < elemsWB.length; i++) {
          valueRight = elemsWB[i].parentNode;
          valueRight.insertBefore(elemsWB[i], valueRight.querySelector('.title-variant').nextSibling);
        }*/
        //Deplace economic text
        var elemsWB = document.querySelectorAll('.new-form-option .economic-wb');
        for (var i = 0; i < elemsWB.length; i++) {
            elemsWB[i].closest('.new-form-option').appendChild(elemsWB[i]);
        }
    }


}

function AddCustomCodeWB(css){
    addStyle(css);
}

function createWidget(){ //This is the first function that is called by scripttag.php to create the main div of the app
  var newForm = document.createElement('div');
  newForm.id = 'new-form';
  formWB.parentNode.insertBefore(newForm, formWB.nextSibling); //We place the script right after formWB, which is the product form that was detected on the page
  hideWBForm(); //We use the function to hide the product form so it's not duplicated with WideBundle
  showFormVar = 0;

  if(formID == ".product-form__buy-buttons .shopify-product-form"){ //For some forms we have a problem with form display none, so instead we use a feature to show the form and just reduce everything to width 0 and height 0
    try{
      showAndReduceForm();
    }
    catch(error){
      console.log('problem');
    }
  }

  window.addEventListener('load', HideFormWB, false); //We had some trouble with some themes where the form was not hidden so we hide it again after window is loaded
  function HideFormWB(){
    setInterval(function(){
      if(showFormVar == 0){
        formWB.style.display = 'none';
        showAndReduceForm();
      }

      if(formID == ".product-form__buy-buttons .shopify-product-form"){
        try{
          showAndReduceForm();
        }
        catch(error){
          console.log('problem');
        }
      }
    }, 1000);
  }

  return newForm; //We return the new div that was created to use it in scripttag.php
}

function hideWBForm(){ //The function to hide the product form
  formWB.style.display = 'none';
  if(formWB.hasChildNodes()){ //We also hide every child
    var children = formWB.childNodes;
    for(var c=0; c < children.length; c++) {
      if(children[c].style) {
        if(children[c].style.visibility != "hidden" && children[c].style.display != "none" && getStyleWB(children[c], "display") != "none"){
            children[c].classList.add('hidden-wb'); //We add a class so we can track elements we hid
        }
        children[c].style.display = 'none';
      }
    }
  }
  showAndReduceForm();
}

function createTitle(elem){ //We add the title
  var titleOption = document.createElement('p');
  titleOption.classList.add('p-title-WB');
  if(elem.hasAttribute('id')) {
    titleOption.innerHTML = "<span id='title-offer-WB' class='p-title-WB__content'>"+titleOffer+"</span>";
  } else {
    titleOption.innerHTML = "<span class='p-title-WB__content'>"+titleOffer+"</span>";
  }
  elem.appendChild(titleOption);

  return titleOption;
}

function createOfferDiv(elem){ //We create the main div for the offer

  var ValueWide = document.createElement('div');
  if(elem.hasAttribute('id')) {
    ValueWide.id = 'id'+attributes[1];
  }
  ValueWide.classList.add('selectable'); //We add the class for "not selected offer" because when a class is selected we add the class "selectedWB"
  ValueWide.classList.add('new-form-option');
  ValueWide.setAttribute('data-id', attributes[1]);
  ValueWide.addEventListener("click", addClickListenerOffer);

  return ValueWide;
}

function addClickListenerOffer(){
  sameNodeWB = 0;
  for(y=0; y<document.querySelectorAll('.selectedWB').length; y++){
    CurrentSelected = document.getElementsByClassName('selectedWB')[y];
    if(this.isSameNode(CurrentSelected)){
      sameNodeWB = 1;
      break;
    }
  }
  if(sameNodeWB == 0){
    //Update the design of selected and not selected offer
    updateDesignOnSelect(this);
    //Update the general price of the store
    updatePriceOnSelect();
    //Add the selects on the offer if it has variants
    DisplaySelWB();
    //Change price
    changePrice(0);
  }
}

function createOfferDivLeft(){ //We create the elements on the left of the offer
  //Create left div
  var valueLeft = document.createElement('div');
  valueLeft.classList.add('value-left');

  //Add the radio
  var check2 = document.createElement('span');
  check2.classList.add('checkedWB');
  valueLeft.append(check2); //We add the little round to show that the offer is selected or not

  //Add thumbnail if it exists
  if(imagesVariant[attributes[0]] != ''){ //Add thumbnail on the offer if it exists in the database
    var imgVar = document.createElement('img');
    imgVar.classList.add('thumbnailWB');
    valueLeft.classList.add('offer-image');
    imgVar.setAttribute('src', imagesVariant[attributes[0]]);
    valueLeft.append(imgVar);
  }

  ValueWide.appendChild(valueLeft);

  return valueLeft;
}

function displayEconomicText(actual_price, old_price){ //We create and display the text "You save X€.." if it's enabled in the database
  if(old_price != '' && shopWB['economic_display'] == 1){ //actual_price is the current price of the variant while old_price is the compare at price, the price of the variant on Shopify before the reduction
    var regp = /[^0-9.,]*(\d+(?:[.,]\d+)?)(?:[^0-9.,]|$)/;
    diff = parseFloat(getAmountFromPrice(old_price).replace(',', '.')) - parseFloat(getAmountFromPrice(actual_price).replace(',', '.')); //We calculate the different between both
    diffPercent = 100 * parseFloat(diff) / parseFloat(getAmountFromPrice(old_price).replace(',', '.')); //We calculate the percentage of difference
    diffPercent = Math.round(diffPercent); //We round the percentage
    diff = diff.toFixed(2); //We round the price so we can have "34.00" or "34.99"
    try{
      if(shopWB['no_decimal'] == 1){ //If they enabled the feature to remove decimal if there is no decimal we run a parseFloat
        diff = parseFloat(diff);
      }
    }
    catch(error){
      console.log('error');
    }
    currencyAlone = actual_price.replace(/\d+.?\d+/g,'{{amount}}'); //We replace everything that is not the currency by {{amount}} so we can then replace {{amount with the price difference}}
    diff = currencyAlone.replace('{{amount}}', diff); //We replace the price difference

    economicText = shopWB['economic_text']; //we set up the text to display "You save X euros"
    economicText = economicText.replace('{{percent}}', '<span class=\'percent-wb\'>'+diffPercent+'</span>').replace('.', shopWB['price_separator']); //We replace the variable {{percent}} with the percent
    economicText = economicText.replace('{{amount}}', '<span class=\'money conversion-bear-money span-economic-wb transcy-money\'>'+diff+'</span>').replace('.', shopWB['price_separator']); //We replace the variable {{amount}} with the diff
    var today = new Date();
    var dd = String(today.getDate()).padStart(2, '0');
    var mm = String(today.getMonth() + 1).padStart(2, '0');
    var yyyy = today.getFullYear();
    today = dd + '/' + mm + '/' + yyyy;
    economicText = economicText.replace('{{today}}', today); //We replace the {{today}} variable with the today's date
    var Economic = document.createElement('p');
    Economic.innerHTML = economicText;
    Economic.classList.add('economic-wb');
    valueRight.appendChild(Economic);
    ValueWide.classList.add('with-economic-text');
  }
}

function displayQuantityWidget(){ //We add the quantity selector if it's enabled in the settings
  if(displayQuantityWB == 1){
    var quantityWB = document.createElement('div');
    quantityWB.classList.add('spinWB');
    quantityHTML = `
      <span class='quantity-wb-less'>&ndash;</span>
      <input class='quantity-wb-input' id='quantity-wb' value='1' />
      <span class='quantity-wb-more'>+</span>
    `;
    quantityWB.innerHTML = quantityHTML;
    ValueWide.append(quantityWB);
  }
}

function createOfferDivRight(){ //We create the part on the right

  //Create the right div inside the offer
  window.valueRight = document.createElement('div');
  valueRight.classList.add('value-right');
  ValueWide.appendChild(valueRight);

  //Create the title of the offer
  titleVariant = document.createElement('p');
  titleVariant.classList.add('title-variant');
  titleVariant.innerHTML = attributes[0];

  //Add custom message
  bestTitleNew = document.createElement('span');
  bestTitleNew.classList.add('best-title');
  bestTitleNew.classList.add('best-title-new');

  //Add price
  var Price = document.createElement('p');
  Price.classList.add('price-new-form');

  //Convert Price if they use Shopify Convert System
  attributes[2] = convertPriceShopify(attributes[2], 1, attributes[1]);
  attributes[3] = convertPriceShopify(attributes[3], 2, attributes[1]);

  //Remove Decimal if they activated in the settings of WideBundle
  attributes[2] = removeDecimal(attributes[2]);
  attributes[3] = removeDecimal(attributes[3]);

  if(attributes[3] != ''){ //Fixing a bug compatibility with a conversion converter app
    classAdded = "money transcy-money";
  }
  else{
    classAdded = "";
  }

  priceHTML = `
    <span class='first-price-WB money conversion-bear-money transcy-money'>
      ${attributes[2].replace('.', shopWB['price_separator'])}
    </span>
    <span class='second-price-WB ${classAdded} conversion-bear-money'>
      <s class="crossed-price-WB">${attributes[3].replace('.', shopWB['price_separator'])}</s>
    </span>
  `
  Price.innerHTML = priceHTML; //We add the price

  //Display the quantity widget if button enabled
  displayQuantityWidget();

  //We put all the values of the options in a new array
  options1Split[attributes[0]] = getSingleOptions(1); //For the 1st option (example: Color)
  options2Split[attributes[0]] = getSingleOptions(2); //For the 2nd option (ewample: Size)

  //Get infos on blinking text
  blinkingInfosWB = blinkingTextWB[unescapeHTML(attributes[0])].split('@@'); //Split the info for the custom message

  if(blinkingInfosWB[2] == 0 && blinkingInfosWB[0] != ''){ //If we display the blinking text above title
    bestTitleNew.innerHTML = blinkingInfosWB[0];
    if(blinkingInfosWB[1] == 1){
      bestTitleNew.classList.add('best-title-blink');
    }
    valueRight.classList.add('with-message');
    valueRight.appendChild(bestTitleNew);
  }

  valueRight.appendChild(titleVariant); //Display the offer of the title
  valueRight.appendChild(Price); //Display the price

  if(blinkingInfosWB[2] == 1 && blinkingInfosWB[0] != ''){ //If we display the belinking text below title
    bestTitleNew.innerHTML = blinkingInfosWB[0];
    if(blinkingInfosWB[1] == 1){
      bestTitleNew.classList.add('best-title-blink');
    }
    valueRight.classList.add('with-message');
    valueRight.appendChild(bestTitleNew);
  }

  displayEconomicText(attributes[2], attributes[3]); //Display the text "You save X euros" if feature enabled + if there is a compared price


  optionsTitleSplit = optionsTitle[attributes[0]].split(','); //Get the labels of the dropdowns that are separated by commas

  for(x=1;x<options1Split[attributes[0]]['number']+1;x++){  //For each row of selects (for example if the offer has 2 products then we'll have 2 rows because we display the dropdowns 2 times so the user can choose 2 different variants)
    var select2 = document.createElement('div');
    select2.id = 'div-second-select-'+attributes[1]+'-'+x;
    select2.classList.add('div-second-select-'+attributes[1]+'-'+x);
    select2.classList.add('div-select2');
    select2.setAttribute('data-id', attributes[1]);
    //If we have an option 2
    if(options2Split[attributes[0]]['options'].length >= 1){
      select3HTML = `<select class='select-bundle select-class-second select-option-third add-option2-${attributes[1]}-${x}' onchange='updateAllFormSelects(this, ".add-option2-${attributes[1]}-${x}");changePrice(0);' name='Variants2' size='1'></select>`;
      select2.classList.add('has-double-select');
    }
    else{
      select3HTML = '';
    }
    select2HTML = `
      <p class='title-option-wb'>${optionsTitleSplit[x-1]}</p>
      <select class='select-bundle select-class-second select-option-second add-option-${attributes[1]}-${x}' onchange='updateAllFormSelects(this, ".add-option-${attributes[1]}-${x}");changePrice(0);'name='Variants' size='1'></select>
      ${select3HTML}
      <p class="clear"></p>
    `;
    select2.innerHTML = select2HTML;
    valueRight.appendChild(select2);
  }

  return valueRight;

}

function addVariantsToForm(variant_id){ //To add the variants selector in the form so the form knows which variant to add to the cart

  selectVariantId = formWB.querySelector('[name="id"]');

  if(selectVariantId != null){
    var options = selectVariantId.querySelectorAll('option');
    for(var i=0; i<options.length; i++){
      if(options[i].value == variant_id){
        options[i].selected = "selected";
      }
    }
    selectVariantId.value = variant_id;
  }
  else{
    let input = document.createElement('input');
    input.setAttribute("type", "hidden");
    input.setAttribute("name", "id");
    input.setAttribute("value", variant_id);
    input.classList.add("wb-variant-selector");
    if(typeof formWB != "undefined" && formWB != null){
      old_input = formWB.querySelectorAll('.wb-variant-selector'); //Remove old one
      for(var a=0; a<old_input.length; a++){
        old_input[a].remove();
      }
      formWB.appendChild(input);
      var inputCopy = input.cloneNode(true);
      formWB.insertBefore(inputCopy, formWB.firstChild);
      return true;
    }
  }
  return false;
}

function addButtonAtcToForm(){
  let atc = document.createElement('button');
  atc.setAttribute("type", "submit");
  atc.setAttribute("name", "add");
  atc.classList.add("wb-atc");
  if(typeof formWB != "undefined" && formWB != null){
    old_atc = formWB.querySelector('.wb-atc'); //Remove old one
    if(old_atc != null){
      old_atc.remove();
    }
    formWB.appendChild(atc);
    return atc;
  }
  return false;
}

/*function openSlideCartApp(){
  if(typeof window.SLIDECART_OPEN != "undefined" && typeof window.SLIDECART_UPDATE != "undefined"){

  }
}*/

//Get the form submit
window.formSubmitWB = [
  ".bettercart_checkout.elm_pos_0", ".bettercart_checkout", ".add-to-cart-first", ".add_to_cart", ".button--add-to-cart", ".shg-btn", "input[type='submit']", ".smart-wrapper .add-to-cart-btn#AddToCartDesk", ".btn--add-to-cart",
".product-form__item--submit .product-form__cart-submit", ".gt_product-button", ".add", "button#addToCartCopy", 'button[data-name="Product Button"]', ".paymentButtonsWrapper button[type='submit']", "button[type='submit']", ".gf_add-to-cart", "button[data-pf-type=\"ProductATC\"]", "button.add-to-cart",
".product-form__submit", "button.single_add_to_cart_button", '.tt-wrapper .btn-addtocart', '#AddToCart', "button[data-pf-type=\"ProductATC2\"]"
];

function addButtonATC(elem){ //Create the add to cart button

  typeof window.ShopifyAnalytics !== 'undefined' ? currencyNAME = window.ShopifyAnalytics.meta.currency : currencyNAME = 'USD'; //Get the currency name

  var buttonATC = document.createElement('div');
  buttonATC.innerHTML = AddSVG(shopWB['svg_size'], shopWB['atc_color'], shopWB['svg_number'])+shopWB['atc_text'];
  buttonATC.setAttribute('data-add-to-cart', '');
  if(elem.hasAttribute('id')) {
    buttonATC.id = 'new-form-atc';
    buttonATC.classList.add('new-form-atc');
  } else {
    buttonATC.classList.add('new-form-atc');
  }
   buttonATC.classList.add('addCart');
  buttonATC.addEventListener("click", addClickListenerATC);

  function addClickListenerATC(){
    for(y=0; y<document.querySelectorAll('.new-form-atc').length; y++){
      document.querySelectorAll('.new-form-atc')[y].style.pointerEvents = 'none';
    }
    addConsoleLog('clicked atc');


    if(linkChoice == 'form'){   //If the user selected the side cart (or cart drawer) in the settings. If they do we'll need to synchronize with the theme and use the Add to cart button of the theme

      let addVariants = addVariantsToForm(getSelectedID()); //Adding the variant selected in the product form

      manageEcomSolidSideCart();  //Manage EcomSolid pagebuilder Side Cart

      if(formID != "page builder" && formID != ".new-wb-form"){ //Fix some problems where it didn't work if form was "display none"
        showAndReduceForm();
      }

      addLoadingATC(); //Add the loading gif

      handleUploadApps(); //Handle app to upload images/text so that we add the elements we need inside the form


      foundButtonWB = 0;
      for(i=0; i<formSubmitWB.length; i++){ //Loop through each elements of the array to find the add to cart button of the theme
        var buttonTested = formWB.querySelector(formSubmitWB[i]);
        if(buttonTested != null){
          console.log(formSubmitWB[i] + " found");
          foundButtonWB = 1;
          window.mobileCheck = function() { //This is a function to detect mobile phones
            let check = false;
            (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
            return check;
          };
          if(window.mobileCheck() == true){ //We had a problem on mobile where we had to click twice on the Add to cart button to make it work. But I fixed the bug just by adding a click to the body before that
            document.body.click();
            if(buttonTested.disabled){
              buttonTested.disabled = false;
            }
            buttonTested.click();
          }
          else{
            document.body.click();
            if(buttonTested.disabled){
              buttonTested.disabled = false;
            }
            buttonTested.click();
          }
          console.log("clicked");
          try{ //formID is the ID of the product form found. If the user added the widget manually the formID will be "page builder". We also had a bug with page builder and double click
            if(formID == "page builder" && (typeof shopWB == "undefined" || (shopWB.shop != "wingle-brand.myshopify.com" && shopWB.shop != "cocoskinfr.myshopify.com" && shopWB.shop != "zipcoo.myshopify.com"))){
              buttonTested.click();
            }
          }
          catch(error){
            console.log(error);
          }
          break;
        }
        if(formSubmitWB[i] == 'button[data-pf-type=\"ProductATC\"]' || formSubmitWB[i] == 'button[data-pf-type=\"ProductATC2\"]' || formSubmitWB[i] == ".gf_add-to-cart" || formSubmitWB[i] == 'button[data-name="Product Button"]'){ //This are buttons only on page builders that we use
          if(formID == "page builder"){
            if(document.querySelector(formSubmitWB[i]) != null){
              if(document.querySelector(formSubmitWB[i]).parentNode != null){
                if(isDescendant(document.querySelector(formSubmitWB[i]).parentNode, formWB)){ //Since we don't have product form on page builders we need to make sure that the button we want to click on is the one next to WideBundle
                  console.log(formSubmitWB[i] + " found");
                  document.querySelector(formSubmitWB[i]).click();
                  break;
                }
                else if(getFormParent(document.querySelector(formSubmitWB[i])) != null && isDescendant(getFormParent(document.querySelector(formSubmitWB[i])), document.querySelector('#new-form-atc'))){
                  console.log(formSubmitWB[i] + " found");
                  document.querySelector(formSubmitWB[i]).click();
                  break;
                }
              }
            }
          }
        }

        /*if(i==formSubmitWB.length - 1){
          let atcToClick = addButtonAtcToForm();
          if(atcToClick){
            atcToClick.click();
          }
        }*/

      }
      //If we didn't find the add-to-cart button
      if(foundButtonWB == 0 && typeof Shopify != "undefined" && typeof Shopify.shop != "undefined" && Shopify.shop == "winxwheels.myshopify.com"){
        if(formID == "page builder"){
          let newButton = document.createElement('button');
          newButton.type = "submit";
          newButton.name = "add";
          newButton.style.display = "none";
          newButton.classList.add("gf_add-to-cart", "product-form-product-template", "button", "btn", "gf_gs-button-cart-button", "gf_gs-button---large", "wb-created-atc");

          let span = document.createElement('span');
          span.innerText = "";
          span.classList.add("AddToCartText");

          newButton.appendChild(span);

          if(typeof formWB != "undefined" && formWB != null && formWB.tagName == "FORM"){
            if(formWB.querySelector('.wb-created-atc') == null){
              formWB.appendChild(newButton);
            }
            formWB.querySelector('.wb-created-atc').click();
          }
        }
      }

      putBackATC(); //Add origin text (when click on previous page)
      return;
    }

    else{ //If they didn't select side cart redirection for the add to cart button

      dataID = getSelectedID(); //Get the ID of the variant selected

      managePixel(); //Set ATC event on social network pixels

      addLoadingATC(); //Add loading gif

      baseUrl = getBaseUrlWB();
      link='https://' + window.parent.location.host + baseUrl +linkChoice; //Craft the link to redirect the customer
      if(typeof quantityNumberWB == 'undefined'){ //if for some reason we don't have the quantity of the offers we added to the cart
        quantityNumberWB = 1;
      }
      itemsAtcWB = {items: [{quantity: quantityNumberWB,id: dataID}]}; //Prepare the json to add the product to the cart
      var xhr = new XMLHttpRequest();
      xhr.open('POST', '/cart/add.js', true); //Use Shopify front end API to add items to the cart
      xhr.setRequestHeader('Content-type', 'application/json');
      xhr.onload = function () { //When the product was added to the cart

        manageKlaviyoPixel(); //For the event add to cart from Klaviyo

        if(typeof initiateRaidFunnelByVariant !== 'undefined'){ //Manage an upsell app to open the app after the product was added to the cart
          if(initiateRaidFunnelByVariant(dataID) == true){
            return;
          }
        }

        else if(typeof app !== 'undefined' && typeof app.showModal !== 'undefined'){ //Manage an upsell app to open the app after the product was added to the cart
          app.showModal = true;
          app.configs[0].value=app.getThemeQuantity();
          app.isCart=false;
        }

        else if(linkChoice == 'checkout'){ //If the user selected checkout redirection in the WideBundle settings for the add to cart button
          putBackATC(); //Add back the elements on the add to cart button
          checkoutXA = document.createElement('a'); //Create a checkout link so we can click on it and redirect to the checkout. We are not using anymore this.
          checkoutXA.id = 'checkout-x-aa';
          checkoutXA.href = '/checkout';
          try{ //Manage the app Transcy to create a custom checkout link with the locale in the url
            if(typeof _transcy != 'undefined'){
              if(typeof _transcy.variants.localeCurrent != 'undefined' && typeof _transcy.variants.localeDefault != 'undefined'){
                if(_transcy.variants.localeCurrent != _transcy.variants.localeDefault){
                  if(_transcy.variants.localeDefault != ''){
                    checkoutXA.href = '/' + _transcy.variants.localeCurrent + '/checkout';
                  }
                }
              }
            }
          }
          catch(error){
            console.log(error);
          }

          try{ //Manage the app Weglot to create a custom checkout link with the locale in the url
            if(typeof Weglot != 'undefined'){
              if(typeof Weglot.getCurrentLang() != 'undefined' && Weglot.getCurrentLang() != ''){
                checkoutXA.href = '/checkout?locale=' + Weglot.getCurrentLang();
              }
            }
          }
          catch(error){
            console.log(error);
          }
          checkoutXA.style.color = 'black'; //The following style are useless because we don't use them anymore
          checkoutXA.style.fontSize = '18px';
          checkoutXA.innerHTML = 'checkout';
          checkoutXA.style.marginTop = '50px';
          checkoutXA.style.marginBottom = '50px';
          checkoutXA.style.display = 'none';
          document.body.append(checkoutXA); //We paste this checkout button but don't use it

          document.body.click(); //Manage the double click problem on some themes
          if(document.querySelector('#checkout-xx-aa') != "null"){ //Get the checkout link we created in scripttag.php. We create it in scripttag because some apps add codes to all links redirecting to checkout. So they add codes to our link too
            document.querySelector('#checkout-xx-aa').click(); //Click on it
          }
          else{
            document.getElementById('checkout-x-aa').click(); //If we didn't find the button we created in scripttag.php (just in case) then we ues the link we just created before
          }
          document.body.click(); //Manage double click problem
          checkoutXA.style.display = 'none';
          try{ //Manage double click for fastlane and turbo theme but now with the click on body I think we don't have that problem anymore
            shopifyThemeWB = Shopify.theme.name;
            if(shopifyThemeWB.toLowerCase().indexOf('fastlane') > -1 || shopifyThemeWB.toLowerCase().indexOf('turbo') > -1 || shopifyThemeWB.toLowerCase().indexOf('elomus') > -1){
              addConsoleLog('second click');
              document.getElementById('checkout-x-aa').click();
            }
          }catch(error){
            GetErrorWB(error);
            console.error(error);
          }
        }

        else if(linkChoice == 'cart'){ //If the user selected cart redirection in the settings of WideBundle for button add to cart
          putBackATC();
          try{
            if(typeof _transcy != 'undefined'){
              if(typeof _transcy.variants.localeCurrent != 'undefined' && typeof _transcy.variants.localeDefault != 'undefined'){
                if(_transcy.variants.localeCurrent != _transcy.variants.localeDefault){
                  if(_transcy.variants.localeDefault != ''){
                    link = 'https://' + window.parent.location.host + '/' + _transcy.variants.localeCurrent + '/'+linkChoice;
                  }
                }
              }
            }
          }
          catch(error){
            console.log(error);
          }
          window.location = link;
        }
      };
      xhr.send(JSON.stringify(itemsAtcWB));
    }
  }

  if(beforeCodeWB != ''){ //Add the code before button if the user put one
    beforeCodeCont = document.createElement('div');
    beforeCodeCont.innerHTML = beforeCodeWB;
    beforeCodeCont.classList.add('before-code-wb');
    elem.appendChild(beforeCodeCont);
  }

  return buttonATC;
}

function addCheckoutHref(){ //System to create the checkout button on the store (so we can click on it later to redirect the customer to the checkout)
  checkoutXA = document.createElement('a');
  checkoutXA.id = 'checkout-xx-aa';
  baseUrl = getBaseUrlWB();
  checkoutXA.href = baseUrl + 'checkout';
  try{
    if(typeof _transcy != 'undefined'){
      if(typeof _transcy.variants.localeCurrent != 'undefined' && typeof _transcy.variants.localeDefault != 'undefined'){
        if(_transcy.variants.localeCurrent != _transcy.variants.localeDefault){
          if(_transcy.variants.localeDefault != ''){
            checkoutXA.href = '/' + _transcy.variants.localeCurrent + '/checkout';
          }
        }
      }
    }
  }
  catch(error){
    console.log(error);
  }
  //If the user has Weglot checkout system
  try{
    if(typeof Weglot != 'undefined'){
      if(typeof Weglot.getCurrentLang() != 'undefined' && Weglot.getCurrentLang() != ''){
        checkoutXA.href = '/checkout?locale=' + Weglot.getCurrentLang();
      }
    }
  }
  catch(error){
    console.log(error);
  }
  checkoutXA.style.color = 'white';
  checkoutXA.style.fontSize = '1px';
  checkoutXA.innerHTML = 'checkout';
  checkoutXA.style.marginTop = '0px';
  checkoutXA.style.marginBottom = '0px';
  checkoutXA.style.display = 'none';
  document.body.append(checkoutXA);
}

function addAfterButtonATC(elem){ //Function to add elements after the add to cart button

  if(shopWB['atc_animation'] == 'shaking'){ //If they added the settings to make the add to cart button shake
    var headWB = document.getElementsByTagName('head')[0],
    styleWB = document.createElement('style'),
    animName = 'shakeWB',
    rulesWB = document.createTextNode('@-webkit-keyframes ' + animName + '{ 0% { transform:translate(0,0);-webkit-transform:translate(0,0) } 2% { transform:translate(5px,0) scale(1.05);-webkit-transform:translate(5px,0) scale(1.05)} 4% { transform:translate(0,0) scale(1.1);-webkit-transform:translate(0,0) scale(1.1) } 6% { transform:translate(5px,0) scale(1.05);-webkit-transform:translate(5px,0) scale(1.05) } 8% { transform:translate(0,0) scale(1);-webkit-transform:translate(0,0)  scale(1)} 10% { transform:translate(5px,0);-webkit-transform:translate(5px,0) } 12% { transform:translate(0,0);-webkit-transform:translate(0,0) } 100% { transform:translate(0,0);-webkit-transform:translate(0,0) } } #new-form-atc{ -webkit-animation: '+animName+' 4s ease infinite; }');
    styleWB.type = 'text/css';
    if(styleWB.styleSheet)
        styleWB.styleSheet.cssText = rulesWB.nodeValue;
    else styleWB.appendChild(rulesWB);
    headWB.appendChild(styleWB);
    window.addEventListener('load', animatefunc, false);
    function animatefunc(){
      if(document.getElementById('new-form-atc') != null){
        document.getElementById('new-form-atc').style.webkitAnimationName = animName;
      }
      for(y=0; y<document.querySelectorAll('.new-form-atc').length; y++){
        document.querySelectorAll('.new-form-atc')[y].style.webkitAnimationName = animName;
      }
    }
  }

  if(trustbadgeWB != '' && trustbadgeWB != null){ //If they added an image url in the settings to show it below widebundle

    trustbadgeCont = document.createElement('div');
    if(elem.hasAttribute('id')) {
      trustbadgeCont.id = 'cont-trustbadge-wb';
      trustbadgeCont.classList.add('cont-trustbadge-wb');
    } else {
      trustbadgeCont.classList.add('cont-trustbadge-wb');
    }
    trustbadgeDiv = document.createElement('img');
    trustbadgeDiv.setAttribute('src', trustbadgeWB);
    trustbadgeCont.appendChild(trustbadgeDiv);
    elem.appendChild(trustbadgeCont);
  }

  if(afterCodeWB != ''){ //if they added html after the add to cart button
    afterCodeCont = document.createElement('div');
    afterCodeCont.innerHTML = afterCodeWB;
    if(elem.hasAttribute('id')) {
      afterCodeCont.id = "after-code-wb";
      afterCodeCont.classList.add('after-code-wb');
    } else {
      afterCodeCont.classList.add('after-code-wb');
    }
    elem.appendChild(afterCodeCont);
  }

}

function getButtonATC(){ //Function to get the ATC button (used for customer support in the function getInfosWB())
  formSubmitWB = [
    ".bettercart_checkout.elm_pos_0", ".bettercart_checkout", ".add-to-cart-first", ".add_to_cart", ".button--add-to-cart", ".shg-btn", "input[type='submit']", ".smart-wrapper .add-to-cart-btn#AddToCartDesk", ".btn--add-to-cart",
  ".product-form__item--submit .product-form__cart-submit", ".gt_product-button", ".add", "button#addToCartCopy", 'button[data-name="Product Button"]', ".paymentButtonsWrapper button[type='submit']", "button[type='submit']", ".gf_add-to-cart", "button[data-pf-type=\"ProductATC\"]", "button.add-to-cart",
  ".product-form__submit", "button.single_add_to_cart_button", '.tt-wrapper .btn-addtocart', '#AddToCart', "button[data-pf-type=\"ProductATC2\"]"
];

  //Click on the form submit
  for(i=0; i<formSubmitWB.length; i++){
    if(formWB.querySelector(formSubmitWB[i]) != null){
      return formWB.querySelector(formSubmitWB[i]);
    }
    if(formSubmitWB[i] == 'button[data-pf-type=\"ProductATC\"]' || formSubmitWB[i] == "button[data-pf-type=\"ProductATC2\"]" || formSubmitWB[i] == ".gf_add-to-cart" || formSubmitWB[i] == 'button[data-name="Product Button"]'){
      if(formID == "page builder"){
        if(document.querySelector(formSubmitWB[i]) != null){
          if(document.querySelector(formSubmitWB[i]).parentNode != null){
            if(isDescendant(document.querySelector(formSubmitWB[i]).parentNode, formWB)){
              return document.querySelector(formSubmitWB[i]);
            }
            else if(getFormParent(document.querySelector(formSubmitWB[i])) != null && isDescendant(getFormParent(document.querySelector(formSubmitWB[i])), document.querySelector('#new-form-atc'))){
              return document.querySelector(formSubmitWB[i]);
            }
          }
        }
      }
    }
  }
  return "";
}

function addHiddenPrices(){ //Function to add prices hidden so we can use them for conversion currency bugs

  var divHiddenPrices = document.createElement("div");
  divHiddenPrices.classList.add("wb_hidden_prices");
  divHiddenPrices.innerHTML = "";
  divHiddenPrices.style.display = "none";
  for(var index in widebundleOffers){
    if(!isNaN(index)){
      divHiddenPrices.innerHTML = divHiddenPrices.innerHTML + `<p class="wb_hidden_prices_element"><span class="wb_hidden_price money conversion-bear-money transcy-money" variant-id="${index}">${removeDecimal(widebundleOffers[index]['price'].replace('.', shopWB['price_separator']))}</span>
      <span class="wb_hidden_compared_price money conversion-bear-money transcy-money" variant-id="${index}">${removeDecimal(widebundleOffers[index]['compared_price'].replace('.', shopWB['price_separator']))}</span></p>`;
      //Update Price also on the offers?
    }
  }
  return divHiddenPrices;
}

function addPricesFromAjax(){ //Function to add prices from AJAX API so we can use them for Shopify Market (and only if we can't use getPriceFromJson)

  if(typeof Shopify != "undefined" && typeof Shopify.currency != "undefined"){
    if(getPriceFromJson(document.querySelector('.wb_hidden_prices .wb_hidden_price').getAttribute('variant-id')) === ""){
      console.log('doing ajax');
      const url = `${window.Shopify.routes.root}products/${productON}.js`;
      fetch(url)
      .then(response => response.json())
      .then(product => {
        console.log(product.variants);
        console.log("PriceJson Script not available");
        product.variants.forEach(variant => {
          priceStructured = (parseFloat(variant.price)/100).toFixed(2); //Get the price with right format
          priceStructured = replaceCurrencyWB(currencyForm.replace('{{amount}}', priceStructured))//Replace the price in the currency format with right currency
          priceStructured = priceStructured.toString().replace('.', shopWB['price_separator']); //Replace price separator if needed
          if(variant.compare_at_price != null){
            compareAtPriceStructured = (parseFloat(variant.compare_at_price)/100).toFixed(2);
            compareAtPriceStructured = replaceCurrencyWB(currencyForm.replace('{{amount}}', compareAtPriceStructured));
            compareAtPriceStructured = compareAtPriceStructured.toString().replace('.', shopWB['price_separator']);
          }
          else{
            compareAtPriceStructured = "";
          }

          document.querySelector('.wb_hidden_prices .wb_hidden_price[variant-id="'+variant.id+'"]').innerHTML = removeDecimal(priceStructured); //removeDecimal if enabled
          document.querySelector('.wb_hidden_prices .wb_hidden_compared_price[variant-id="'+variant.id+'"]').innerHTML = removeDecimal(compareAtPriceStructured);
        });
        updatePriceOnAllOffers();
      })
      .catch(error => console.log(error));
    }
  }
}

function regenerateWideBundleListeners(){

  if(typeof Shopify != "undefined"){
    new_form = document.querySelector('#new-form');
    countCheckForm = 0;
    var checkForm = setInterval(function() {
      if(typeof new_form !== 'undefined' && new_form != null){
        new_form_test = document.querySelector('#new-form');
        if(!new_form.isSameNode(new_form_test)){
          new_form_test.remove();
          initWB();
          clearInterval(checkForm);
        }
      }
      countCheckForm++;
      if(countCheckForm >= 300){
        clearInterval(checkForm);
      }
    }, 200);
  }
}

function isDescendant(parent, child) {
    let node = child.parentNode;
    while (node) {
        if (node === parent) {
            return true;
        }

        // Traverse up to the parent
        node = node.parentNode;
    }

    // Go up until the root but couldn't find the `parent`
    return false;
};

function getFormParent(child){
  let node = child.parentNode;
  while (node) {
      if (node.tagName === "FORM") {
          return node;
      }

      // Traverse up to the parent
      node = node.parentNode;
  }

  // Go up until the root but couldn't find the `parent`
  return null;
}

function eventFire(el, etype){
  if (el.fireEvent) {
    el.fireEvent('on' + etype);
  } else {
    var evObj = document.createEvent('Events');
    evObj.initEvent(etype, true, false);
    el.dispatchEvent(evObj);
  }
}

function addConsoleLog(message){
  if(shopWB.shop == "vistatrade.myshopify.com"){
    console.log(message);
  }
  //
}

function addStyle(styles){
  /* Create style document */
  var css = document.createElement('style');
  css.type = 'text/css';

  if (css.styleSheet)
      css.styleSheet.cssText = styles;
  else
      css.appendChild(document.createTextNode(styles));

  /* Append style to the tag name */
  document.getElementsByTagName("head")[0].appendChild(css);
}

function arraysEqual(_arr1, _arr2) {

  if (!Array.isArray(_arr1) || ! Array.isArray(_arr2) || _arr1.length !== _arr2.length)
    return false;

  var arr1 = _arr1.concat().sort();
  var arr2 = _arr2.concat().sort();
  for (var i = 0; i < arr1.length; i++) {
      if (arr1[i] !== arr2[i])
          return false;
  }
  return true;
}

function escapeHTML(theHTML){
  return theHTML.replace('<','&lt;').replace('>','&gt;').replace('&','&amp;').replace(' ','&nbsp;');
}

function GetErrorWB(error){
  var http = new XMLHttpRequest();
  var url = websiteWB+'AJAX/GetError.php';
  var params = 'error='+encodeURI(error)+'&shop='+encodeURI(shopWB['shop'])+'&page='+encodeURI(window.location.href);
  http.open('POST', url, true);
  http.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
  http.onreadystatechange = function() {
      if(http.readyState == 4 && http.status == 200) {
      }
  }
  http.send(params);
}

function LoadJqueryWB(){
  if (window.jQuery) {

  } else {

    var script = document.createElement('script');
    script.src = 'https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js';
    script.type = 'text/javascript';
    document.getElementsByTagName('head')[0].appendChild(script);
  }
}

function unescapeHTML(theHTML) {
  return theHTML.replace(/&lt;/g,'<').replace(/&gt;/g,'>').replace(/&amp;/g,'&').replace(/&nbsp;/g, ' ');
}

function writeConsole(message){
  console.log(message);
}

function triggerMouseEvent (node, eventType) {
    var clickEvent = document.createEvent ('MouseEvents');
    clickEvent.initEvent (eventType, true, true);
    node.dispatchEvent (clickEvent);
}

function getStyleWB(element, name){
    return element.currentStyle ? element.currentStyle[name] : window.getComputedStyle ? window.getComputedStyle(element, null).getPropertyValue(name) : null;
}

function isJsonString(str) {
    try {
        JSON.parse(str);
    } catch (e) {
        return false;
    }
    return true;
}

function posInUrl(text, subStrings) {
  positions = {};
  subStrings.forEach(subString => {
    positions[subString] = text.indexOf(encodeURI(subString));
  });
  return positions;
}

function getShopInfosWB(){
  console.log("");
}

function updateDesignOnSelect(element){

  selectedWBLength = document.querySelectorAll('.selectedWB').length;
  selectedWB = document.querySelectorAll('.selectedWB');

  for(y=0; y<selectedWBLength; y++){
    selectedWB[y].classList.add('selectable');
  }
  for(oWB=0;oWB<selectedWBLength;oWB++){
    document.querySelectorAll('.selectedWB .select-class-second')[oWB].innerHTML = "";
  }
  for(y=0; y<selectedWBLength; y++){
    selectedWB[y].classList.remove('selectedWB');
  }

  dataIDAttribute = element.getAttribute('data-id');

  for(y=0; y<document.querySelectorAll('.new-form-option[data-id="'+dataIDAttribute+'"]').length; y++){
    document.querySelectorAll('.new-form-option[data-id="'+dataIDAttribute+'"]')[y].classList.add('selectedWB');
    document.querySelectorAll('.new-form-option[data-id="'+dataIDAttribute+'"]')[y].classList.remove('selectable');
  }
  if(displayQuantityWB == 1){
    for(var n=0; n < document.getElementsByClassName('spinWB').length; n++){
      document.getElementsByClassName('spinWB')[n].getElementsByClassName('quantity-wb-input')[0].value = 1;
      quantityNumberWB = 1;
    }
    if(formWB.querySelectorAll('[name=quantity]')[0] != undefined){
      formWB.querySelectorAll('[name=quantity]')[0].value = 1;
    }
    if(document.querySelector('.gf_product-quantity input[name="quantity"]') != null){
      document.querySelector('.gf_product-quantity input[name="quantity"]').value = 1;
    }
    if(document.querySelector('div[data-pf-type="Layout"] div[data-pf-type="ProductQuantity"] input') != null){
      document.querySelector('div[data-pf-type="Layout"] div[data-pf-type="ProductQuantity"] input').value = 1;
    }
  }
}

function updatePriceOnSelect(){

  exceptionsPrices = [
    ".collection"
  ];

  GetPriceWB(shopWB['update_price']);
  if(price[0] != undefined){
    formPrice:
    for(var i = 0; i < price.length; i++){
      priceInfo = document.getElementsByClassName('selectedWB')[0].getElementsByClassName('price-new-form')[0].innerHTML;

      for(var x=0; x < exceptionsPrices.length; x++){
        exceptionAll = document.querySelectorAll(exceptionsPrices[x]);
        for(var z=0; z < exceptionAll.length; z++){
          exception = document.querySelectorAll(exceptionsPrices[x])[z];
          if(typeof exception != "undefined" && isDescendant(exception, price[i])){
            addConsoleLog('price is descendant of an exception...');
            continue formPrice;
          }
        }
      }

      price[i].innerHTML = priceInfo;
      if(typeof price[i].getElementsByClassName('first-price-WB')[0] !== 'undefined'){
        price[i].getElementsByClassName('first-price-WB')[0].style.color = shopWB['price_color'];
      }
      if(typeof price[i].getElementsByClassName('second-price-WB')[0] !== 'undefined'){
        price[i].getElementsByClassName('second-price-WB')[0].style.color = shopWB['price_compared_color'];
      }
      price[i].style.fontWeight = 'bold';
      if(price.length > 2 || LocationWebsite.indexOf(encodeURI('products/')) == -1){
        break;
      }

    }
  }
  if(document.querySelectorAll('.price-wb') != null){
    price = document.querySelectorAll('.price-wb');
    for(i=0; i<document.querySelectorAll('.price-wb').length; i++){
      priceInfo = document.querySelector('.selectedWB .price-new-form').innerHTML;
      document.querySelectorAll('.price-wb')[i].innerHTML = priceInfo;
      if(typeof price[i].getElementsByClassName('first-price-WB')[0] !== 'undefined'){
        price[i].getElementsByClassName('first-price-WB')[0].style.color = shopWB['price_color'];
      }
      if(typeof price[i].getElementsByClassName('second-price-WB')[0] !== 'undefined'){
        price[i].getElementsByClassName('second-price-WB')[0].style.color = shopWB['price_compared_color'];
      }
      price[i].style.fontWeight = 'bold';
    }
  }
}

function getSingleOptions(option){
  singleOption = [];
  singleOption['options'] = [];

  //For each variants of the offer
  variantsWB = options2[attributes[0]];
  for(x=0; x<variantsWB.length; x++){
    //Get all the single values in the variants
    variantsSplit = variantsWB[x].split('@@');

    //Get All choices in option 2
    option == 1 ? a = 0 : a = 2;
    choicesOption = variantsSplit[a].split(',');

    //Get how many choices we have in option 2
    singleOption['number'] = choicesOption.length;

    //For each choice in option 2 we add the values in a new array
    for(i=0; i<choicesOption.length; i++){
      choicesOption[i] = choicesOption[i].trim();
      included = singleOption['options'].includes(choicesOption[i]);
      if(included === false && choicesOption[i] != ''){
        singleOption['options'].push(choicesOption[i]);
      }
    }
  }

  return singleOption;
}

function manageKlaviyoPixel(){
  if(typeof _learnq != "undefined"){
    fetch(`${window.location.origin}/cart.js`)
    .then(res => res.clone().json().then(data => {
      var cart = {
        total_price: data.total_price/100,
        $value: data.total_price/100,
        total_discount: data.total_discount,
        original_total_price: data.original_total_price/100,
        items: data.items
      }
      if (item !== 'undefined') {
        cart = Object.assign(cart, item)
      }
      console.log(cart);
      _learnq.push(['track', 'Added to Cart', cart])
    }))
  }
}

function managePixel(){
  //Facebook Pixel
  if(shopWB['add_pixel'] == 1){
    if(typeof window.fbq !== 'undefined'){
      if(typeof meta != "undefined" && typeof meta.product !== 'undefined'){
        for(var metaVariant in meta.product.variants){
          if(meta.product.variants[metaVariant].id == dataID){
            priceNAME = meta.product.variants[metaVariant].price / 100;
            window.fbq('track', 'AddToCart', {
              value: priceNAME.toFixed(2),
              currency: currencyNAME
            });
          }
        }
      }
      else{
        window.fbq('track', 'AddToCart', {
          value: pricing,
          currency: currencyNAME
        });
      }
    }
  }
  //Pinterest Pixel
  if(typeof window.pintrk !== 'undefined'){
    console.log('pinterest pixel found');
    pintrk('track', 'addtocart', {
      value:pricing,
      currency: currencyNAME
    });
  }
  //Snap pixel
  if(typeof window.snaptr !== 'undefined'){
    snaptr('track', 'ADD_CART', {'currency': currencyNAME, 'price': pricing, 'item_category': '', 'item_ids': [] });
  }
  //Tiktok Pixel
  if(typeof window.ttq !== 'undefined'){
    ttq.track('AddToCart');
  }
  //Outbrain pixel
  if(typeof window.obApi !== 'undefined'){
    obApi('track', 'Add To Cart');
  }
}

function putBackATC(){
  setTimeout(
  function() {
    if(document.getElementById('new-form-atc') != null){
      document.getElementById('new-form-atc').innerHTML = AddSVG(shopWB['svg_size'], shopWB['atc_color'], shopWB['svg_number'])+shopWB['atc_text'];
      document.getElementById('new-form-atc').style.pointerEvents = 'auto';
    }
    for(y=0; y<document.querySelectorAll('.new-form-atc').length; y++){
      document.querySelectorAll('.new-form-atc')[y].innerHTML = AddSVG(shopWB['svg_size'], shopWB['atc_color'], shopWB['svg_number'])+shopWB['atc_text'];
      document.querySelectorAll('.new-form-atc')[y].style.pointerEvents = 'auto';
    }
    if(document.querySelector('#checkout-xx-aa') != null){
      document.querySelector('#checkout-xx-aa').style.display = "none";
    }
  }, 2000);
}

function addLoadingATC(){
  loadingHTML = `<img class="loading-wb" src='${websiteWB}Public/App/images/loading.gif' width="20px" height="20px" />`;
  if(document.getElementById('new-form-atc') != null){
    document.getElementById('new-form-atc').innerHTML = loadingHTML;
  }
  for(y=0; y<document.querySelectorAll('.new-form-atc').length; y++){
    document.querySelectorAll('.new-form-atc')[y].innerHTML = loadingHTML;
  }
  if(document.querySelector('#checkout-xx-aa') != null){
    document.querySelector('#checkout-xx-aa').style.display = "block";
  }
}

function manageEcomSolidSideCart(){
  if(typeof window.SOLID != 'undefined'){
    isGemPages = formWB.closest('[class^=\'gt_section-\'][data-name], [class^=\'gf_section-\'][data-name], [class^=\'gt_widget-\'][data-name], [class^=\'gt_element-\'][data-name]');
    if(isGemPages != null){
      dataID = getSelectedID();
      managePixel();
      addLoadingATC();
      if(typeof quantityNumberWB == 'undefined'){
        quantityNumberWB = 1;
      }
      itemsAtcWB = {items: [{quantity: quantityNumberWB,id: dataID}]};
      const xhr = new XMLHttpRequest();
      xhr.open('POST', '/cart/add.js');
      xhr.setRequestHeader('Content-type', 'application/json');
      xhr.onload = async function () {
        await window.SOLID.cart.GetCart();
        window.SOLID.store.dispatch('addToCartSuccess');
        window.SOLID.store.dispatch('openCartPopup', 'cart_drawer');
      };
      xhr.send(JSON.stringify(itemsAtcWB));
      putBackATC();
      return;
    }
  }
}

function AddSVG(size, color, svg){
  if(svg == 1){
    svgCode = '<svg style=\'margin-right:10px;fill:'+color+';\' height=\''+size+'\' width=\''+size+'\' viewBox=\'0 -31 512.00033 512\' xmlns=\'http://www.w3.org/2000/svg\'><path d=\'m166 300.003906h271.003906c6.710938 0 12.597656-4.4375 14.414063-10.882812l60.003906-210.003906c1.289063-4.527344.40625-9.390626-2.433594-13.152344-2.84375-3.75-7.265625-5.964844-11.984375-5.964844h-365.632812l-10.722656-48.25c-1.523438-6.871094-7.617188-11.75-14.648438-11.75h-91c-8.289062 0-15 6.710938-15 15 0 8.292969 6.710938 15 15 15h78.960938l54.167968 243.75c-15.9375 6.929688-27.128906 22.792969-27.128906 41.253906 0 24.8125 20.1875 45 45 45h271.003906c8.292969 0 15-6.707031 15-15 0-8.289062-6.707031-15-15-15h-271.003906c-8.261719 0-15-6.722656-15-15s6.738281-15 15-15zm0 0\'/><path d=\'m151 405.003906c0 24.816406 20.1875 45 45.003906 45 24.8125 0 45-20.183594 45-45 0-24.8125-20.1875-45-45-45-24.816406 0-45.003906 20.1875-45.003906 45zm0 0\'/><path d=\'m362.003906 405.003906c0 24.816406 20.1875 45 45 45 24.816406 0 45-20.183594 45-45 0-24.8125-20.183594-45-45-45-24.8125 0-45 20.1875-45 45zm0 0\'/></svg>';
    return svgCode;
  }
  else if(svg == 2){
    svgCode = '<svg version=\'1.1\' id=\'Layer_1\' xmlns=\'http://www.w3.org/2000/svg\' height=\''+size+'\' width=\''+size+'\' xmlns:xlink=\'http://www.w3.org/1999/xlink\' x=\'0px\' y=\'0px\'	 viewBox=\'0 0 512 512\' style=\'enable-background:new 0 0 512 512;margin-right:10px;fill:'+color+';\' xml:space=\'preserve\'><g>	<g>		<path d=\'M402.351,381.058h-203.32l-11.806-47.224h266.587L512,101.085H129.038L108.882,20.46H0v33.4h82.804l82.208,328.827			c-24.053,5.971-41.938,27.737-41.938,53.611c0,30.461,24.781,55.242,55.241,55.242c30.459,0,55.241-24.781,55.241-55.242			c0-7.755-1.613-15.138-4.511-21.841h122.577c-2.897,6.703-4.511,14.086-4.511,21.841c0,30.461,24.781,55.242,55.241,55.242			c30.459,0,55.241-24.781,55.241-55.242C457.592,405.84,432.811,381.058,402.351,381.058z M287.029,300.434h-37.08l-8.284-66.275			h45.365V300.434z M411.912,134.484h57.31l-16.568,66.275h-49.026L411.912,134.484z M399.453,234.16h44.85l-16.568,66.275h-36.566			L399.453,234.16z M320.428,134.484h57.824l-8.284,66.275h-49.539V134.484z M320.428,234.159h45.365l-8.284,66.275h-37.08V234.159z			 M287.029,134.484v66.275h-49.539l-8.284-66.275H287.029z M137.388,134.484h58.158l8.284,66.275h-49.873L137.388,134.484z			 M162.307,234.159h45.699l8.284,66.275h-37.414L162.307,234.159z M178.315,458.141c-12.043,0-21.841-9.798-21.841-21.842			c0-12.043,9.798-21.841,21.841-21.841s21.841,9.798,21.841,21.841C200.156,448.343,190.358,458.141,178.315,458.141z			 M402.351,458.141c-12.043,0-21.841-9.798-21.841-21.842c0-12.043,9.798-21.841,21.841-21.841			c12.043,0,21.841,9.798,21.841,21.841C424.192,448.343,414.394,458.141,402.351,458.141z\'/>	</g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g></svg>';
    return svgCode;
  }
  else if(svg == 3){
    svgCode = '<svg version=\'1.1\' id=\'Capa_1\' xmlns=\'http://www.w3.org/2000/svg\' xmlns:xlink=\'http://www.w3.org/1999/xlink\' x=\'0px\' y=\'0px\'	 viewBox=\'0 0 502.187 502.187\' style=\'enable-background:new 0 0 502.187 502.187;margin-right:10px;fill:'+color+';\' height=\''+size+'\' width=\''+size+'\' xml:space=\'preserve\'><g>	<g>		<polygon points=\'277.333,112.427 277.333,48.427 234.667,48.427 234.667,112.427 170.667,112.427 170.667,155.093 			234.667,155.093 234.667,219.093 277.333,219.093 277.333,155.093 341.333,155.093 341.333,112.427 		\'/>	</g></g><g>	<g>		<circle cx=\'170.667\' cy=\'432.427\' r=\'42.667\'/>	</g></g><g>	<g>		<circle cx=\'341.333\' cy=\'432.427\' r=\'42.667\'/>	</g></g><g>	<g>		<rect y=\'27.093\' width=\'85.333\' height=\'42.667\'/>	</g></g><g>	<g>		<polygon points=\'384,112.427 384,155.093 436.48,155.093 370.133,304.427 146.56,304.427 106.88,27.093 85.333,27.093 			64.213,30.08 109.44,347.093 397.867,347.093 502.187,112.427 		\'/>	</g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g></svg>';
    return svgCode;
  }
  else if(svg == 4){
    svgCode = '<svg version=\'1.1\' id=\'Capa_1\' xmlns=\'http://www.w3.org/2000/svg\' xmlns:xlink=\'http://www.w3.org/1999/xlink\' x=\'0px\' y=\'0px\'	 height=\''+size+'\' width=\''+size+'\' viewBox=\'0 0 45.402 45.402\' style=\'margin-right:10px;fill:'+color+';enable-background:new 0 0 45.402 45.402;\'	 xml:space=\'preserve\'><g>	<path d=\'M41.267,18.557H26.832V4.134C26.832,1.851,24.99,0,22.707,0c-2.283,0-4.124,1.851-4.124,4.135v14.432H4.141		c-2.283,0-4.139,1.851-4.138,4.135c-0.001,1.141,0.46,2.187,1.207,2.934c0.748,0.749,1.78,1.222,2.92,1.222h14.453V41.27		c0,1.142,0.453,2.176,1.201,2.922c0.748,0.748,1.777,1.211,2.919,1.211c2.282,0,4.129-1.851,4.129-4.133V26.857h14.435		c2.283,0,4.134-1.867,4.133-4.15C45.399,20.425,43.548,18.557,41.267,18.557z\'/></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g></svg>';
    return svgCode;
  }
  else if(svg == 5){
    svgCode = '<svg style=\'margin-right:10px;fill:'+color+';\' id=\'Layer_1\' enable-background=\'new 0 0 512 512\' height=\''+size+'\' width=\''+size+'\' viewBox=\'0 0 512 512\' xmlns=\'http://www.w3.org/2000/svg\'><g><path d=\'m512 213.206h-55.385l-46.288-119.318-27.969 10.849 42.08 108.469h-141.111l90.415-142.055h-53.912v-71.15h-127.705v71.15h-53.919l90.458 142.055h-141.08l42.079-108.469-27.969-10.849-46.288 119.318h-55.406v60.004h512z\'/><path d=\'m64.868 511.999h382.263l31.391-208.789h-445.044zm266.149-171.306h30v103.822h-30zm-60.004 0h30v103.822h-30zm-60.004 0h30v103.822h-30zm-60.004 0h30v103.822h-30z\'/></g></svg>';
    return svgCode;
  }
  else{
    return '';
  }
}

function updateAllFormSelects(element, classWB){
  for(y=0; y<document.querySelectorAll(classWB).length; y++){
    document.querySelectorAll(classWB)[y].value = element.value;
  }
}

function getAmountFromPrice(price){
  var regp = /[^0-9.,]*(\d+(?:[.,]\d+)?)(?:[^0-9.,]|$)/;
  match = price.match(regp);
  if(match){
    return match[1];
  }
  else{
    return price;
  }
}

function updatePriceOnAllOffers(){

  offers = document.querySelectorAll('.new-form-option');
  offers.forEach(offer => {
    if(offer.classList.contains('selectedWB')){
      offerID = getSelectedID();
    }
    else{
      offerID = offer.getAttribute('data-id');
    }

    currentPrice = offer.querySelector('.first-price-WB');
    compareAtPrice = offer.querySelector('.second-price-WB');
    if(currentPrice){
      currentPrice.innerHTML = document.querySelector(`.wb_hidden_prices .wb_hidden_price[variant-id="${offerID}"]`).innerHTML;
    }
    if(compareAtPrice){
      compareAtPrice.innerHTML = document.querySelector(`.wb_hidden_prices .wb_hidden_compared_price[variant-id="${offerID}"]`).innerHTML;
    }

    //For "you save" text
    if(compareAtPrice.innerHTML != '' && shopWB['economic_display'] == 1){
      diff = parseFloat(getAmountFromPrice(compareAtPrice.innerHTML).replace(',', '.')) - parseFloat(getAmountFromPrice(currentPrice.innerHTML).replace(',', '.'));
      diffPercent = 100 * parseFloat(diff) / parseFloat(getAmountFromPrice(compareAtPrice.innerHTML).replace(',', '.'));
      diffPercent = Math.round(diffPercent);
      diff = diff.toFixed(2);
      try{
        if(shopWB['no_decimal'] == 1){
          diff = parseFloat(diff);
        }
      }
      catch(error){
        console.log('error');
      }
      currencyAlone = currentPrice.innerHTML.replace(/\d+.\d+/g,'{{amount}}').replace(/\d+/g,'{{amount}}');

      percent = offer.querySelector('.percent-wb');
      priceEconomic = offer.querySelector('.span-economic-wb');
      if(percent){
        percent.innerHTML = diffPercent;
      }
      if(priceEconomic){
        priceEconomic.innerHTML = currencyAlone.replace('{{amount}}', diff).replace('.', shopWB['price_separator']);;
      }
    }
    else{
      var savingText = offer.querySelector('.economic-wb');
      if(savingText){ //Hide the saving text if we have it
        savingText.style.display = "none";
      }
    }

  });

  updatePriceOnSelect();

}

function changePrice(systemNumber = 1) {
  idSelected = document.getElementsByClassName('selectedWB')[0].getAttribute('data-id');
  nameSelected = idOptions1[idSelected];
  dataID = idSelected;



  //Update Form to sync the selected variant with Shopify form
  const hasVariant = new URLSearchParams(window.location.search.toLowerCase()).get('variant');

  if (systemNumber == 0 || hasVariant || preSelectedVar != 0) {
    UpdateFormWB();
  }

  idVariantSelected = getSelectedID();

  actualPrice = document.querySelector('.wb_hidden_prices .wb_hidden_price[variant-id="' + idVariantSelected + '"]').innerHTML;
  comparedPrice = document.querySelector('.wb_hidden_prices .wb_hidden_compared_price[variant-id="' + idVariantSelected + '"]').innerHTML;

  actualPrice = convertPriceShopify(actualPrice, 1, idVariantSelected);
  comparedPrice = convertPriceShopify(comparedPrice, 2, idVariantSelected);

  //Update the economic price with the new prices
  if (comparedPrice != '' && shopWB['economic_display'] == 1) {
    diff = parseFloat(getAmountFromPrice(comparedPrice).replace(',', '.')) - parseFloat(getAmountFromPrice(actualPrice).replace(',', '.'));
    diffPercent = Math.round(100 * parseFloat(diff) / parseFloat(getAmountFromPrice(comparedPrice).replace(',', '.')));
    diff = diff.toFixed(2);

    if (shopWB['no_decimal'] == 1) {
      diff = parseFloat(diff);
    }

    currencyAlone = actualPrice.replace(/\d+.\d+/g,'{{amount}}').replace(/\d+/g,'{{amount}}').replace('{{amount}}', diff).replace('.', shopWB['price_separator']);

    //Update on the store
    for (y = 0; y < document.querySelectorAll('.selectedWB .percent-wb').length; y++) {
      document.querySelectorAll('.selectedWB .percent-wb')[y].innerHTML = diffPercent;
    }
    for (y = 0; y < document.querySelectorAll('.selectedWB .span-economic-wb').length; y++) {
      document.querySelectorAll('.selectedWB .span-economic-wb')[y].innerHTML = currencyAlone;
    }
  }
  //**TODO check for priceNewToChange & priceComparedNewToChange usage */

  //Set up the new prices
  priceNewToChange = removeDecimal(actualPrice).replace('.', shopWB['price_separator']);
  priceComparedNewToChange = removeDecimal(comparedPrice).replace('.', shopWB['price_separator']);

  //Update the new prices on the app
  for (y = 0; y < document.querySelectorAll('.selectedWB .price-new-form span.first-price-WB').length; y++) {
    document.querySelectorAll('.selectedWB .price-new-form span.first-price-WB')[y].innerHTML = priceNewToChange;
    if (document.querySelectorAll('.selectedWB .price-new-form .second-price-WB s')[y] != null) {
      document.querySelectorAll('.selectedWB .price-new-form .second-price-WB s')[y].innerHTML = priceComparedNewToChange;
    }
    else {
      document.querySelectorAll('.selectedWB .price-new-form .second-price-WB')[y].innerHTML = priceComparedNewToChange;
    }
  }

  //CONVERT PRICE WITH CONVERSION BEAR
  convertPriceConversionBear();

  //CONVERT CURRENCY WITH APP BEST CURRENCY CONVERTER
  //convertPriceBestCurrencyConverter();

  //CONVERT WITH THEME
  convertPriceThemeWB();

  //Convert with KT
  convertPriceKTCurrency();

  //Convert with Booster
  convertPriceBooster();

  //Convert with Langshop
  //convertPriceLangshop();

  //Convert Transcy
  convertPriceTranscy();

  //Convert Secom App Currency Switcher
  convertPriceCurrencySwitcher();

  //Update the general price of the store if we found the price and if they enabled the feature
  updatePriceOnSelect();
  setTimeout(
    function () {
      updatePriceOnSelect();
    }, 400);
};

function getDataID(nameSelected, dataID){
  if(typeof options2[nameSelected] !== 'undefined'){
    //Get how many rows we have
    numberWB = options1Split[nameSelected]['number'];

    mySelectedVariants = [];

    secondDataID = "";

    //Add in array the variants we selected
    for(i=1;i<numberWB+1;i++){

      if(document.querySelector('.add-option-'+dataID+'-'+i) != null){
        if(document.querySelectorAll('.add-option2-'+dataID+'-'+i)[0] !== null && typeof document.querySelectorAll('.add-option2-'+dataID+'-'+i)[0] != "undefined"){
          mySelectedVariants.push(document.querySelectorAll('.add-option-'+dataID+'-'+i)[0].value.toLowerCase() + '|||' + document.querySelectorAll('.add-option2-'+dataID+'-'+i)[0].value.toLowerCase());
        }
        //If we have 1 select only, we add the value to the array
        else{
          mySelectedVariants.push(document.querySelectorAll('.add-option-'+dataID+'-'+i)[0].value.toLowerCase());
        }
      }

      //For ID
      if(document.getElementById('add-option-'+dataID+'-'+i) != null){
        if(document.getElementById('add-option2-'+dataID+'-'+i) !== null){
          mySelectedVariants.push(document.getElementById('add-option-'+dataID+'-'+i).value.toLowerCase() + '|||' + document.getElementById('add-option2-'+dataID+'-'+i).value.toLowerCase());
        }
        //If we have 1 select only, we add the value to the array
        else{
          mySelectedVariants.push(document.getElementById('add-option-'+dataID+'-'+i).value.toLowerCase());
        }
      }

    }

    //For each variants in the offer, create an array
    for(var n in options2[nameSelected]){

      if(isNaN(n)){
        break;
      }
      testingArray = [];
      elementsVariant = options2[nameSelected][n].split('@@');
      choicesOption1 = elementsVariant[0].split(',');
      if(options2[nameSelected].length < 1){
        choicesOption1 = [''];
      }
      choicesOption2 = elementsVariant[2].split(',');
      for(var YWB in choicesOption1){
        if(isNaN(YWB)){
          break;
        }
        if(typeof choicesOption2[YWB] !== 'undefined' && choicesOption2[YWB] != ''){
          testingArray.push(choicesOption1[YWB].trim().toLowerCase() + '|||' + choicesOption2[YWB].trim().toLowerCase());
        }
        else{
          testingArray.push(choicesOption1[YWB].trim().toLowerCase());
        }
      }
      addConsoleLog(testingArray);
      addConsoleLog(mySelectedVariants);
      //Test both arrays to see what is the selected variant
      if(arraysEqual(testingArray, mySelectedVariants) == true){
        secondDataID = elementsVariant[1];
      }
    }
    if(secondDataID != ''){
      dataID = secondDataID;

      return dataID;
    }
    else{
      return "";
    }
  }
  else{
    return "";
  }
}

function _clearSelectOptions(element) {
  let sel = element.options.length;
  for (i = sel-1; i >= 0; i--) {
    element.options[i] = null;
  }
}

function _addOptionsToSelect(options, nameSelected, selector, dataID, index) {
  let j = index;

  for(var i in options[nameSelected]['options']){
    if(isNaN(i)){
      break;
    }
    dataID = document.getElementsByClassName('selectedWB')[0].getAttribute('data-id');
    //For Class
    let selectElements = document.querySelectorAll(selector + dataID + '-' + j);
    for(y = 0; y < selectElements.length; y++){
      sel = selectElements[y];
      var opt = document.createElement('option');
      opt.appendChild(document.createTextNode(options[nameSelected]['options'][i]));
      opt.value = options[nameSelected]['options'][i];
      sel.appendChild(opt);
      if(sel.childElementCount > 1){
        sel.classList.remove('hide-bloc-wb');
      }
      else{
        sel.classList.add('hide-bloc-wb');
      }
    }
  }

  let secondSelectElements = document.querySelectorAll('.div-second-select-' + dataID + '-' + j);

  for(y = 0; y < secondSelectElements.length; y++){
    divSel = secondSelectElements[y];
    if(options2[nameSelected].length > 1){
      //divSel.style.display = 'block';
      divSel.classList.remove('hide-bloc-wb');
    }
    else{
      //divSel.style.display = 'none';
      divSel.classList.add('hide-bloc-wb');
    }
  }
}

function DisplaySelWB(){
  idSelected = document.getElementsByClassName('selectedWB')[0].getAttribute('data-id');
  nameSelected = idOptions1[idSelected];
  if(typeof options2[nameSelected] !== 'undefined') {
    if (options2[nameSelected].length >= 1) {
      Length = options1Split[nameSelected]['number']; //How many selects for option 1
      Length2 = options2Split[nameSelected]['number']; //How many selects for option 2

      for (j = 1; j < Length + 1; j++) {
        //Bloc to remove the options in the select for option 1 and option 2 if exist (to start from scratch)
        dataID = document.getElementsByClassName('selectedWB')[0].getAttribute('data-id');

        //For Class
        let addOptionElements = document.querySelectorAll('.add-option-' + dataID + '-' + j);
        let addOption2Elements = document.querySelectorAll('.add-option2-' + dataID + '-' + j);

        for (y = 0; y < addOptionElements.length; y++) {
          _clearSelectOptions(addOptionElements[y]);
          if (addOption2Elements[y] != null) {
            selNode = addOption2Elements[y];
            selNode.classList.add('hide-bloc-wb');
            _clearSelectOptions(addOption2Elements[y]);
          }
        }

        //Add all the options in the select
        _addOptionsToSelect(options1Split, nameSelected, '.add-option-', dataID, j);
      }

      for (k = 1; k < Length2 + 1; k++) {
        //Add all the options in the select
        _addOptionsToSelect(options2Split, nameSelected, '.add-option2-', dataID, k);
      }
    }
  }
}

function getSelectedID(){
  idSelected = document.getElementsByClassName('selectedWB')[0].getAttribute('data-id');
  nameSelected = idOptions1[idSelected];
  pricing = optionPrice[nameSelected];
  dataID = idSelected;
  if(typeof options2[nameSelected] !== 'undefined'){

    //Get how many selects rows we should have for this offer
    numberWB = options1Split[nameSelected]['number'];

    mySpecialArray = [];
    mySpecialArray2 = [];

    //For each row of selects
    for(i=1;i<numberWB+1;i++){
      //If we have 2 selects, we add the values to an array

      //For Class
      if(document.querySelector('.add-option-'+dataID+'-'+i) != null){
        if(document.querySelectorAll('.add-option2-'+dataID+'-'+i)[0] !== null && typeof document.querySelectorAll('.add-option2-'+dataID+'-'+i)[0] != "undefined"){
          mySpecialArray.push(document.querySelectorAll('.add-option-'+dataID+'-'+i)[0].value.toLowerCase() + '|||' + document.querySelectorAll('.add-option2-'+dataID+'-'+i)[0].value.toLowerCase());
        }
        //If we have 1 select only, we add the value to the array
        else{
          mySpecialArray.push(document.querySelectorAll('.add-option-'+dataID+'-'+i)[0].value.toLowerCase());
        }
      }

      //For ID
      if(document.getElementById('add-option-'+dataID+'-'+i) != null){
        if(document.getElementById('add-option2-'+dataID+'-'+i) !== null){
          mySpecialArray.push(document.getElementById('add-option-'+dataID+'-'+i).value.toLowerCase() + '|||' + document.getElementById('add-option2-'+dataID+'-'+i).value.toLowerCase());
        }
        //If we have 1 select only, we add the value to the array
        else{
          mySpecialArray.push(document.getElementById('add-option-'+dataID+'-'+i).value.toLowerCase());
        }
      }
    }

    //For each variant in this offer
    for(var n in options2[nameSelected]){
      if(isNaN(n)){
        break;
      }
      newSpliting = [];
      newSpliting2 = [];

      //Get the elements alone in an array
      splitin = options2[nameSelected][n].split('@@');

      //Get the variants of option 1
      spliting = splitin[0].split(',');

      //If we don't have any row in the offer
      if(options2[nameSelected].length < 1){
        spliting = [''];
      }

      //Get the variants of option 2
      spliting2 = splitin[2].split(',');

      //For all the choices of the option 1
      for(var YWB in spliting){
        if(isNaN(YWB)){
          break;
        }
        //If we also have an option 2, we add the values together
        if(typeof spliting2[YWB] !== 'undefined' && spliting2[YWB] != ''){
          newSpliting.push(spliting[YWB].trim().toLowerCase() + '|||' + spliting2[YWB].trim().toLowerCase());
        }
        //If we have only an option 1, we add the value.
        else{
          newSpliting.push(spliting[YWB].trim().toLowerCase());
        }
      }

      //If we found the variant selected by the customer, get the new data ID
      if(arraysEqual(newSpliting, mySpecialArray) == true){
        secondDataID = splitin[1];
      }
    }

    //If we have the new data ID, use it
    if(secondDataID != ''){
      dataID = secondDataID;
    }
  }

  return dataID;

}

function getWBChoices(id){
  numberOffer = 0;
  //Loops through each offer and each variants to get the infos of the variants and the # of the offer to preselect it
  for(var i in options2){
    if(typeof options2[i] == "undefined"){
      break;
    }
    for(x=0; x<options2[i].length; x++){
      splitWB = options2[i][x].split('@@');
      if(splitWB[1] == id){
        arrayOfChoicesInUrl = [];

        variantInUrl = options2[i][x];
        variantInUrl = variantInUrl.split('@@');

        if(variantInUrl[0] != ""){
          arrayOfChoicesInUrl.push(variantInUrl[0].split(','));
        }

        if(variantInUrl[2] != ""){
          arrayOfChoicesInUrl.push(variantInUrl[2].split(','));
        }

        preSelectedVar = numberOffer;

        return arrayOfChoicesInUrl;
      }
    }
    numberOffer++;
  }
  if(typeof variantInUrl == "undefined"){
    return "";
  }
}

function removeDecimal(price_value){
  if(shopWB['no_decimal'] == 1){
    if(price_value != ''){
      var regp = /(\.0?)0(?![1-9])/;
      price_value = price_value.replace(regp, '');

      return price_value;
    }
    else{
      return price_value;
    }
  }
  else{
    return price_value;
  }
}

function showAndReduceForm(){
  showFormWB();
  formWB.style.width = '1px';
  formWB.style.height = '0px';
  formWB.style.overflow = 'hidden';
  formWB.style.margin = '0px';
  formWB.style.marginTop = '0px';
  formWB.style.marginBottom = '0px';
  formWB.style.paddingTop = '0px';
  formWB.style.paddingBottom = '0px';

  showElements = [
    ".gt_product-swatches.gt_flex.gt_variant_product", ".button_add_to_cart.gt_product-addtocart", ".gt_flex.gt_variant_product", ".gt_product-swatches", ".gt_product-variant",
    ".gt_product-quantity", ".gt_product-addtocart", ".gt_button-atc", ".shg-product-selector-wrapper", ".dbtfy-color_swatches", ".product-block .variant-wrapper",
    ".product-form__quantity", ".product__info-container variant-radios", ".product__info-wrapper variant-radios", ".tt-swatches-container", ".pt-swatches-container.pt-swatches-container-js", ".product__info-container variant-selects",
    ".product__info-wrapper variant-selects", 'div[data-pf-type="Layout"] div[data-pf-type="ProductQuantity"]', '.product-block-item.variants-wrapper', '.product-block-item.atc-wrapper', '.product-info__quantity-selector', 'variant-picker'
  ];

  //Show elements from page builder
  pageBuilderShowElements = [
    'div[data-pf-type="ProductVariant"]', 'div[data-pf-type="ProductVariantSwatches"]', 'div[data-label="(P) Variants"]', 'div[data-label="(P) Cart Button"]', 'div[data-pf-type="ProductQuantity"]',
    'button[data-pf-type="ProductATC"]'
  ];

  hideOrShowElements (showElements, pageBuilderShowElements, "block");

  if(formID == ".product-form__buy-buttons .shopify-product-form" && typeof formWB != "undefined" && formWB != null){
    if(formWB.querySelector('#AddToCart') != null){
      formWB.querySelector('#AddToCart').style.width = "0";
      formWB.querySelector('#AddToCart').style.height = "0";
      formWB.style.overflow = 'initial';
    }
  }
}

function showFormWB(){
  showFormVar = 1;
  formWB.style.display = 'block';
  formWB.style.width = 'auto';
  formWB.style.height = 'auto';
  formWB.style.overflow = 'auto';
  if(formWB.hasChildNodes()){
    var children = formWB.childNodes;
    for(var c=0; c < children.length; c++) {
      if(children[c].style && children[c].classList.contains('hidden-wb')) {
        children[c].style.display = 'block';
      }
    }
  }

  //Show elements hidden by WideBundle
  showElements = [
    ".gt_product-swatches.gt_flex.gt_variant_product", ".button_add_to_cart.gt_product-addtocart", ".gt_flex.gt_variant_product", ".gt_product-swatches", ".gt_product-variant",
    ".gt_product-quantity", ".gt_product-addtocart", ".gt_button-atc", ".shg-product-selector-wrapper", ".dbtfy-color_swatches", ".product-block .variant-wrapper",
    ".product-form__quantity", ".product__info-container variant-radios", ".product__info-wrapper variant-radios", ".tt-swatches-container", ".pt-swatches-container.pt-swatches-container-js", ".product__info-container variant-selects",
    ".product__info-wrapper variant-selects", '.product-block-item.variants-wrapper', '.product-block-item.atc-wrapper', '.product-info__quantity-selector', 'variant-picker'
  ];

  //Show elements from page builder
  pageBuilderShowElements = [
    'div[data-pf-type="ProductVariant"]', 'div[data-pf-type="ProductVariantSwatches"]', 'div[data-label="(P) Variants"]', 'div[data-label="(P) Cart Button"]', 'div[data-pf-type="ProductQuantity"]',
    'button[data-pf-type="ProductATC"]', 'button.gt_button--product', '.gt_product-variant.gt_product-swatches'
  ];

  hideOrShowElements (showElements, pageBuilderShowElements, "none")

}

function hideOrShowElements (arrElements, arrPageBuilderElements, condition) {
  let inverseCondition = "none";

  if (condition === "none") {
    inverseCondition = "block"
  }
  for(let y=0; y<arrElements.length; y++){
    if(document.querySelector(arrElements[y]) != null){
     let elementChildren = document.querySelectorAll(arrElements[y]);
      for(let i=0; i<elementChildren.length; i++){
        if(elementChildren[i].style.display == condition){
          elementChildren[i].style.display = inverseCondition;
        }
      }
    }
  }

  if(formID == "page builder" || formID == ".new-wb-form"){
    if(formWidebundle != null){
      loop1:
        for(let y=0; y<arrPageBuilderElements.length; y++){
          if(document.querySelector(arrPageBuilderElements[y]) != null){
            forms = document.querySelectorAll('form');
            loop2:
                for(let i=0; i<forms.length; i++){
                  if(isDescendant(forms[i], formWidebundle)){
                    variants = forms[i].querySelector(arrPageBuilderElements[y]);
                    if(variants != null){
                      if(variants.style.display == condition){
                        variants.style.display = inverseCondition;
                        break loop2;
                      }
                    }
                  }
                }
            if(document.querySelector(arrPageBuilderElements[y]).parentNode != null){
              if(isDescendant(document.querySelector(arrPageBuilderElements[y]).parentNode, formWidebundle)){
                if(document.querySelector(arrPageBuilderElements[y]).style.display == condition){
                  document.querySelector(arrPageBuilderElements[y]).style.display = inverseCondition;
                }
              }
            }
          }
        }
    }
  }
}



function parse_query_string(query) {
  var vars = query.split("&");
  var query_string = {};
  for (var i = 0; i < vars.length; i++) {
    var pair = vars[i].split("=");
    var key = decodeURIComponent(pair[0]);
    var value = decodeURIComponent(pair[1]);
    // If first entry with this name
    if (typeof query_string[key] === "undefined") {
      query_string[key] = decodeURIComponent(value);
      // If second entry with this name
    } else if (typeof query_string[key] === "string") {
      var arr = [query_string[key], decodeURIComponent(value)];
      query_string[key] = arr;
      // If third or later entry with this name
    } else {
      query_string[key].push(decodeURIComponent(value));
    }
  }
  return query_string;
}

function getBaseUrlWB(){
  if(typeof Shopify != "undefined" && typeof Shopify.routes != "undefined" && typeof Shopify.routes.root != "undefined"){
    return Shopify.routes.root;
  }
  else{
    return "/";
  }
}

function getPriceFromJson(variantID){
  try{

    variantsOfProducts = "";
    //allScripts = document.querySelectorAll('script[type="application/json"]');
    allScripts = document.querySelectorAll('*');
    for(x=0; x<allScripts.length; x++){
      if(isJsonString(allScripts[x].innerHTML)){
        jsonParseScript = JSON.parse(allScripts[x].innerHTML);
        if(jsonParseScript != null && typeof jsonParseScript.id != "undefined" && typeof jsonParseScript.variants != "undefined"){
            variantsOfProducts = jsonParseScript.variants;
            break;
        }
        else if(jsonParseScript != null && typeof jsonParseScript[0] != "undefined" && typeof jsonParseScript[0]["option1"] != "undefined"){
          variantsOfProducts = jsonParseScript;
          break;
        }
        else if(jsonParseScript != null && typeof jsonParseScript[variantID] != "undefined"){
          variantsOfProducts = [];
          variantsOfProducts.push(jsonParseScript[variantID]);
          break;
        }
        else if(jsonParseScript != null && typeof jsonParseScript.product != "undefined" && jsonParseScript.product.id != "undefined" && typeof jsonParseScript.product.variants != "undefined"){
          variantsOfProducts = jsonParseScript.product.variants;
          break;
        }
      }
      else if(allScripts[x].getAttribute('data-product') != null && isJsonString(allScripts[x].getAttribute('data-product'))){
        jsonParseScript = JSON.parse(allScripts[x].getAttribute('data-product'));
        if(jsonParseScript != null && typeof jsonParseScript.id != "undefined" && typeof jsonParseScript.variants != "undefined"){
            variantsOfProducts = jsonParseScript.variants;
            break;
        }
      }
    }


    if(variantsOfProducts != ""){
      for(y=0; y<variantsOfProducts.length; y++){
        if(variantsOfProducts[y].id == variantID){
          if(typeof variantsOfProducts[y].price_raw != "undefined"){
            prices = [];
            prices['price'] = variantsOfProducts[y].price_raw;
            if(variantsOfProducts[y].sale_raw != false){
              prices['compare_at_price'] = variantsOfProducts[y].sale_raw;
            }
            else{
              prices['compare_at_price'] = null;
            }
            return prices;
          }
          else if(typeof variantsOfProducts[y].price != "undefined"){
            prices = [];
            prices['price'] = variantsOfProducts[y].price;
            prices['compare_at_price'] = variantsOfProducts[y].compare_at_price;
            return prices;
          }
        }
      }
      return "";
    }
    else{
      return "";
    }
  }catch(error){
    console.error(error);
  }
}

function getInfosWB(){
  showFormWB();
  console.log("Store Link: " + Shopify.shop);
  console.log("Store Theme: " + Shopify.theme.name);
  console.log("Currency Selected: " + Shopify.currency.active + " & rate: " + Shopify.currency.rate);

  if(document.querySelector('div[data-pf-type="Body"]') != null && document.querySelector('div[data-pf-type="Layout"]') != null){
    console.log('The user is using PageFly');
    if(formID != "page builder"){
        console.log("%cPROBLEM: The user didn't use WideBundle Module from PageFly.", "color: red;");
    }
    else{
        console.log("%cThe user is using the WideBundle Module from PageFly.", "color: green;");
    }
  }
  else if(document.querySelector('div[data-label="Row"][data-key="row"]') != null && document.querySelector('html.gemapp') != null){
    console.log('The user is using Gempages');
    if(formID != "page builder"){
      console.log("%cPROBLEM: The user didn't use WideBundle Module from GemPages", "color: red;");
    }
    else{
      console.log("%cThe user is using the WideBundle Module from GemPages", "color: green;");
    }
  }
  else if(formID == "page builder"){
    console.log('The user is using a page builder');
  }
  else{
    console.log('The user is using a normal theme');
  }
  if(selectID == ""){
    console.log("%cPROBLEM: The variants selector doesn't exist or WideBundle didn't find it", "color: red;");
  }
  else{
    console.log("%cThe variants selector has been found", "color: green;");
    if(typeof formWB != "undefined" && formWB != null){
      if(formWB.querySelector('div[data-combined="true"][data-pf-type="ProductVariantSwatches"]') != null){
        console.log("%cThe user is probably using the first variants selector from PageFly that doesn't work", "color: red;");
      }
    }
  }
  if(getButtonATC() == ""){
    console.log("%cPROBLEM: The Add to cart button doesn't exist or WideBundle didn't find it", "color: red;");
  }
  else{
    console.log("%cThe Add to cart button has been found", "color: green;");
  }
  if(linkChoice == "form"){
    console.log("WideBundle is configured to open the side cart");
  }
  else if(linkChoice == "cart"){
    console.log("WideBundle is configured to open the cart page");
  }
  else{
    console.log("WideBundle is configured to open the checkout");
  }
}

function handleUploadApps(){
  if(typeof formWB != "undefined" && formWB != null){

    if(document.querySelector('#new-form .upload-container') != null){ //Handle Upload Kit App
      UploadKitElementsInForm = formWB.querySelectorAll('.wb-uploadlift');
      UploadKitElementsInForm.forEach(UploadKitElementInForm => {
        UploadKitElementInForm.remove();
      });
      elementsInUploadKit = document.querySelectorAll('#new-form .upload-container *');
      elementsInUploadKit.forEach(elementInUploadKit => {
        if(typeof elementInUploadKit != "undefined" && typeof elementInUploadKit.getAttribute != "undefined" && elementInUploadKit.getAttribute("name") != null && elementInUploadKit.getAttribute("name").indexOf('properties') == 0){
          newNode = elementInUploadKit.cloneNode();
          newNode.style.display = "none";
          newNode.classList.add('wb-uploadlift');
          formWB.append(newNode);
        }
      });
    }

  }
}

function replaceCurrencyWB(price_value){


  if(typeof Shopify.currency != "undefined" && Shopify.currency.active == shopWB.currency_code){
    return price_value;
  }

  symbols = ["MXN $", "US$", "$", "€", "£", "kr", "Kr", "CHF", 'USD'];

  symbols.every(symbol => {
    if(price_value.includes(symbol)){
      price_value = price_value.replace(symbol, currencyCodeWB[currencyActiveWB]);
      return false;
    }
    return true;
  });

  return price_value;
}

function convertPriceShopify(price_value, type = 0, variantID = ""){

  //if type = 0 we use old system and we convert price
  //if type = 1 we're coverting actual price
  //if type = 2 we're converting compared at price

  currencyActiveWB = Shopify.currency.active;
  //if(Shopify.currency.rate != '1.0'){
    if(price_value != ''){
      if(getPriceFromJson(variantID) !== ""){
        //For current price
        if(type == 1){
          price_value = parseFloat(getPriceFromJson(variantID)['price']) / 100;
        }
        //For compare at price
        else if(type == 2){
          compare_at_price = getPriceFromJson(variantID)['compare_at_price'];
          if(compare_at_price != "" && compare_at_price != null){
            price_value = parseFloat(compare_at_price) / 100;
          }
          else{
            return "";
          }
        }
        price_value = price_value.toFixed(2);
        price_value = currencyForm.replace('{{amount}}', price_value);
        price_value = replaceCurrencyWB(price_value);

        return price_value;
      }
      //If we can't get prices from json in the page then we use the hidden prices we created
      else{
        if(type == 1){
          price_value = document.querySelector(`.wb_hidden_prices .wb_hidden_price[variant-id="${variantID}"]`).innerHTML;
        }
        //For compare at price
        else if(type == 2){
          price_value = document.querySelector(`.wb_hidden_prices .wb_hidden_compared_price[variant-id="${variantID}"]`).innerHTML;
        }

        return price_value;
      }

      /*if(type == 0 || getPriceFromJson(variantID) === ""){
        price_value = getAmountFromPrice(price_value);
        price_value = parseFloat(price_value) * parseFloat(rateWB);
        if(shopWB.auto_round == 1){
          price_value = parseFloat(price_value).toFixed(2);
          if(Shopify.currency.active != 'EUR'){
            price_value = Math.ceil(price_value);
          }
          else{
            if((Math.ceil(price_value) - price_value) < 0.05){
              price_value = Math.ceil(price_value) + 0.95;
            }
            else{
              price_value = Math.floor(price_value) + 0.95;
            }
          }
        }
      }
      else if(type == 1){
        price_value = parseFloat(getPriceFromJson(variantID)['price']) / 100;
      }
      else{
        if(getPriceFromJson(variantID)['compare_at_price'] != "" && getPriceFromJson(variantID)['compare_at_price'] != null){
          price_value = parseFloat(getPriceFromJson(variantID)['compare_at_price']) / 100;
        }
        else{
          return "";
        }
      }
      price_value = price_value.toFixed(2);

      price_value = currencyForm.replace('{{amount}}', price_value);
      price_value = replaceCurrencyWB(price_value);

      return price_value;*/
    }
    else{
      return '';
    }
  /*}
  //If not a different currency is selected then we'll use the money from hidden prices
  else{
    if(type == 1){
      price_value = document.querySelector(`.wb_hidden_prices .wb_hidden_price[variant-id="${variantID}"]`).innerHTML;
    }
    //For compare at price
    else if(type == 2){
      price_value = document.querySelector(`.wb_hidden_prices .wb_hidden_compared_price[variant-id="${variantID}"]`).innerHTML;
    }

    return price_value;
  }*/

}

function convertPriceConversionBear(){
  try{
    if(typeof conversionBearAutoCurrencyConverter !== 'undefined'){
      for(y=0; y<document.querySelectorAll('.selectedWB').length; y++){
        for(var i=0; i<document.getElementsByClassName('selectedWB')[y].getElementsByClassName('first-price-WB').length; i++){
          element = document.getElementsByClassName('selectedWB')[y].getElementsByClassName('first-price-WB')[i];
          for (var j = 0; j < element.attributes.length; j++){
            if(element.attributes[j].name == 'data-amount'){
              element.removeAttribute(element.attributes[j].name);
            }
          }
        }
        for(var i=0; i<document.getElementsByClassName('selectedWB')[y].getElementsByClassName('second-price-WB').length; i++){
          element = document.getElementsByClassName('selectedWB')[y].getElementsByClassName('second-price-WB')[i];
          for (var j = 0; j < element.attributes.length; j++){
            if(element.attributes[j].name == 'data-amount'){
              element.removeAttribute(element.attributes[j].name);
            }
          }
        }
        for(var i=0; i<document.getElementsByClassName('selectedWB')[y].getElementsByClassName('span-economic-wb').length; i++){
          element = document.getElementsByClassName('selectedWB')[y].getElementsByClassName('span-economic-wb')[i];
          for (var j = 0; j < element.attributes.length; j++){
            if(element.attributes[j].name == 'data-amount'){
              element.removeAttribute(element.attributes[j].name);
            }
          }
        }
      }

      conversionBearAutoCurrencyConverter.convertPricesOnPage();
    }
  }
  catch(error){
    GetErrorWB(error);
  }
}

/*function convertPriceBestCurrencyConverter(){
  if(typeof DoublyGlobalCurrency !== 'undefined'){
    for(y=0; y<document.querySelectorAll('.selectedWB').length; y++){
      for(var i=0; i<document.getElementsByClassName('selectedWB')[y].getElementsByClassName('first-price-WB').length; i++){
        element = document.getElementsByClassName('selectedWB')[y].getElementsByClassName('first-price-WB')[i];
        for (var j = 0; j < element.attributes.length; j++){
          if(element.attributes[j].name.indexOf('doubly') > -1){
            element.setAttribute(element.attributes[j].name, '');
          }
        }
      }
      for(var i=0; i<document.getElementsByClassName('selectedWB')[y].getElementsByClassName('second-price-WB').length; i++){
        element = document.getElementsByClassName('selectedWB')[y].getElementsByClassName('second-price-WB')[i];
        for (var j = 0; j < element.attributes.length; j++){
          if(element.attributes[j].name.indexOf('doubly') > -1){
            element.setAttribute(element.attributes[j].name, '');
          }
        }
      }
      for(var i=0; i<document.getElementsByClassName('selectedWB')[y].getElementsByClassName('span-economic-wb').length; i++){
        element = document.getElementsByClassName('selectedWB')[y].getElementsByClassName('span-economic-wb')[i];
        for (var j = 0; j < element.attributes.length; j++){
          if(element.attributes[j].name.indexOf('doubly') > -1){
            element.setAttribute(element.attributes[j].name, '');
          }
        }
      }
    }
    DoublyGlobalCurrency.convertAll($('[name=doubly-currencies]').val());
  }
}*/

function convertPriceThemeWB(){
  try{
    if(typeof currencyConverter !== 'undefined'){
      for(y=0; y<document.querySelectorAll('.selectedWB').length; y++){
        for(var i=0; i<document.getElementsByClassName('selectedWB')[y].getElementsByClassName('first-price-WB').length; i++){
          element = document.getElementsByClassName('selectedWB')[y].getElementsByClassName('first-price-WB')[i];
          for (var j = 0; j < element.attributes.length; j++){
            if(element.attributes[j].name == 'data-currency'){
              element.removeAttribute(element.attributes[j].name);
            }
          }
        }
        for(var i=0; i<document.getElementsByClassName('selectedWB')[y].getElementsByClassName('second-price-WB').length; i++){
          element = document.getElementsByClassName('selectedWB')[y].getElementsByClassName('second-price-WB')[i];
          for (var j = 0; j < element.attributes.length; j++){
            if(element.attributes[j].name == 'data-currency'){
              element.removeAttribute(element.attributes[j].name);
            }
          }
        }
        for(var i=0; i<document.getElementsByClassName('selectedWB')[y].getElementsByClassName('span-economic-wb').length; i++){
          element = document.getElementsByClassName('selectedWB')[y].getElementsByClassName('span-economic-wb')[i];
          for (var j = 0; j < element.attributes.length; j++){
            if(element.attributes[j].name == 'data-currency'){
              element.removeAttribute(element.attributes[j].name);
            }
          }
        }
      }
      if(typeof currencyConverter._convertAll !== "undefined"){
        currencyConverter._convertAll(currencyConverter.currentCurrency);
      }
    }
  }
  catch(error){
    console.error(error);
  }
}

function convertPriceKTCurrency(){
  try{
    if(typeof KTCurrency !== 'undefined'){
      for(y=0; y<document.querySelectorAll('.selectedWB').length; y++){
        for(var i=0; i<document.getElementsByClassName('selectedWB')[y].getElementsByClassName('first-price-WB').length; i++){
          element = document.getElementsByClassName('selectedWB')[y].getElementsByClassName('first-price-WB')[i];
          for (var j = 0; j < element.attributes.length; j++){
            if(element.attributes[j].name == 'data-currency'){
              element.removeAttribute(element.attributes[j].name);
            }
          }
        }
        for(var i=0; i<document.getElementsByClassName('selectedWB')[y].getElementsByClassName('second-price-WB').length; i++){
          element = document.getElementsByClassName('selectedWB')[y].getElementsByClassName('second-price-WB')[i];
          for (var j = 0; j < element.attributes.length; j++){
            if(element.attributes[j].name == 'data-currency'){
              element.removeAttribute(element.attributes[j].name);
            }
          }
        }
        for(var i=0; i<document.getElementsByClassName('selectedWB')[y].getElementsByClassName('span-economic-wb').length; i++){
          element = document.getElementsByClassName('selectedWB')[y].getElementsByClassName('span-economic-wb')[i];
          for (var j = 0; j < element.attributes.length; j++){
            if(element.attributes[j].name == 'data-currency'){
              element.removeAttribute(element.attributes[j].name);
            }
          }
        }
      }

      KTCurrency.convertAll(KTCurrency.currentCurrency,KTCurrency.currentCurrency);
    }
  }
  catch(error){
    console.error(error);
  }
}

function convertPriceBooster(){
  //CONVERT WITH BOOSTER
  try{
    if(typeof convertCurrencies !== 'undefined'){
      for(y=0; y<document.querySelectorAll('.selectedWB').length; y++){
        for(var i=0; i<document.getElementsByClassName('selectedWB')[y].getElementsByClassName('first-price-WB').length; i++){
          element = document.getElementsByClassName('selectedWB')[y].getElementsByClassName('first-price-WB')[i];
          for (var j = 0; j < element.attributes.length; j++){
            if(element.attributes[j].name == 'data-currency' || element.attributes[j].name.includes('data-currency')){
              element.setAttribute(element.attributes[j].name, '');
            }
          }
        }
        for(var i=0; i<document.getElementsByClassName('selectedWB')[y].getElementsByClassName('second-price-WB').length; i++){
          element = document.getElementsByClassName('selectedWB')[y].getElementsByClassName('second-price-WB')[i];
          for (var j = 0; j < element.attributes.length; j++){
            if(element.attributes[j].name == 'data-currency' || element.attributes[j].name.includes('data-currency')){
              element.setAttribute(element.attributes[j].name, '');
            }
          }
        }
        for(var i=0; i<document.getElementsByClassName('selectedWB')[y].getElementsByClassName('span-economic-wb').length; i++){
          element = document.getElementsByClassName('selectedWB')[y].getElementsByClassName('span-economic-wb')[i];
          for (var j = 0; j < element.attributes.length; j++){
            if(element.attributes[j].name == 'data-currency' || element.attributes[j].name.includes('data-currency')){
              element.setAttribute(element.attributes[j].name, '');
            }
          }
        }
      }

      convertCurrencies();
    }
  }
  catch(error){
    console.error(error);
  }
}

function convertPriceLangshop(){
  //CONVERT WITH LANGSHOP
  try{
    if(typeof LangShop !== 'undefined'){
      for(y=0; y<document.querySelectorAll('.selectedWB').length; y++){
        for(var i=0; i<document.getElementsByClassName('selectedWB')[y].getElementsByClassName('first-price-WB').length; i++){
          element = document.getElementsByClassName('selectedWB')[y].getElementsByClassName('first-price-WB')[i];
          for (var j = 0; j < element.attributes.length; j++){
            if(element.attributes[j].name == 'ls-currency' || element.attributes[j].name.includes('ls-currency')){
              element.setAttribute(element.attributes[j].name, '');
            }
          }
        }
        for(var i=0; i<document.getElementsByClassName('selectedWB')[y].getElementsByClassName('second-price-WB').length; i++){
          element = document.getElementsByClassName('selectedWB')[y].getElementsByClassName('second-price-WB')[i];
          for (var j = 0; j < element.attributes.length; j++){
            if(element.attributes[j].name == 'ls-currency' || element.attributes[j].name.includes('ls-currency')){
              element.setAttribute(element.attributes[j].name, '');
            }
          }
        }
        for(var i=0; i<document.getElementsByClassName('selectedWB')[y].getElementsByClassName('span-economic-wb').length; i++){
          element = document.getElementsByClassName('selectedWB')[y].getElementsByClassName('span-economic-wb')[i];
          for (var j = 0; j < element.attributes.length; j++){
            if(element.attributes[j].name == 'ls-currency' || element.attributes[j].name.includes('ls-currency')){
              element.setAttribute(element.attributes[j].name, '');
            }
          }
        }
      }

      LangShop.switchCurrency(LangShop.getCurrencyCode().toLowerCase());
    }
  }
  catch(error){
    console.log(error);
  }
}

function convertPriceTranscy(){
  //CONVERT WITH TRANSCY
  try{
    if(typeof _transcy !== 'undefined'){
      for(y=0; y<document.querySelectorAll('.selectedWB').length; y++){
        for(var i=0; i<document.getElementsByClassName('selectedWB')[y].getElementsByClassName('first-price-WB').length; i++){
          element = document.getElementsByClassName('selectedWB')[y].getElementsByClassName('first-price-WB')[i];
          for (var j = 0; j < element.attributes.length; j++){
            if(element.attributes[j].name == 'data-translate' || element.attributes[j].name.includes('data-translate')){
              //element.setAttribute(element.attributes[j].name, '');
              element.removeAttribute(element.attributes[j].name);
            }
          }
        }
        for(var i=0; i<document.getElementsByClassName('selectedWB')[y].getElementsByClassName('second-price-WB').length; i++){
          element = document.getElementsByClassName('selectedWB')[y].getElementsByClassName('second-price-WB')[i];
          for (var j = 0; j < element.attributes.length; j++){
            if(element.attributes[j].name == 'data-translate' || element.attributes[j].name.includes('data-translate')){
              //element.setAttribute(element.attributes[j].name, '');
              element.removeAttribute(element.attributes[j].name);
            }
          }
        }
        for(var i=0; i<document.getElementsByClassName('selectedWB')[y].getElementsByClassName('span-economic-wb').length; i++){
          element = document.getElementsByClassName('selectedWB')[y].getElementsByClassName('span-economic-wb')[i];
          for (var j = 0; j < element.attributes.length; j++){
            if(element.attributes[j].name == 'data-translate' || element.attributes[j].name.includes('data-translate')){
              //element.setAttribute(element.attributes[j].name, '');
              element.removeAttribute(element.attributes[j].name);
            }
          }
        }
      }
      _transcy.methods.translatePriceItem();
    }
  }
  catch(error){

  }
}

function convertPriceCurrencySwitcher(){
  try{
    if(typeof SECOMAPP !== 'undefined' && SECOMAPP.cs.loadedJs){
      console.log('ok');
      for(y=0; y<document.querySelectorAll('.selectedWB').length; y++){
        for(var i=0; i<document.getElementsByClassName('selectedWB')[y].getElementsByClassName('first-price-WB').length; i++){
          element = document.getElementsByClassName('selectedWB')[y].getElementsByClassName('first-price-WB')[i];
          for (var j = 0; j < element.attributes.length; j++){
            if(element.attributes[j].name == 'data-currency' || element.attributes[j].name.includes('data-currency')){
              element.setAttribute(element.attributes[j].name, '');
              //element.removeAttribute(element.attributes[j].name);
            }
            if(element.attributes[j].name == 'data-org-price' || element.attributes[j].name.includes('data-org-price')){
              element.setAttribute(element.attributes[j].name, '');
              //element.removeAttribute(element.attributes[j].name);
            }
          }
        }
        for(var i=0; i<document.getElementsByClassName('selectedWB')[y].getElementsByClassName('second-price-WB').length; i++){
          element = document.getElementsByClassName('selectedWB')[y].getElementsByClassName('second-price-WB')[i];
          for (var j = 0; j < element.attributes.length; j++){
            if(element.attributes[j].name == 'data-currency' || element.attributes[j].name.includes('data-currency')){
              element.setAttribute(element.attributes[j].name, '');
              //element.removeAttribute(element.attributes[j].name);
            }
            if(element.attributes[j].name == 'data-org-price' || element.attributes[j].name.includes('data-org-price')){
              element.setAttribute(element.attributes[j].name, '');
              //element.removeAttribute(element.attributes[j].name);
            }
          }
        }
        for(var i=0; i<document.getElementsByClassName('selectedWB')[y].getElementsByClassName('span-economic-wb').length; i++){
          element = document.getElementsByClassName('selectedWB')[y].getElementsByClassName('span-economic-wb')[i];
          for (var j = 0; j < element.attributes.length; j++){
            if(element.attributes[j].name == 'data-currency' || element.attributes[j].name.includes('data-currency')){
              element.setAttribute(element.attributes[j].name, '');
              //element.removeAttribute(element.attributes[j].name);
            }
            if(element.attributes[j].name == 'data-org-price' || element.attributes[j].name.includes('data-org-price')){
              element.setAttribute(element.attributes[j].name, '');
              //element.removeAttribute(element.attributes[j].name);
            }
          }
        }
      }
      Currency.convertAll(Currency.shopCurrency, Currency.currentCurrency);
    }
  }
  catch(error){

  }
}

function dispatchChangeWB(node){
  if('createEvent' in document){
    var evt = document.createEvent('HTMLEvents');
    evt.initEvent('change', false, true);
    node.dispatchEvent(evt);
  }
  else{
    node.fireEvent('onchange');
  }
  setTimeout(function() {
    if('createEvent' in document){
      var evt = document.createEvent('HTMLEvents');
      evt.initEvent('change', false, true);
      node.dispatchEvent(evt);
    }
    else{
      node.fireEvent('onchange');
    }
  }, 100);
}

function dispatchClickWB(node){
  if('createEvent' in document){
    var evt = document.createEvent('HTMLEvents');
    evt.initEvent('click', false, true);
    node.dispatchEvent(evt);
  }
  else{
    node.fireEvent('click');
  }
  setTimeout(function() {
    if('createEvent' in document){
      var evt = document.createEvent('HTMLEvents');
      evt.initEvent('click', false, true);
      node.dispatchEvent(evt);
    }
    else{
      node.fireEvent('click');
    }
  }, 100);
}

function getOptionSelected(i){
  idSelected = document.getElementsByClassName('selectedWB')[0].getAttribute('data-id');
  idSelected = getDataID(nameSelected, idSelected);
  if(i == 0){
    optionSelected = nameSelected;
  }
  else if(i == 1){
    firstImage = [];
    nbrImageProduct = document.getElementsByClassName('selectedWB')[0].getElementsByClassName('select-option-second').length;
    for(nProduct=0;nProduct<nbrImageProduct;nProduct++){
      firstImage.push(document.getElementsByClassName('selectedWB')[0].getElementsByClassName('select-option-second')[nProduct].value);
    }
    for(var n in options2[nameSelected]){
      listOptions2 = options2[nameSelected][n].split('@@');
      listOptions2 = listOptions2[0].split(',').map(function(item){return item.trim();});
      if(arraysEqual(listOptions2, firstImage) == true){
        optionSelected = options2[nameSelected][n].split('@@')[0];
        firstImageFirst = options2[nameSelected][n].split('@@')[0];
        break;
      }
    }
  }
  else if(i == 2){
    firstImage = [];
    firstImageFirst = firstImageFirst.split(',').map(function(item){return item.trim();});
    nbrImageProduct = document.getElementsByClassName('selectedWB')[0].getElementsByClassName('select-option-third').length;
    for(nProduct=0;nProduct<nbrImageProduct;nProduct++){
      firstImage.push(document.getElementsByClassName('selectedWB')[0].getElementsByClassName('select-option-second')[nProduct].value + "|||" + document.getElementsByClassName('selectedWB')[0].getElementsByClassName('select-option-third')[nProduct].value);
    }
    for(var n in options2[nameSelected]){
      listOptions2 = options2[nameSelected][n].split('@@');
      listOptions2 = listOptions2[2].split(',').map(function(item){return item.trim();});
      listOptionsAll = [];
      for(var x=0; x<listOptions2.length; x++){
        listOptionsAll.push(firstImageFirst[x]+"|||"+listOptions2[x]);
      }
      if(arraysEqual(listOptionsAll, firstImage) == true){
        optionSelected = options2[nameSelected][n].split('@@')[2];
        break;
      }
    }
  }

  return optionSelected;
}

function getVariantNameFromOffer(i = 0){
  if(i == 0){
    offerName = document.querySelector('#new-form .selectedWB .title-variant').innerText;
    if(offerName == ""){
      return null;
    }
    else{
      return offerName.toLowerCase();
    }
  }
  else{
    return null;
  }
}

function getVariantNameFromTheme(i){
  try{
    idSelected = getSelectedID();

    variantsOfProducts = "";
    //allScripts = document.querySelectorAll('script[type="application/json"]');
    allScripts = document.querySelectorAll('*');
    for(x=0; x<allScripts.length; x++){
      if(isJsonString(allScripts[x].innerHTML)){
        jsonParseScript = JSON.parse(allScripts[x].innerHTML);
        if(jsonParseScript != null && typeof jsonParseScript.id != "undefined" && typeof jsonParseScript.variants != "undefined"){
            variantsOfProducts = jsonParseScript.variants;
            break;
        }
        else if(jsonParseScript != null && typeof jsonParseScript[0] != "undefined" && typeof jsonParseScript[0]["option1"] != "undefined"){
          variantsOfProducts = jsonParseScript;
          break;
        }
      }
    }


    if(variantsOfProducts != ""){
      for(y=0; y<variantsOfProducts.length; y++){
        if(variantsOfProducts[y].id == idSelected){
          if(typeof variantsOfProducts[y].option1 != "undefined"){
            numberOption = i+1;
            variants = variantsOfProducts[y]["option"+numberOption];
            if(typeof variants != "undefined" && variants != null){
              return variants.trim();
            }
            else{
              return "";
            }
            break;
          }
          else{
            variants = variantsOfProducts[y].public_title.split('/');
            if(typeof variants[i] != "undefined"){
              return variants[i].trim();
            }
            else{
              return "";
            }
            break;
          }
        }
        if((variantsOfProducts.length - 1) == y){
            return "";
        }
      }
    }
    else{
      return "";
    }
  }catch(error){
    console.error(error);
  }
}

function updateSelWB(i, selWB){
  console.log(selWB);
  console.log('yay');
  optionSelected = getOptionSelected(i);

  addConsoleLog(i);
  addConsoleLog(selWB);

  if(selWB[i].tagName !== 'SELECT'){
    sel = selWB[i].querySelectorAll('select')[0];
  }
  else{
    sel = selWB[i];
  }
  addConsoleLog(selWB[i].tagName);
  addConsoleLog('ok');
  addConsoleLog(sel);

  defaultVariant = getVariantNameFromTheme(i);

  var optsWB = sel.options;
  addConsoleLog(optsWB);
  for(var opt, j = 0; opt = optsWB[j]; j++){
    opt.disabled = false;
    if (opt.value.toLowerCase() == optionSelected.toLowerCase() || opt.value.toLowerCase() == idSelected || opt.value.toLowerCase() == defaultVariant.toLowerCase()) {
      sel.options[j].selected = true;
    }
    else if(opt.innerText.toLowerCase() == optionSelected.toLowerCase() || opt.value.toLowerCase() == idSelected) {
      sel.options[j].selected = true;
    }
  }
  dispatchChangeWB(sel);
}

function updateButtonWB(i){
  optionSelected = getOptionSelected(i);

  var buttonsWB = fieldsetWB[i].getElementsByClassName('Popover__Value');
  if(buttonsWB.length == 0){
    var buttonsWB = fieldsetWB[i].querySelectorAll('.combo-box__option-item');
  }
  for(var buttonWB, j = 0; buttonWB = buttonsWB[j]; j++){
    buttonWB.disabled = false;
  }
  for(var buttonWB, j = 0; buttonWB = buttonsWB[j]; j++){
    if ((buttonWB.innerHTML.toLowerCase() == optionSelected.toLowerCase()) || (buttonWB.value.toLowerCase() == optionSelected.toLowerCase())) {
      buttonWB.click();
      buttonWB.click();
    }
  }

}

function updateInputWB(i){
  optionSelected = getOptionSelected(i);

  var inputsWB = fieldsetWB[i].getElementsByTagName('input');
  for(var inputWB, j = 0; inputWB = inputsWB[j]; j++){
    inputWB.disabled = false;
  }
  defaultVariant = getVariantNameFromTheme(i);
  for(var inputWB, j = 0; inputWB = inputsWB[j]; j++){
    if (inputWB.value.toLowerCase() == optionSelected.toLowerCase() || inputWB.value.toLowerCase() == idSelected || (defaultVariant != "" && defaultVariant.toLowerCase() == inputWB.value.toLowerCase()) || getVariantNameFromOffer(i) == inputWB.value.toLowerCase()) {
      inputWB.click();
      inputWB.click();
      if(selectID == ".product-options--swatches .swatches--offer .swatches__options"){
        inputWB.click();
        inputWB.click();
        dispatchChangeWB(inputWB);
      }
    }
    if(selectID == ".swatch__container"){
      if (inputWB.getAttribute('data-value').toLowerCase() == encodeURI(nameSelected).toLowerCase()) {
        inputWB.click();
        inputWB.click();
        dispatchChangeWB(inputWB);
      }
    }
  }

}

function updateAWB(i){
  optionSelected = getOptionSelected(i);

  asWB = swatchWB[i].getElementsByTagName('a');

  for(var aWB, j = 0; aWB = asWB[j]; j++){
    if(aWB.getAttribute('data-value') == null){
      attributeWB = aWB.innerText;
    }
    else{
      attributeWB = aWB.getAttribute('data-value');
    }
    if (attributeWB.toLowerCase() == optionSelected.toLowerCase()) {

      if(selectID != ".product__selectors .select-popout__list" && selectID != "fieldset.select__fieldset .select-popout"){
        aWB.href = 'javascript:void(0);';
      }

      aWB.click();
      aWB.click();
    }
  }
}

function updateLiWB(i){
  optionSelected = getOptionSelected(i);

  lisWB = swatchWB[i].getElementsByTagName('li');
  for(var liWB, j = 0; liWB = lisWB[j]; j++){
    if(liWB.getAttribute('data-escape') != null){
      if (liWB.getAttribute('data-escape').toLowerCase() == optionSelected.toLowerCase()) {
        showAndReduceForm();
        liWB.click();
        liWB.click();
      }
    }
    else if(liWB.innerText.toLowerCase() == optionSelected.toLowerCase()) {
      showAndReduceForm();
      liWB.click();
      liWB.click();
      triggerMouseEvent(liWB, "mousedown");
    }
    else if(liWB.getAttribute('value') != null && liWB.getAttribute('value').toLowerCase() == optionSelected.toLowerCase()) {
      showAndReduceForm();
      liWB.click();
      liWB.click();
      triggerMouseEvent(liWB, "mousedown");
    }
  }
}

function updateDivWB(i){
  optionSelected = getOptionSelected(i);

  divsWB = swatchWB[i].querySelectorAll('.product-options__value');
  if(divsWB[0] == undefined){
    divsWB = swatchWB[i].querySelectorAll('.product-option-item');
  }
  if(divsWB[0] == undefined){
    divsWB = swatchWB[i].querySelectorAll('.button-hero.w-commerce-commerceaddtocartoptionpill');
  }
  if(divsWB[0] == undefined){
    divsWB = swatchWB[i].querySelectorAll('.t4s-swatch__item');
  }
  for(var divWB, j = 0; divWB = divsWB[j]; j++){
    if ((divWB.innerHTML.toLowerCase().trim() == optionSelected.toLowerCase().trim()) || (divWB.innerText.toLowerCase().trim() == optionSelected.toLowerCase().trim())) {
      showFormWB();
      formWB.classList.add('form-wb-selected');
      formWB.style.display = "none";
      divWB.click();
      divWB.click();
      dispatchClickWB(divWB);
    }
  }
}

function updateGemWB(i){
  optionSelected = getOptionSelected(i);

  gtSwatchesWB = gempagesWB[i].getElementsByClassName('gt_swatches--select');
  if(gtSwatchesWB[0] == undefined){
    gtSwatchesWB = gempagesWB[i].querySelectorAll('.gf_swatch');
  }
  for(var gtSwatcheWB, j = 0; gtSwatcheWB = gtSwatchesWB[j]; j++){
    if (gtSwatcheWB.getAttribute('data-value').toLowerCase() == optionSelected.toLowerCase()) {
      gtSwatcheWB.click();
      gtSwatcheWB.click();
    }
  }
}

function getSelectID(formWB){
  selectID = "";
  totalSelects = 0;
  selWB = "";
  getSel:
  for(i=0; i<selsWB.length; i++){
    try{
      if(formWB != null){
        selWB = formWB.querySelectorAll(selsWB[i]);
        if(selWB[0] != null){
          totalSelects = selWB.length;
          selectID = selsWB[i];
          break;
        }
      }
      selWB = document.querySelectorAll(selsWB[i]);
      if(selWB[0] != null){
        for(var x=0; x < formsException.length; x++){
          exception = document.querySelectorAll(formsException[x])[0];
          if(isDescendant(exception, selWB[0])){
            continue getSel;
          }
        }
        totalSelects = selWB.length;
        selectID = selsWB[i];
        break;
      }
    }
    catch(error){
      console.log(error);
    }
  }

  for(i=0; i<fieldsetsWB.length; i++){
    if(formWB != null){
      fieldsetWB = formWB.querySelectorAll(fieldsetsWB[i]);
      if(fieldsetWB[0] != undefined){
        totalFieldsets = fieldsetWB.length;
        selectID = fieldsetsWB[i];
        break;
      }
    }
    fieldsetWB = document.querySelectorAll(fieldsetsWB[i]);
    if(fieldsetWB[0] != undefined){
      totalFieldsets = fieldsetWB.length;
      selectID = fieldsetsWB[i];
      break;
    }
  }

  for(i=0; i<swatchsWB.length; i++){
    if(formWB != null){
      swatchWB = formWB.querySelectorAll(swatchsWB[i]);
      if(swatchWB[0] != undefined){
        totalSwatchs = swatchWB.length;
        selectID = swatchsWB[i];
        break;
      }
    }
    swatchWB = document.querySelectorAll(swatchsWB[i]);
    if(swatchWB[0] != undefined){
      totalSwatchs = swatchWB.length;
      selectID = swatchsWB[i];
      break;
    }
  }

  return selectID;
}

window.selsWB = [
  //Only for selects
  ".single-option-selector", ".variant__input-product-template:not(input[type=\"radio\"])", ".single-option-selector-product-template", ".single-option-selector__radio.product-form__input", ".shg-product-variant-select",
  ".product-form__single-selector", ".AddToCartForm .gf_variants", ".product-form__controls-group .product-form__option select", ".option-selectors .selector-wrapper select",
  "select.pf-variant-select", ".product-form__input select.select__select", "div[data-product-options-container] .form-field-select-wrapper .form-field-select", ".variants-ui__input-select.form-field-input.form-field-select",
  ".product-options.grid .js", 'options-selection select', "variant-select select", '.zpa-single-option-selector', '.prd-block_options .prd-block_select select', '.product-page-info__variants select', 'product-variants select',
  '.dynamic-variant-input', '.product-options select'
];

window.fieldsetsWB = [
  //input, sel, buttons. You need to add the parent that contains the options with inputs inside (If 3 options like "offer, size and color" then you should have a size of 3 for the parent)
  ".single-option-radio", ".variant-input-wrap", ".SizeSwatchList", ".input-field.materialize-select", "fieldset.swatch.clearfix", ".swatches-wrapper .swatch", ".swatch_options .swatch",
  ".radios--root", ".Product__OffScreen .Popover__ValueList", ".Popover__ValueList", "#product-variants .swatch", ".selector-wrapper.product-form__item", ".selector-wrapper.js", ".block-swatch-list", ".swatch-container .swatch__container", ".form-options .option-values",
  ".product-block .variant-input-wrap", "variant-radios .product-form__input", ".swatch.clearfix .swatch-inner", ".variant-group .swatch--product", ".product__selectors .radio__fieldset", ".product-options .inline-field-wrapper",
  ".option-selector-fieldset .option-selector__btns", ".swatches_options .product_options", 'fieldset .option-selector__btns', '.product-form .swatch .pr_form_item', '.product-options--swatches .swatches--offer .swatches__options',
  ':not(.product-sticky-form__form) > product-variants combo-box .combo-box__option-list', 'fieldset.product-variant-picker-block', '.body .product-variant-option .swatch.clearfix', '.pf-option-swatches', 'variant-picker fieldset .variant-picker__option-values',
  '#bcpo .bcpo-buttons'
];

window.swatchsWB = [
  //a, li, div
  ".tt-options-swatch", ".swatches-select", ".pt-options-swatch", ".product-options__section", ".product-options__option", ".selectric-items .selectric-scroll", ".pg__option .pg__option__values",
  ".input-field.product-option-select", ".button-group-hero.w-commerce-commerceaddtocartoptionpillgroup", ".product__selectors .select-popout__list", 'fieldset.select__fieldset .select-popout',
  'div[data-dropdown-wrapper] .t4s-dropdown__content', '.t4s-swatch__list', '.wetheme-dropdown__wrapper ul'
];

function UpdateFormWB(){



  selectID = "";
  totalSelects = 0;
  selWB = "";
  getSel:
  for(i=0; i<selsWB.length; i++){
    try{
      if(formWB != null){
        selWB = formWB.querySelectorAll(selsWB[i]);
        if(selWB[0] != null){
          totalSelects = selWB.length;
          selectID = selsWB[i];
          break;
        }
      }
      selWB = document.querySelectorAll(selsWB[i]);
      if(selWB[0] != null){
        for(var x=0; x < formsException.length; x++){
          exception = document.querySelectorAll(formsException[x])[0];
          if(isDescendant(exception, selWB[0])){
            continue getSel;
          }
        }
        totalSelects = selWB.length;
        selectID = selsWB[i];
        break;
      }
    }
    catch(error){
      console.log(error);
    }
  }

  for(i=0; i<fieldsetsWB.length; i++){
    if(formWB != null){
      fieldsetWB = formWB.querySelectorAll(fieldsetsWB[i]);
      if(fieldsetWB[0] != undefined){
        totalFieldsets = fieldsetWB.length;
        selectID = fieldsetsWB[i];
        break;
      }
    }
    fieldsetWB = document.querySelectorAll(fieldsetsWB[i]);
    if(fieldsetWB[0] != undefined){
      totalFieldsets = fieldsetWB.length;
      selectID = fieldsetsWB[i];
      break;
    }
  }

  for(i=0; i<swatchsWB.length; i++){
    if(formWB != null){
      swatchWB = formWB.querySelectorAll(swatchsWB[i]);
      if(swatchWB[0] != undefined){
        totalSwatchs = swatchWB.length;
        selectID = swatchsWB[i];
        showAndReduceForm();
        break;
      }
    }
    swatchWB = document.querySelectorAll(swatchsWB[i]);
    if(swatchWB[0] != undefined){
      totalSwatchs = swatchWB.length;
      selectID = swatchsWB[i];
      showAndReduceForm();
      break;
    }
  }

  //Exception for sels
  if(formID == "gempage"){
    if(formWidebundle != null){
      if(formWidebundle.closest(".AddToCartForm") != null){
        selWB = formWidebundle.closest(".AddToCartForm").getElementsByClassName('gf_variants');
        totalSelects = formWidebundle.closest(".AddToCartForm").getElementsByClassName('gf_variants').length;
        selectID = 'GEMPAGE SELECT : .gf_variants';
      }
    }
  }
  if(selectID == 'SELECT : .variant__input-product-template' && fieldsetWB[0] != undefined && sel.tagName == 'INPUT'){
    selWB = document.querySelectorAll('VALUE_TO_TRIGGER_NULL');
    selectID = 'FIELDSET : .variant-input-wrap';
  }
  if(selWB[0] == undefined && swatchWB[0] == undefined && fieldsetWB[0] == undefined){
    if(document.querySelectorAll('.product-block .variant-wrapper')[0] == null){
      selWB = document.querySelectorAll(".product-single__variants.no-js");
      totalSelects = document.querySelectorAll(".product-single__variants.no-js").length;
      selectID = ".product-single__variants.no-js";
    }
  }

  //GemPages management
  gempagesWB = document.querySelectorAll('.gt_product-swatches--options');
  totalGempagesWB = document.querySelectorAll('.gt_product-swatches--options').length;
  if(gempagesWB[0] == undefined){
    gempagesWB = document.querySelectorAll('.gf_swatches-selector');
    totalGempagesWB = document.querySelectorAll('.gf_swatches-selector').length;
  }
  if(typeof sel == "undefined" && typeof fieldset == "undefined" && typeof swatchWB == "undefined"){
    selectID = 'gempages swatch';
  }

  if(selWB[0] == undefined && fieldsetWB[0] == undefined && swatchWB[0] == undefined && gempagesWB[0] == undefined){
    selectID = '';
  }

  if(shopWB['select_id']!=selectID){
	  var http = new XMLHttpRequest();
	  var url = websiteWB+'AJAX/GetSelect.php';
	  var params = 'select='+selectID+'&shop='+shopWB['shop'];
	  http.open('POST', url, true);
	  http.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
	  http.onreadystatechange = function() {
		  if(http.readyState == 4 && http.status == 200) {
		  }
	  }
	  http.send(params);
	  shopWB['select_id'] = selectID;
  }

  //If the variants are selects
  if(selWB[0] != undefined && selectID != '.selector-wrapper.product-form__item' && selectID != '.swatch.clearfix .swatch-inner' && selectID != ".selectric-items .selectric-scroll" && selectID != ".block-swatch-list" && selectID != ".Product__OffScreen .Popover__ValueList" && selectID != "fieldset.select__fieldset .select-popout" && selectID != ".product-form .swatch .pr_form_item" && selectID != ".product-options--swatches .swatches--offer .swatches__options" && selectID != ".body .product-variant-option .swatch .swatch-element" && selectID != ':not(.product-sticky-form__form) > product-variants combo-box .combo-box__option-list' && selectID != "#bcpo .bcpo-buttons" && selectID != ".single-option-radio"){

    //Manage the event not fired for theme ware house
    selectJS = document.querySelector('.no-js.product-form__option select');
    if(selectJS != "" && selectJS != undefined){
      idSelected = document.getElementsByClassName('selectedWB')[0].getAttribute('data-id');
      idSelected = getDataID(nameSelected, idSelected);
      var optsWB = selectJS.options;
      for(var opt, j = 0; opt = optsWB[j]; j++){

        if (!isNaN(opt.value) && opt.value == idSelected) {
          selectJS.options[j].selected = true;
        }
      }
      dispatchChangeWB(selectJS);
    }

    //Update the first select
    console.log('here');
    console.log(selWB[0]);
    console.log(selWB);
    updateSelWB(0, selWB);

    //Update the second select
    if(totalSelects >= 2){
      updateSelWB(1, selWB);
    }

    //update the third select
    if(totalSelects > 2){
      updateSelWB(2, selWB);
    }
  }

  //If the variants are fieldsets
  else if(fieldsetWB[0] != undefined && selectID != "fieldset.select__fieldset .select-popout" && selectID != ".wetheme-dropdown__wrapper ul"){
    selWB = fieldsetWB[0].getElementsByTagName('select');
    buttonListWB = fieldsetWB[0].getElementsByTagName('button');
    inputWB = fieldsetWB[0].getElementsByTagName('input');

    //If the fieldset is a select
    if(selWB[0] != undefined){
      updateSelWB(0, fieldsetWB);

      //Update the second select
      if(totalFieldsets == 2 || totalFieldsets == 3){
        updateSelWB(1, fieldsetWB);
      }

      //Update the third select
      if(totalFieldsets == 3){
        updateSelWB(2, fieldsetWB);
      }
    }

    //If the fieldset is a button
    else if(buttonListWB[0] != undefined){
      updateButtonWB(0);

      //Update the second button
      if(totalFieldsets == 2 || totalFieldsets >= 3){
        updateButtonWB(1);
      }

      //Update the third button
      if(totalFieldsets == 3){
        updateButtonWB(2);
      }
    }

    //If the fieldset is an input
    else if(inputWB[0] != undefined){
      updateInputWB(0);

      //Update the second input
      if(totalFieldsets == 2 || totalFieldsets >= 3){ //if the user has 2 forms then totalFieldsets will double
        updateInputWB(1);
      }

      //Update the third input
      if(totalFieldsets >= 3){
        updateInputWB(2);
      }
    }
  }

  else if(swatchWB[0] != undefined){
    asWB = swatchWB[0].getElementsByTagName('a');
    lisWB = swatchWB[0].getElementsByTagName('li');
    divsWB = swatchWB[0].querySelectorAll('.product-options__value');
    if(divsWB[0] == undefined){
      divsWB = swatchWB[0].querySelectorAll('.product-option-item');
    }
    if(divsWB[0] == undefined){
      divsWB = swatchWB[0].querySelectorAll('.button-hero.w-commerce-commerceaddtocartoptionpill');
    }
    if(divsWB[0] == undefined){
      divsWB = swatchWB[0].querySelectorAll('.t4s-swatch__item');
    }

    if(asWB[0] != undefined){
      updateAWB(0);

      //Update the second a
      if(totalSwatchs == 2 || totalSwatchs == 3){
        updateAWB(1);
      }

      //Update the third a
      if(totalSwatchs == 3){
        updateAWB(2);
      }
    }

    if(lisWB[0] != undefined){
      updateLiWB(0);

      //Update the second li
      if(totalSwatchs == 2 || totalSwatchs == 3){
        updateLiWB(1);
      }

      //Update the third li
      if(totalSwatchs == 3){
        updateLiWB(2);
      }
    }

    if(divsWB[0] != undefined){
      updateDivWB(0);

      //Update the second div
      if(totalSwatchs == 2 || totalSwatchs == 3){
        updateDivWB(1);
      }

      //Update the third div
      if(totalSwatchs == 3){
        updateDivWB(2);
      }
    }
  }

  else if(gempagesWB[0] != undefined){
    updateGemWB(0)

    //Update the second a
    if(totalGempagesWB == 2 || totalGempagesWB == 3){
      updateGemWB(1);
    }

    //Update the third a
    if(totalGempagesWB == 3){
      updateGemWB(2);
    }
  }

  //Trigger for special theme
  if(typeof $ != "undefined"){
    if(document.querySelector('#SingleOptionSelector-0.product__option') != null){
      $("#SingleOptionSelector-0").trigger("change");
    }
  }
  if(typeof $ != "undefined"){
    if(document.querySelector('.option-selectors .selector-wrapper select') != null){
      $(".option-selectors .selector-wrapper select").trigger("change");
    }
  }
  if(document.querySelector('variant-selects') != null && !document.querySelector('variant-selects').parentNode.classList.contains('sticky-cart-button__container')){
    sel = document.querySelector('variant-selects');
    if('createEvent' in document){
      var evt = document.createEvent('HTMLEvents');
      evt.initEvent('change', false, true);
      sel.dispatchEvent(evt);
    }
    else{
      sel.fireEvent('onchange');
    }
  }
  if(document.querySelector('variant-select') != null){
    for(var i = 0; i<document.querySelectorAll('variant-select').length; i++){
      sel = document.querySelectorAll('variant-select')[i];
      if('createEvent' in document){
        var evt = document.createEvent('HTMLEvents');
        evt.initEvent('change', false, true);
        sel.dispatchEvent(evt);
      }
      else{
        sel.fireEvent('onchange');
      }
    }
  }

  if(document.querySelector('variant-picker') != null){
    for(var i = 0; i<document.querySelectorAll('variant-picker').length; i++){
      sel = document.querySelectorAll('variant-picker')[i];
      if('createEvent' in document){
        var evt = document.createEvent('HTMLEvents');
        evt.initEvent('change', false, true);
        sel.dispatchEvent(evt);
      }
      else{
        sel.fireEvent('onchange');
      }
    }
  }

  if(document.querySelector('product-variants') != null){
    for(var i = 0; i<document.querySelectorAll('product-variants').length; i++){
      sel = document.querySelectorAll('product-variants')[i];
      if('createEvent' in document){
        var evt = document.createEvent('HTMLEvents');
        evt.initEvent('change', false, true);
        sel.dispatchEvent(evt);
      }
      else{
        sel.fireEvent('onchange');
      }
    }
  }
  if(formWB && formWB.querySelector('.product-options')){
    for(var i = 0; i<document.querySelectorAll('.product-options').length; i++){
      sel = document.querySelectorAll('.product-options')[i];
      if('createEvent' in document){
        var evt = document.createEvent('HTMLEvents');
        evt.initEvent('change', false, true);
        sel.dispatchEvent(evt);
      }
      else{
        sel.fireEvent('onchange');
      }
    }
  }
  if(formID == "page builder" || formID == ".new-wb-form"){
    sel = document.querySelector('div[data-pf-type="ProductVariantSwatches"]');
    if(sel != null){
      if('createEvent' in document){
        var evt = document.createEvent('HTMLEvents');
        evt.initEvent('change', false, true);
        sel.dispatchEvent(evt);
      }
      else{
        sel.fireEvent('onchange');
      }
    }
  }
  if(document.querySelector('main#mainWrap #productHead #prodForm .form-select-wrapper .single-option-selector') != null && Shopify.theme.name.indexOf('fastlane') > -1){
    sel = document.querySelector('main#mainWrap #productHead #prodForm .form-select-wrapper .single-option-selector');
    setTimeout(function() {
      if('createEvent' in document){
        var evt = document.createEvent('HTMLEvents');
        evt.initEvent('change', false, true);
        sel.dispatchEvent(evt);
      }
      else{
        sel.fireEvent('onchange');
      }
    }, 500);
  }
  if(typeof selectID != "undefined" && selectID == ".selector-wrapper.product-form__item" && typeof Afterpay != "undefined"){
    setTimeout(function() {
      if(document.querySelector('.selector-wrapper.product-form__item') != null)
      eventFire(document.querySelector('.selector-wrapper.product-form__item'), "change");
    }, 300);
  }
  if(document.querySelector('#ProductSection-product-template #add-to-cart-form #product-variants select') != null){
    sel = document.querySelector('#ProductSection-product-template #add-to-cart-form #product-variants select');
    setTimeout(function() {
      if('createEvent' in document){
        var evt = document.createEvent('HTMLEvents');
        evt.initEvent('change', false, true);
        sel.dispatchEvent(evt);
      }
      else{
        sel.fireEvent('onchange');
      }
    }, 500);
  }

  //Manage EcomSolid changing variants
  if(typeof window.SOLID != 'undefined'){
    productJsonNode = document.querySelector('.ProductJson');
    if(productJsonNode != null){
      isGemPages = formWB.closest('[class^=\'gt_section-\'][data-name], [class^=\'gf_section-\'][data-name], [class^=\'gt_widget-\'][data-name], [class^=\'gt_element-\'][data-name]');
      if(isGemPages != null){
        productJson = JSON.parse(productJsonNode.innerHTML);
        variantJson = productJson.variants;
        idSelected = document.getElementsByClassName('selectedWB')[0].getAttribute('data-id');
        idSelected = getDataID(nameSelected, idSelected);
        for(i=0; i<variantJson.length; i++){
            if(variantJson[i].id == idSelected){
                variantObject = variantJson[i];
                console.log(variantObject);
                break;
            }
        }
        window.SOLID.store.dispatch("variant" + productJson.id, variantObject);
      }
    }
  }


}

function initWB(){
  GetPriceWB(shopWB['update_price']); //We have a feature to update the price of the store with WideBundle prices. We use it to find the div corresponding to the price on the page. We do it if this feature is enabled in the settings

  try{
    GetFormWB(); //We find the product form of the theme so we can hide it and place WideBundle below. In this function we also detect if WideBundle was added manually
  }
  catch(error){
  }

  if(formWB != null || gempageWB == 1) { //If we found the product form of the store or if the form was added manually (gempageWB means it was added manually, mostly because the manual placement is used for page builders)

    if(gempageWB == 0){ //If WideBundle hasn't been placed manually
      newForm = createWidget(); //We create the div for the widget and place it in newForm variable
    }
    else if(gempageWB == 1){ //If WideBundle has been placed manually
      newForm = document.getElementById('new-form');  //We get directly the position of the div
    }

    hiddenPrices = addHiddenPrices(); //Add prices so we can use them later for price conversion apps
    newForm.appendChild(hiddenPrices);

    let newForms = Array.from(document.querySelectorAll('.new-wb-form'));
    newForms.unshift(newForm);

    for(var xx=0; xx<newForms.length; xx++){ //For each div with class new-wb-form we found

      addMainStyle();//We add all the CSS on the store
      titleOption = createTitle(newForms[xx]); //We create the heading that appears above the offers

      for (var n in options1){ //We loop through every offer of the product
        if(isNaN(n)){ //Fixing bug incompatibility where some script on stores added values to options1
          break;
        }

        attributes = options1[n].split('@@'); //The offers have all the information (price, title, etc) inside the array and each value are separated by @@, they are not in some array properly
        ValueWide = createOfferDiv(newForms[xx]); //We create the main div of the offer
        valueLeft = createOfferDivLeft(); //We add the elements of the offer that are in the left part
        valueRight = createOfferDivRight(); //We add the elements of the offer that are in the right part
        newForms[xx].appendChild(ValueWide); //We add this offer to the main div of the widget
      }

      buttonATC = addButtonATC(newForms[xx]); //We create the add to cart button of the widget
      newForms[xx].appendChild(buttonATC); //We place the add to cart button inside the main div of the widget
      addCheckoutHref();//We create a checkout button hidden on the store because we need to redirect people to checkout if the user chose to redirect to the checkout after cliking on the add to cart button.
      addAfterButtonATC(newForms[xx]); //The user can add elements after the add to cart button so we insert everything
      window.addEventListener('load', changePrice, false); //We start a function changePrice that does many things, it's not only to change the price anymore
    }

    // addMainStyle(); //We add all the CSS on the store
    //
    // titleOption = createTitle(); //We create the heading that appears above the offers
    //
    // for (var n in options1){ //We loop through every offer of the product
    //   if(isNaN(n)){ //Fixing bug incompatibility where some script on stores added values to options1
    //     break;
    //   }
    //
    //   attributes = options1[n].split('@@'); //The offers have all the information (price, title, etc) inside the array and each value are separated by @@, they are not in some array properly
    //
    //   ValueWide = createOfferDiv(); //We create the main div of the offer
    //
    //   valueLeft = createOfferDivLeft(); //We add the elements of the offer that are in the left part
    //
    //   valueRight = createOfferDivRight(); //We add the elements of the offer that are in the right part
    //
    //   newForm.appendChild(ValueWide); //We add this offer to the main div of the widget
    // }
    //
    // buttonATC = addButtonATC(); //We create the add to cart button of the widget
    //
    // newForm.appendChild(buttonATC); //We place the add to cart button inside the main div of the widget
    //
    // addCheckoutHref(); //We create a checkout button hidden on the store because we need to redirect people to checkout if the user chose to redirect to the checkout after cliking on the add to cart button.
    //
    // addAfterButtonATC(); //The user can add elements after the add to cart button so we insert everything
    //
    // addBlinkingEffect(); //The user can add custom messages on the offers and make them blink so we created a function to do that
    //
    // UpdateQuantityWB(); //If the quantity selector is enabled in the settings of WideBundle we create a function to synchronize the theme quantity selector with the widbundle quantity selector
    //
    // window.addEventListener('load', changePrice, false); //We start a function changePrice that does many things, it's not only to change the price anymore

  }

  //System to have multiple forms
  // if(pageBuilderClassWB == 1){ //If we detected that they added a new WideBundle using new-wb-form
  //
  //   newForms = document.querySelectorAll('.new-wb-form'); //Get all the new widebundle widget that were added
  //
  //   if(formWB == null && gempageWB == 0) { //I don't know why I did that but it should be useful, maybe because I thought people could use only new-wb-form and not the main widget but it's false
  //     addMainStyle(); //Add main css
  //   }
  //
  //   for(var xx=0; xx<newForms.length; xx++){ //For each div with class new-wb-form we found
  //
  //     titleOption = createTitle2(); //Add the heading above the offers with another function
  //
  //     for (var n in options1){ //For each offers
  //       if(isNaN(n)){ //System to avoid incompatibility problem
  //         break;
  //       }
  //
  //       attributes = options1[n].split('@@'); //Split the information we have for this offer
  //
  //       ValueWide = createOfferDiv2(); //Create the main div of the offer
  //
  //       valueLeft = createOfferDivLeft(); //Create the left elements
  //
  //       valueRight = createOfferDivRight(); //Create the right elements
  //
  //       newForms[xx].appendChild(ValueWide); //Add the offer to this div
  //     }
  //
  //     buttonATC = addButtonATC2(); //Create the button Add to cart
  //
  //     newForms[xx].appendChild(buttonATC); //Add the button add to cart to the div
  //
  //     addAfterButtonATC2(); //Add the elements that come after the add to cart button
  //
  //     UpdateQuantityWB(); //Synchronize the quantity system with the theme
  //
  //     window.addEventListener('load', changePrice, false); //Launch that function that does many things
  //   }
  //
  //   if(formWB == null && gempageWB == 0) {
  //     addBlinkingEffect(); //If we didn't create this function yet we do it
  //   }
  //
  // }

  if(formWB != null || gempageWB == 1 || pageBuilderClassWB == 1) { //If at least 1 widget is created

    preSelectOffer(); //We preselect the offer for the widget so we have an offer selected. It's by default the first offer or the offer that was preselected by the user
    UpdateQuantityWB(); //If the quantity selector is enabled in the settings of WideBundle we create a function to synchronize the theme quantity selector with the widbundle quantity selector
    addBlinkingEffect(); //The user can add custom messages on the offers and make them blink so we created a function to do that

    if(typeof options2[nameSelected] !== 'undefined'){ //Some themes add elements after a few seconds so we delay that script and launch again the changePrice() after 1 sec
      setTimeout(
      function() {
        changePrice();
      }, 1000);
    }

    UpdateStyleWB(shopWB['design_code'], shopWB['price_size']); //We update the style of the widget with the theme they selected

    AddCustomCodeWB(shopWB['custom_css']); //We add custom codes added in the admin dashboard, the users don't have access to it
    addPricesFromAjax(); //Adding prices using Ajax
    regenerateWideBundleListeners(); //System to check if the theme will not duplicate WideBundle widget and recreate it, resulting in losing every listeners
  }
}

//Declare all the variables
declareVariable(shopWB);

//Get the offers from the db in the variables
selectOffers();
//Only if we are on a product page configured, hide form + add selected options
currencyForm = shopWB['currency']; //We get the currency of the shop


if (typeof productON !== 'undefined') { //productON should be the handle of the product if we are on a page that contains offers

  initWB();
}

}